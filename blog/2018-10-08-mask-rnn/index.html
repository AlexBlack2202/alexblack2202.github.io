<!doctype html><html lang="en" data-palette="blue"
   data-mode="dark">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mask R-CNN trong bài toán nhận dạng và phân vùng đối tượng - Phạm Duy Tùng Machine Learning Blog</title>
    <meta name="a.validate.02" content="1QZXZ8oi7g57H-GxBrBPkTYBydwii-Ic9iJu" /><link rel="apple-touch-icon" href="/images/icons/icon-180x180.png" sizes="180x180">
<link rel="icon" href="/images/icons/icon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="/images/icons/icon-16x16.png" sizes="16x16" type="image/png">
<link rel="icon" href="/images/icons/favicon.ico">
<link rel="manifest" href="/manifest.json">
<meta name="keywords" content="" />
<meta name="description" content="Ở bài viết này, chúng ta đề cập đến vấn đề sử dụng Mask R-CNN để nhận dạng và phân vùng đối tượng." /><meta name="robots" content="index, follow" />
  <meta itemprop="name" content="Mask R-CNN trong bài toán nhận dạng và phân vùng đối tượng">
  <meta itemprop="description" content="Ở bài viết này, chúng ta đề cập đến vấn đề sử dụng Mask R-CNN để nhận dạng và phân vùng đối tượng.">
  <meta itemprop="datePublished" content="2018-10-08T00:19:00+03:00">
  <meta itemprop="dateModified" content="2018-10-08T00:19:00+03:00">
  <meta itemprop="wordCount" content="1936">
  <meta itemprop="keywords" content="Machine Learning,DeepLearning,Spark"><meta property="og:url" content="/blog/2018-10-08-mask-rnn/">
  <meta property="og:site_name" content="Phạm Duy Tùng Machine Learning Blog">
  <meta property="og:title" content="Mask R-CNN trong bài toán nhận dạng và phân vùng đối tượng">
  <meta property="og:description" content="Ở bài viết này, chúng ta đề cập đến vấn đề sử dụng Mask R-CNN để nhận dạng và phân vùng đối tượng.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2018-10-08T00:19:00+03:00">
    <meta property="article:modified_time" content="2018-10-08T00:19:00+03:00">
    <meta property="article:tag" content="Machine Learning">
    <meta property="article:tag" content="DeepLearning">
    <meta property="article:tag" content="Spark">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Mask R-CNN trong bài toán nhận dạng và phân vùng đối tượng">
  <meta name="twitter:description" content="Ở bài viết này, chúng ta đề cập đến vấn đề sử dụng Mask R-CNN để nhận dạng và phân vùng đối tượng.">
<meta property="og:image" content="/images/logo.png"/>
  <meta name="twitter:image" content="/images/logo.png"/><link rel="stylesheet" href="/css/main.min.c06cf34535ee1f60ba08893b4d57e76b2bbd5e11c17ab12ef976f02983a51b54.css" integrity="sha256-wGzzRTXuH2C6CIk7TVfnayu9XhHBerEu&#43;XbwKYOlG1Q=" crossorigin="anonymous"><link rel="stylesheet" href="/css/katex.min.d080a89e03e1eb850f547d835c186b4273f69879aa497eb8b0e88c1578bf1f0b.css" integrity="sha256-0ICongPh64UPVH2DXBhrQnP2mHmqSX64sOiMFXi/Hws=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/viewer.min.3d228794bcedbbfa0412beb8fbc1ec6973202945e42af7004f742a4d7bd620ab.css" integrity="sha256-PSKHlLztu/oEEr64&#43;8HsaXMgKUXkKvcAT3QqTXvWIKs=" crossorigin="anonymous"><style>
    .bgcover {
        display: block;
        overflow: hidden;
        height: 450px;
        background: no-repeat center center;
        -webkit-background-size: cover;
        -moz-background-size: cover;
        -o-background-size: cover;
        background-size: cover;
        position: relative;
        margin-bottom: -65px;
    }
    .bgcover {
        margin-bottom: 0 !important;
    }

    .bgcover .bgtrans {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        display: block;
        overflow: hidden;
        height: inherit;
        background: rgba(0,0,0,.8);
        background: -webkit-gradient(linear,0% 0%,0% 100%,from(rgba(0,0,0,.8)),to (rgba(0,0,0,.6)),to(rgba(255,255,255,0)));
        background: -webkit-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
        background: -moz-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
        background: -ms-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
        background: -o-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
    }

    .bgcover .bgtrans h1 {
        display: block;
        overflow: hidden;
        font-size: 45px;
        line-height: 55px;
        color: #fff;
        width: 800px;
        margin: auto;
        position: absolute;
        left: 0;
        right: 0;
        bottom: 50px;
        font-family: 'Roboto Condensed',sans-serif;
        font-weight: 600;
    }
</style></head>
  <body><script>const items=["mode","palette"];items.forEach(function(e){const t=localStorage.getItem("hbs-"+e);t&&document.body.parentElement.setAttribute("data-"+e,t)})</script><header><nav class="navbar top-app-bar top-app-bar-expand-lg fixed-top">
  <div class="container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button><a class="navbar-brand flex-grow-1 flex-lg-grow-0 text-center text-lg-start mx-auto me-lg-3" href="/"><img class="logo" alt="Logo" src="/images/logo.webp" loading="lazy"  title="Logo"
   width="400" height="400"
   />
HOME
    </a>
    <div class="offcanvas offcanvas-bottom surface" tabindex="-1" id="offcanvasSocialShare" aria-labelledby="offcanvasSocialShare">
  <div class="offcanvas-header">
    <h3 class="offcanvas-title">Share</h3>
    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="offcanvas-body">
    <a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Twitter Share Button"
      target="_blank" href="https://twitter.com/intent/tweet?title=Mask%20R-CNN%20trong%20b%c3%a0i%20to%c3%a1n%20nh%e1%ba%adn%20d%e1%ba%a1ng%20v%c3%a0%20ph%c3%a2n%20v%c3%b9ng%20%c4%91%e1%bb%91i%20t%c6%b0%e1%bb%a3ng&url=%2fblog%2f2018-10-08-mask-rnn%2f">
      <i class="fab fa-fw fa-twitter"></i> Twitter
    </a>
    <a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Facebook Share Button"
      target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=%2fblog%2f2018-10-08-mask-rnn%2f">
      <i class="fab fa-fw fa-facebook-f"></i> Facebook
    </a>
  </div>
</div>
    <button class="navbar-settings" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSettings"
  aria-controls="offcanvasSettings" aria-label="Toggle settings">
  <i class="fas fa-ellipsis-v"></i>
</button>

<div class="offcanvas offcanvas-end surface h-100" tabindex="-1" id="offcanvasSettings" aria-labelledby="offcanvasSettings">
  <div class="offcanvas-header">
    <h3 class="offcanvas-title">Settings</h3>
    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="offcanvas-body d-flex flex-column">



<section class="setting">
  <form class="font-size-switcher-form row">
    <div class="col-auto">
      <label for="fontSize" class="form-label"><i class="fas fa-fw fa-font"></i> Font Size</label>
    </div>
    <div class="col-auto ms-auto">
      <input type="range" class="form-range" min="-2" max="2" id="fontSize">
    </div>
  </form>
</section>


<section class="setting palettes">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-palette"></i> Palette</label>
    </div>
    <div class="col-auto ms-auto">
      <a id="btnPalette" class="btn btn-sm btn-outline-primary" role="button" aria-label="palettePicker">
        <i class="fas fa-eye-dropper"></i>
      </a>
    </div>
  </form>
  <div class="mt-2 d-flex justify-content-between visually-hidden" id="palettePicker"><button type="button" id="palette-blue" aria-label="Blue"
        class="btn btn-sm w-100 palette" data-palette="blue">
      </button><button type="button" id="palette-blue-gray" aria-label="Blue Gray"
        class="btn btn-sm w-100 palette" data-palette="blue-gray">
      </button><button type="button" id="palette-brown" aria-label="Brown"
        class="btn btn-sm w-100 palette" data-palette="brown">
      </button><button type="button" id="palette-cyan" aria-label="Cyan"
        class="btn btn-sm w-100 palette" data-palette="cyan">
      </button><button type="button" id="palette-green" aria-label="Green"
        class="btn btn-sm w-100 palette" data-palette="green">
      </button><button type="button" id="palette-indigo" aria-label="Indigo"
        class="btn btn-sm w-100 palette" data-palette="indigo">
      </button><button type="button" id="palette-orange" aria-label="Orange"
        class="btn btn-sm w-100 palette" data-palette="orange">
      </button><button type="button" id="palette-pink" aria-label="Pink"
        class="btn btn-sm w-100 palette" data-palette="pink">
      </button><button type="button" id="palette-purple" aria-label="Purple"
        class="btn btn-sm w-100 palette" data-palette="purple">
      </button><button type="button" id="palette-red" aria-label="Red"
        class="btn btn-sm w-100 palette" data-palette="red">
      </button><button type="button" id="palette-teal" aria-label="Teal"
        class="btn btn-sm w-100 palette" data-palette="teal">
      </button><button type="button" id="palette-yellow" aria-label="Yellow"
        class="btn btn-sm w-100 palette" data-palette="yellow">
      </button></div>
</section>
<section class="setting actions d-flex justify-content-around mt-auto overflow-auto">
  <a role="button" class="action action-go-back" href="javascript: window.history.back();">
    <span class="action-icon"><i class="fas fa-2x fa-arrow-left"></i></span> Go back
  </a>
  <a role="button" class="action action-reload-page">
    <span class="action-icon"><i class="fas fa-2x fa-redo-alt"></i></span> Reload
  </a>
  <a role="button" class="action action-copy-url">
    <span class="action-icon"><i class="fas fa-2x fa-link"></i></span> Copy URL
  </a><a class="action action-social-share" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSocialShare"
    aria-controls="offcanvasSocialShare" aria-label="Toggle social share">
    <span class="action-icon"><i class="fas fa-2x fa-share-alt"></i></span> Share
  </a></section>

</div>
</div>

    <div class="collapse navbar-collapse" tabindex="-1" id="navbarSupportedContent" aria-labelledby="navbarSupportedContent">
      <form class="search-bar my-1" action="/search">
  <div class="input-group input-group-sm">
    <span class="btn btn-search disabled position-absolute left-0"><i class="fas fa-fw fa-search"></i></span>
    <input class="form-control rounded-pill" name="q" type="search" aria-label="Search">
  </div>
</form>
      <ul class="navbar-nav ms-auto"><li class="nav-item">
          <a class="nav-link" href="/series/">
            <i class="fas fa-fw fa-columns"></i>Courses
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/tools/">
            <i class="fas fa-fw fa-folder"></i>Tools
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/categories/">
            <i class="fas fa-fw fa-folder"></i>Categories
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/archives/">
            <i class="fas fa-fw fa-file-archive"></i>Archives
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/tags/">
            <i class="fas fa-fw fa-tags"></i>Tags
          </a>
        </li><li class="nav-item dropdown">
          <a class="nav-link" id="navbarDropdownSupport" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-fw fa-chevron-circle-down"></i>Support
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdownSupport"><li>
              <a class="dropdown-item"
                href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">
                Repository
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">
                Discussions
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">
                Features Request
              </a>
            </li><li><hr class="dropdown-divider"></li><li>
              <a class="dropdown-item"
                href="/faq/">
                FAQs
              </a>
            </li></ul>
        </li></ul>
    </div>
  </div>
</nav>
</header>
<main role="main" class="container" style="line-height:1.7em">
      <div class="row content">
<div class="col-lg-9 col-md-8">
  <div class="container"><nav class="row card component" aria-label="breadcrumb">
  <div class="card-body">
    <ol class="breadcrumb "><li class="breadcrumb-item"><a href="/">Home</a></li><li class="breadcrumb-item"><a href="/blog/">Blogs</a></li><li class="breadcrumb-item active">Mask R-CNN Trong Bài Toán Nhận Dạng Và Phân Vùng Đối Tượng</li></ol>
  </div>
</nav>
<div class="post-panel-wrapper">
  <div class="d-flex flex-column component rounded post-panel">
    
    <a class="action action-panel-toggler" role="button" title="Panel toggler">
      <i class="fas fa-fw fa-chevron-circle-down"></i>
    </a>
    <a id="sidebarToggler" class="action d-none d-lg-block" role="button" title="Sidebar toggler">
  <i class="fas fa-fw fa-expand-alt" data-fa-transform="rotate-45"></i>
</a>

    

    
    
    <a class="action" href="#post-comments" role="button" aria-label="Comments" title="Comments">
  <i class="fas fa-fw fa-comments"></i>
</a>
    <a class="action" href="#postTOC" aria-controls="Table of contents" role="button" title="Table of contents">
  <i class="fas fa-fw fa-list-alt"></i>
</a>
    
  </div>
</div>
<article class="row card component mb-4 post">
  <div class="card-header ">
    <div class="bgcover" style="background-image:url(https://unsplash.it/1920/1080)" alt="Mask R-CNN trong bài toán nhận dạng và phân vùng đối tượng">
      <div class="bgtrans">
          <h1>Mask R-CNN Trong Bài Toán Nhận Dạng Và Phân Vùng Đối Tượng
</h1>
      </div>
  </div>
</div>
  <div class="card-body"><div class="post-meta">
  <span class="post-date" title="created on 2018-10-08 04:19:00 &#43;0700 &#43;07.">
    Oct 8, 2018
  </span><span class="post-reading-time">
    10 min read
  </span><span class="post-taxonomies"><a href="/tags/machine-learning/" class="badge post-taxonomy">Machine learning</a><a href="/tags/deeplearning/" class="badge post-taxonomy">Deeplearning</a><a href="/tags/spark/" class="badge post-taxonomy">Spark</a></span>
</div>
<div class="post-content mb-3"><div class="toc">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#lời-mở-đầu">Lời mở đầu</a></li>
    <li><a href="#sử-dụng-pretrain-model">Sử dụng pretrain model</a></li>
  </ul>
</nav>
  </div>
<h1 id="lời-mở-đầu">Lời mở đầu<a class="anchor ms-1" href="#lời-mở-đầu"><i class="fas fa-link"></i></a></h1>
<p>Phân vùng đối tượng là một bài toán khá phổ biến trong lĩnh vực computer vision. Trong open cv có hỗ trợ cho chúng ta một số hàm để phân vùng đối tượng rất dễ sử dụng. Đặc điểm chung của các hàm này là độ chính xác không được cao cho lắm. Ở bài viết này, chúng ta sẽ tìm hiểu cách sử dụng mô hình pretrain của DNN để phân vùng các đối tượng trong ảnh.</p>
<h1 id="sử-dụng-pretrain-model">Sử dụng pretrain model<a class="anchor ms-1" href="#sử-dụng-pretrain-model"><i class="fas fa-link"></i></a></h1>
<p>Đầu tiên, các bạn download file pretrain model, giải nén ra và để ở đâu đó trong ổ cứng của máy bạn. Đường dẫn file pretrain model các bạn có thể download ở <a href="http://download.tensorflow.org/models/object_detection/mask_rcnn_inception_v2_coco_2018_01_28.tar.gz" target="_blank" rel="noopener noreferrer">http://download.tensorflow.org/models/object_detection/mask_rcnn_inception_v2_coco_2018_01_28.tar.gz</a>. Các bạn có thể download các file pretrain khác nếu có hứng thú tìm hiểu.</p>
<p>Tiếp theo, chúng ta sẽ load mô hình lên:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="kn">import</span> <span class="nn">tarfile</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="kn">import</span> <span class="nn">PIL.ImageDraw</span> <span class="k">as</span> <span class="nn">ImageDraw</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="kn">import</span> <span class="nn">PIL.ImageFont</span> <span class="k">as</span> <span class="nn">ImageFont</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="kn">import</span> <span class="nn">pprint</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="kn">import</span> <span class="nn">PIL.Image</span> <span class="k">as</span> <span class="nn">Image</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="kn">import</span> <span class="nn">PIL.ImageColor</span> <span class="k">as</span> <span class="nn">ImageColor</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"># Model preparation</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="c1"># Path to frozen detection graph. This is the actual model that is used for the object detection.</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="n">PATH_TO_CKPT</span> <span class="o">=</span> <span class="s1">&#39;mask_rcnn_inception_v2_coco_2018_01_28&#39;</span> <span class="o">+</span> <span class="s1">&#39;/frozen_inference_graph.pb&#39;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="c1"># List of the strings that is used to add correct label for each box.</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="c1">#PATH_TO_LABELS = &#39;mscoco_label_map.pbtxt&#39;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="n">NUM_CLASSES</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="c1"># categories</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="n">category_index</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;person&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="c1"># 3: {&#39;id&#39;: 3, &#39;name&#39;: &#39;car&#39;},</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="n">detection_graph</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="k">with</span> <span class="n">detection_graph</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">    <span class="n">od_graph_def</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">GraphDef</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">gfile</span><span class="o">.</span><span class="n">GFile</span><span class="p">(</span><span class="n">PATH_TO_CKPT</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="n">serialized_graph</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="n">od_graph_def</span><span class="o">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="n">serialized_graph</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">        <span class="n">tf</span><span class="o">.</span><span class="n">import_graph_def</span><span class="p">(</span><span class="n">od_graph_def</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>Ở đây, mình chỉ demo detect người trong hình, nên mình chỉ để category_index chỉ là &ldquo;person&rdquo;. Thực tế, mô hình COCO hỗ trợ cho chúng ta nhận dạng 90 loại đối tượng khác nhau, các bạn có nhu cầu tìm hiểu thì thay bằng đoạn mã sau:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">category_index</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;person&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"> <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;bicycle&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"> <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;car&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"> <span class="mi">4</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;motorcycle&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"> <span class="mi">5</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;airplane&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"> <span class="mi">6</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;bus&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"> <span class="mi">7</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;train&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"> <span class="mi">8</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;truck&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"> <span class="mi">9</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;boat&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"> <span class="mi">10</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;traffic light&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"> <span class="mi">11</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;fire hydrant&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"> <span class="mi">13</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;stop sign&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"> <span class="mi">14</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;parking meter&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"> <span class="mi">15</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;bench&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"> <span class="mi">16</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;bird&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"> <span class="mi">17</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;cat&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"> <span class="mi">18</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;dog&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"> <span class="mi">19</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;horse&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"> <span class="mi">20</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sheep&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"> <span class="mi">21</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;cow&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"> <span class="mi">22</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;elephant&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"> <span class="mi">23</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;bear&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"> <span class="mi">24</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;zebra&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"> <span class="mi">25</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;giraffe&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"> <span class="mi">27</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">27</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;backpack&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"> <span class="mi">28</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;umbrella&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"> <span class="mi">31</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;handbag&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"> <span class="mi">32</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;tie&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl"> <span class="mi">33</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;suitcase&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl"> <span class="mi">34</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;frisbee&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"> <span class="mi">35</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;skis&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"> <span class="mi">36</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">36</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;snowboard&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"> <span class="mi">37</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">37</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sports ball&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"> <span class="mi">38</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">38</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;kite&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"> <span class="mi">39</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">39</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;baseball bat&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl"> <span class="mi">40</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;baseball glove&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl"> <span class="mi">41</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">41</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;skateboard&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"> <span class="mi">42</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;surfboard&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"> <span class="mi">43</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">43</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;tennis racket&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl"> <span class="mi">44</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">44</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;bottle&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl"> <span class="mi">46</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">46</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;wine glass&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl"> <span class="mi">47</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">47</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;cup&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl"> <span class="mi">48</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">48</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;fork&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl"> <span class="mi">49</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;knife&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"> <span class="mi">50</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;spoon&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl"> <span class="mi">51</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">51</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;bowl&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl"> <span class="mi">52</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">52</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;banana&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl"> <span class="mi">53</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;apple&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl"> <span class="mi">54</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">54</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sandwich&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl"> <span class="mi">55</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;orange&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl"> <span class="mi">56</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">56</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;broccoli&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl"> <span class="mi">57</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">57</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;carrot&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl"> <span class="mi">58</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">58</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;hot dog&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl"> <span class="mi">59</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">59</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;pizza&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl"> <span class="mi">60</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;donut&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl"> <span class="mi">61</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">61</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;cake&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl"> <span class="mi">62</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">62</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;chair&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl"> <span class="mi">63</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;couch&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl"> <span class="mi">64</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;potted plant&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl"> <span class="mi">65</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;bed&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl"> <span class="mi">67</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">67</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;dining table&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl"> <span class="mi">70</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;toilet&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl"> <span class="mi">72</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">72</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;tv&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl"> <span class="mi">73</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">73</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;laptop&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl"> <span class="mi">74</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">74</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;mouse&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">66</span><span class="cl"> <span class="mi">75</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;remote&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl"> <span class="mi">76</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">76</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;keyboard&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">68</span><span class="cl"> <span class="mi">77</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">77</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;cell phone&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">69</span><span class="cl"> <span class="mi">78</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">78</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;microwave&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl"> <span class="mi">79</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">79</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;oven&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">71</span><span class="cl"> <span class="mi">80</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;toaster&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">72</span><span class="cl"> <span class="mi">81</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">81</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;sink&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">73</span><span class="cl"> <span class="mi">82</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">82</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;refrigerator&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">74</span><span class="cl"> <span class="mi">84</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">84</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;book&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">75</span><span class="cl"> <span class="mi">85</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">85</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;clock&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">76</span><span class="cl"> <span class="mi">86</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">86</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;vase&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">77</span><span class="cl"> <span class="mi">87</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">87</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;scissors&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">78</span><span class="cl"> <span class="mi">88</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">88</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;teddy bear&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">79</span><span class="cl"> <span class="mi">89</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">89</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;hair drier&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">80</span><span class="cl"> <span class="mi">90</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;toothbrush&#39;</span><span class="p">}}</span>
</span></span></code></pre></div><p>Tiếp theo, chúng ta sẽ load một số hàm giúp hỗ trợ việc hậu xử lý ảnh để vẽ các mask cho chúng ta xem trực quan hơn.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">  1</span><span class="cl">
</span></span><span class="line"><span class="ln">  2</span><span class="cl">    <span class="n">draw</span>  <span class="o">=</span>  <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl">    <span class="n">im_width</span><span class="p">,</span>  <span class="n">im_height</span>  <span class="o">=</span>  <span class="n">image</span><span class="o">.</span><span class="n">size</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl">    <span class="k">if</span>  <span class="n">use_normalized_coordinates</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl">        <span class="p">(</span><span class="n">left</span><span class="p">,</span>  <span class="n">right</span><span class="p">,</span>  <span class="n">top</span><span class="p">,</span>  <span class="n">bottom</span><span class="p">)</span>  <span class="o">=</span>  <span class="p">(</span><span class="n">xmin</span>  <span class="o">*</span>  <span class="n">im_width</span><span class="p">,</span>  <span class="n">xmax</span>  <span class="o">*</span>  <span class="n">im_width</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl">                                                                    <span class="n">ymin</span>  <span class="o">*</span>  <span class="n">im_height</span><span class="p">,</span>  <span class="n">ymax</span>  <span class="o">*</span>  <span class="n">im_height</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">        <span class="p">(</span><span class="n">left</span><span class="p">,</span>  <span class="n">right</span><span class="p">,</span>  <span class="n">top</span><span class="p">,</span>  <span class="n">bottom</span><span class="p">)</span>  <span class="o">=</span>  <span class="p">(</span><span class="n">xmin</span><span class="p">,</span>  <span class="n">xmax</span><span class="p">,</span>  <span class="n">ymin</span><span class="p">,</span>  <span class="n">ymax</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl">    <span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">([(</span><span class="n">left</span><span class="p">,</span>  <span class="n">top</span><span class="p">),</span>  <span class="p">(</span><span class="n">left</span><span class="p">,</span>  <span class="n">bottom</span><span class="p">),</span>  <span class="p">(</span><span class="n">right</span><span class="p">,</span>  <span class="n">bottom</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl">                          <span class="p">(</span><span class="n">right</span><span class="p">,</span>  <span class="n">top</span><span class="p">),</span>  <span class="p">(</span><span class="n">left</span><span class="p">,</span>  <span class="n">top</span><span class="p">)],</span>  <span class="n">width</span><span class="o">=</span><span class="n">thickness</span><span class="p">,</span>  <span class="n">fill</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">        <span class="n">font</span>  <span class="o">=</span>  <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="s1">&#39;arial.ttf&#39;</span><span class="p">,</span>  <span class="mi">24</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl">    <span class="k">except</span>  <span class="ne">IOError</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">        <span class="n">font</span>  <span class="o">=</span>  <span class="n">ImageFont</span><span class="o">.</span><span class="n">load_default</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">    <span class="c1">#  If  the  total  height  of  the  display  strings  added  to  the  top  of  the  bounding</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">    <span class="c1">#  box  exceeds  the  top  of  the  image,  stack  the  strings  below  the  bounding  box</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">    <span class="c1">#  instead  of  above.</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">    <span class="n">display_str_heights</span>  <span class="o">=</span>  <span class="p">[</span><span class="n">font</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">ds</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>  <span class="k">for</span>  <span class="n">ds</span>  <span class="ow">in</span>  <span class="n">display_str_list</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">    <span class="c1">#  Each  display_str  has  a  top  and  bottom  margin  of  0.05x.</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">    <span class="n">total_display_str_height</span>  <span class="o">=</span>  <span class="p">(</span><span class="mi">1</span>  <span class="o">+</span>  <span class="mi">2</span>  <span class="o">*</span>  <span class="mf">0.05</span><span class="p">)</span>  <span class="o">*</span>  <span class="nb">sum</span><span class="p">(</span><span class="n">display_str_heights</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">    <span class="k">if</span>  <span class="n">top</span>  <span class="o">&gt;</span>  <span class="n">total_display_str_height</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl">        <span class="n">text_bottom</span>  <span class="o">=</span>  <span class="n">top</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">        <span class="n">text_bottom</span>  <span class="o">=</span>  <span class="n">bottom</span>  <span class="o">+</span>  <span class="n">total_display_str_height</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">    <span class="c1">#  Reverse  list  and  print  from  bottom  to  top.</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">    <span class="k">for</span>  <span class="n">display_str</span>  <span class="ow">in</span>  <span class="n">display_str_list</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">        <span class="n">text_width</span><span class="p">,</span>  <span class="n">text_height</span>  <span class="o">=</span>  <span class="n">font</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">display_str</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">        <span class="n">margin</span>  <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mf">0.05</span>  <span class="o">*</span>  <span class="n">text_height</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">        <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">                <span class="p">[(</span><span class="n">left</span><span class="p">,</span>  <span class="n">text_bottom</span>  <span class="o">-</span>  <span class="n">text_height</span>  <span class="o">-</span>  <span class="mi">2</span>  <span class="o">*</span>  <span class="n">margin</span><span class="p">),</span>  <span class="p">(</span><span class="n">left</span>  <span class="o">+</span>  <span class="n">text_width</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">                                                                                                                    <span class="n">text_bottom</span><span class="p">)],</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">                <span class="n">fill</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">        <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">                <span class="p">(</span><span class="n">left</span>  <span class="o">+</span>  <span class="n">margin</span><span class="p">,</span>  <span class="n">text_bottom</span>  <span class="o">-</span>  <span class="n">text_height</span>  <span class="o">-</span>  <span class="n">margin</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">                <span class="n">display_str</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">                <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">                <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">        <span class="n">text_bottom</span>  <span class="o">-=</span>  <span class="n">text_height</span>  <span class="o">-</span>  <span class="mi">2</span>  <span class="o">*</span>  <span class="n">margin</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">
</span></span><span class="line"><span class="ln"> 44</span><span class="cl"><span class="k">def</span> <span class="nf">visualize_boxes_and_labels_on_image_array</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">        <span class="n">image</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">        <span class="n">boxes</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">        <span class="n">classes</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">        <span class="n">scores</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">        <span class="n">category_index</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">        <span class="n">instance_masks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">        <span class="n">instance_boundaries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">        <span class="n">keypoints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">        <span class="n">use_normalized_coordinates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl">        <span class="n">max_boxes_to_draw</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">        <span class="n">min_score_thresh</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">        <span class="n">agnostic_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">        <span class="n">line_thickness</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">        <span class="n">groundtruth_box_visualization_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">        <span class="n">skip_scores</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">        <span class="n">skip_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">    <span class="n">box_to_display_str_map</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">    <span class="n">box_to_color_map</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">    <span class="n">box_to_instance_masks_map</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">    <span class="n">box_to_instance_boundaries_map</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">    <span class="n">box_to_keypoints_map</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">max_boxes_to_draw</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">        <span class="n">max_boxes_to_draw</span> <span class="o">=</span> <span class="n">boxes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">    <span class="c1">#print(boxes)</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">max_boxes_to_draw</span><span class="p">,</span> <span class="n">boxes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">        <span class="k">if</span> <span class="n">scores</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">min_score_thresh</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">            <span class="n">box</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">boxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">        <span class="k">if</span> <span class="n">instance_masks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">            <span class="n">box_to_instance_masks_map</span><span class="p">[</span><span class="n">box</span><span class="p">]</span> <span class="o">=</span> <span class="n">instance_masks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">        <span class="k">if</span> <span class="n">instance_boundaries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">            <span class="n">box_to_instance_boundaries_map</span><span class="p">[</span><span class="n">box</span><span class="p">]</span> <span class="o">=</span> <span class="n">instance_boundaries</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">        <span class="k">if</span> <span class="n">keypoints</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">            <span class="n">box_to_keypoints_map</span><span class="p">[</span><span class="n">box</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">keypoints</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">        <span class="k">if</span> <span class="n">scores</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">            <span class="n">box_to_color_map</span><span class="p">[</span><span class="n">box</span><span class="p">]</span> <span class="o">=</span> <span class="n">groundtruth_box_visualization_color</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">            <span class="n">display_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_labels</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">                <span class="k">if</span> <span class="ow">not</span> <span class="n">agnostic_mode</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">                    <span class="k">if</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">category_index</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">                        <span class="n">class_name</span> <span class="o">=</span> <span class="n">category_index</span><span class="p">[</span><span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">                    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">                        <span class="n">class_name</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">                    <span class="n">display_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">class_name</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_scores</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">                <span class="k">if</span> <span class="ow">not</span> <span class="n">display_str</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">                    <span class="n">display_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">scores</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">                    <span class="n">display_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">                        <span class="n">display_str</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">scores</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">            <span class="n">box_to_display_str_map</span><span class="p">[</span><span class="n">box</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">display_str</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">            <span class="k">if</span> <span class="n">agnostic_mode</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">                <span class="n">box_to_color_map</span><span class="p">[</span><span class="n">box</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;DarkOrange&#39;</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">                <span class="n">box_to_color_map</span><span class="p">[</span><span class="n">box</span><span class="p">]</span> <span class="o">=</span> <span class="n">STANDARD_COLORS</span><span class="p">[</span><span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">                                                        <span class="nb">len</span><span class="p">(</span><span class="n">STANDARD_COLORS</span><span class="p">)]</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">
</span></span><span class="line"><span class="ln">103</span><span class="cl">    <span class="c1"># Draw all boxes onto image.</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">    <span class="k">for</span> <span class="n">box</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">box_to_color_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">        <span class="n">ymin</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">box</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">        <span class="k">if</span> <span class="n">instance_masks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">            <span class="n">draw_mask_on_image_array</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">box_to_instance_masks_map</span><span class="p">[</span><span class="n">box</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl">
</span></span><span class="line"><span class="ln">109</span><span class="cl">        <span class="n">draw_bounding_box_on_image_array</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">        <span class="n">image</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">        <span class="n">ymin</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">        <span class="n">xmin</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">        <span class="n">ymax</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">        <span class="n">xmax</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">        <span class="n">thickness</span><span class="o">=</span><span class="n">line_thickness</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">        <span class="n">display_str_list</span><span class="o">=</span><span class="n">box_to_display_str_map</span><span class="p">[</span><span class="n">box</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl">        <span class="n">use_normalized_coordinates</span><span class="o">=</span><span class="n">use_normalized_coordinates</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">
</span></span><span class="line"><span class="ln">120</span><span class="cl">    <span class="k">return</span> <span class="n">image</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">
</span></span><span class="line"><span class="ln">122</span><span class="cl">
</span></span><span class="line"><span class="ln">123</span><span class="cl"><span class="k">def</span> <span class="nf">reframe_box_masks_to_image_masks</span><span class="p">(</span><span class="n">box_masks</span><span class="p">,</span>  <span class="n">boxes</span><span class="p">,</span>  <span class="n">image_height</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">                                     <span class="n">image_width</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">    <span class="s2">&#34;&#34;&#34;Transforms  the  box  masks  back  to  full  image  masks.
</span></span></span><span class="line"><span class="ln">126</span><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="ln">127</span><span class="cl"><span class="s2">    Embeds  masks  in  bounding  boxes  of  larger  masks  whose  shapes  correspond  to
</span></span></span><span class="line"><span class="ln">128</span><span class="cl"><span class="s2">    image  shape.
</span></span></span><span class="line"><span class="ln">129</span><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="ln">130</span><span class="cl"><span class="s2">    Args:
</span></span></span><span class="line"><span class="ln">131</span><span class="cl"><span class="s2">        box_masks:  A  tf.float32  tensor  of  size  [num_masks,  mask_height,  mask_width].
</span></span></span><span class="line"><span class="ln">132</span><span class="cl"><span class="s2">        boxes:  A  tf.float32  tensor  of  size  [num_masks,  4]  containing  the  box
</span></span></span><span class="line"><span class="ln">133</span><span class="cl"><span class="s2">                      corners.  Row  i  contains  [ymin,  xmin,  ymax,  xmax]  of  the  box
</span></span></span><span class="line"><span class="ln">134</span><span class="cl"><span class="s2">                      corresponding  to  mask  i.  Note  that  the  box  corners  are  in
</span></span></span><span class="line"><span class="ln">135</span><span class="cl"><span class="s2">                      normalized  coordinates.
</span></span></span><span class="line"><span class="ln">136</span><span class="cl"><span class="s2">        image_height:  Image  height.  The  output  mask  will  have  the  same  height  as
</span></span></span><span class="line"><span class="ln">137</span><span class="cl"><span class="s2">                                    the  image  height.
</span></span></span><span class="line"><span class="ln">138</span><span class="cl"><span class="s2">        image_width:  Image  width.  The  output  mask  will  have  the  same  width  as  the
</span></span></span><span class="line"><span class="ln">139</span><span class="cl"><span class="s2">                                  image  width.
</span></span></span><span class="line"><span class="ln">140</span><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="ln">141</span><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="ln">142</span><span class="cl"><span class="s2">        A  tf.float32  tensor  of  size  [num_masks,  image_height,  image_width].
</span></span></span><span class="line"><span class="ln">143</span><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">    <span class="c1">#  TODO(rathodv):  Make  this  a  public  function.</span>
</span></span><span class="line"><span class="ln">145</span><span class="cl">    <span class="k">def</span> <span class="nf">reframe_box_masks_to_image_masks_default</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">        <span class="s2">&#34;&#34;&#34;The  default  function  when  there  are  more  than  0  box  masks.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl">        <span class="k">def</span> <span class="nf">transform_boxes_relative_to_boxes</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span>  <span class="n">reference_boxes</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">148</span><span class="cl">            <span class="n">boxes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span>  <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">149</span><span class="cl">            <span class="n">min_corner</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">reference_boxes</span><span class="p">[:,</span>  <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span>  <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">150</span><span class="cl">            <span class="n">max_corner</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">reference_boxes</span><span class="p">[:,</span>  <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span>  <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">151</span><span class="cl">            <span class="n">transformed_boxes</span> <span class="o">=</span> <span class="p">(</span><span class="n">boxes</span> <span class="o">-</span> <span class="n">min_corner</span><span class="p">)</span> <span class="o">/</span> \
</span></span><span class="line"><span class="ln">152</span><span class="cl">                <span class="p">(</span><span class="n">max_corner</span> <span class="o">-</span> <span class="n">min_corner</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">153</span><span class="cl">            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">transformed_boxes</span><span class="p">,</span>  <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">4</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">154</span><span class="cl">
</span></span><span class="line"><span class="ln">155</span><span class="cl">        <span class="n">box_masks_expanded</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">box_masks</span><span class="p">,</span>  <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">156</span><span class="cl">        <span class="n">num_boxes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">box_masks_expanded</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">157</span><span class="cl">        <span class="n">unit_boxes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">158</span><span class="cl">            <span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">num_boxes</span><span class="p">,</span>  <span class="mi">2</span><span class="p">]),</span>  <span class="n">tf</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">num_boxes</span><span class="p">,</span>  <span class="mi">2</span><span class="p">])],</span>  <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">159</span><span class="cl">        <span class="n">reverse_boxes</span> <span class="o">=</span> <span class="n">transform_boxes_relative_to_boxes</span><span class="p">(</span><span class="n">unit_boxes</span><span class="p">,</span>  <span class="n">boxes</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">160</span><span class="cl">        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">crop_and_resize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">161</span><span class="cl">            <span class="n">image</span><span class="o">=</span><span class="n">box_masks_expanded</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">162</span><span class="cl">            <span class="n">boxes</span><span class="o">=</span><span class="n">reverse_boxes</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">163</span><span class="cl">            <span class="n">box_ind</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">num_boxes</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">164</span><span class="cl">            <span class="n">crop_size</span><span class="o">=</span><span class="p">[</span><span class="n">image_height</span><span class="p">,</span>  <span class="n">image_width</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">165</span><span class="cl">            <span class="n">extrapolation_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">166</span><span class="cl">    <span class="n">image_masks</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">167</span><span class="cl">        <span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">box_masks</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">168</span><span class="cl">        <span class="n">reframe_box_masks_to_image_masks_default</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">169</span><span class="cl">        <span class="k">lambda</span><span class="p">:</span>  <span class="n">tf</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span>  <span class="n">image_height</span><span class="p">,</span>  <span class="n">image_width</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span>  <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">170</span><span class="cl">    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">image_masks</span><span class="p">,</span>  <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></div><p>Cho hình ảnh vào và rút ra kết quả.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">def</span> <span class="nf">detect_frame</span><span class="p">(</span><span class="n">image_np</span><span class="p">,</span> <span class="n">sess</span><span class="p">,</span> <span class="n">detection_graph</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">with</span> <span class="n">detection_graph</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="n">ops</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_default_graph</span><span class="p">()</span><span class="o">.</span><span class="n">get_operations</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="n">all_tensor_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">output</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">ops</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">op</span><span class="o">.</span><span class="n">outputs</span><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="n">tensor_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">            <span class="s1">&#39;num_detections&#39;</span><span class="p">,</span> <span class="s1">&#39;detection_boxes&#39;</span><span class="p">,</span> <span class="s1">&#39;detection_scores&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">            <span class="s1">&#39;detection_classes&#39;</span><span class="p">,</span> <span class="s1">&#39;detection_masks&#39;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="p">]:</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">            <span class="n">tensor_name</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;:0&#39;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">            <span class="k">if</span> <span class="n">tensor_name</span> <span class="ow">in</span> <span class="n">all_tensor_names</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">                <span class="n">tensor_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_default_graph</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">                <span class="p">)</span><span class="o">.</span><span class="n">get_tensor_by_name</span><span class="p">(</span><span class="n">tensor_name</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">if</span> <span class="s1">&#39;detection_masks&#39;</span> <span class="ow">in</span> <span class="n">tensor_dict</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">            <span class="c1"># The following processing is only for single image</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="n">detection_boxes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">tensor_dict</span><span class="p">[</span><span class="s1">&#39;detection_boxes&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="n">detection_masks</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">tensor_dict</span><span class="p">[</span><span class="s1">&#39;detection_masks&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="c1"># Reframe is required to translate mask from box coordinates to image coordinates and fit the image size.</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="n">real_num_detection</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">                <span class="n">tensor_dict</span><span class="p">[</span><span class="s1">&#39;num_detections&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="n">detection_boxes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">detection_boxes</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">                                       <span class="n">real_num_detection</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="n">detection_masks</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">detection_masks</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">                                       <span class="n">real_num_detection</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="n">detection_masks_reframed</span> <span class="o">=</span> <span class="n">reframe_box_masks_to_image_masks</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">                <span class="n">detection_masks</span><span class="p">,</span> <span class="n">detection_boxes</span><span class="p">,</span> <span class="n">image_np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image_np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">            <span class="n">detection_masks_reframed</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">                <span class="n">tf</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">detection_masks_reframed</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="c1"># Follow the convention by adding back the batch dimension</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="n">tensor_dict</span><span class="p">[</span><span class="s1">&#39;detection_masks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">                <span class="n">detection_masks_reframed</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="n">image_tensor</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_default_graph</span><span class="p">()</span><span class="o">.</span><span class="n">get_tensor_by_name</span><span class="p">(</span><span class="s1">&#39;image_tensor:0&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">      <span class="c1"># Run inference</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="n">output_dict</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tensor_dict</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">                               <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">image_tensor</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">image_np</span><span class="p">,</span> <span class="mi">0</span><span class="p">)})</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">
</span></span><span class="line"><span class="ln">42</span><span class="cl">      <span class="c1"># all outputs are float32 numpy arrays, so convert types as appropriate</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="n">output_dict</span><span class="p">[</span><span class="s1">&#39;num_detections&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">output_dict</span><span class="p">[</span><span class="s1">&#39;num_detections&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">        <span class="c1">#print(&#34;num detect &#34;+str(output_dict[&#39;num_detections&#39;]))</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">        <span class="n">output_dict</span><span class="p">[</span><span class="s1">&#39;detection_classes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_dict</span><span class="p">[</span><span class="s1">&#39;detection_classes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">            <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">        <span class="n">output_dict</span><span class="p">[</span><span class="s1">&#39;detection_boxes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_dict</span><span class="p">[</span><span class="s1">&#39;detection_boxes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">        <span class="n">output_dict</span><span class="p">[</span><span class="s1">&#39;detection_scores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_dict</span><span class="p">[</span><span class="s1">&#39;detection_scores&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">        <span class="k">if</span> <span class="s1">&#39;detection_masks&#39;</span> <span class="ow">in</span> <span class="n">output_dict</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">            <span class="n">output_dict</span><span class="p">[</span><span class="s1">&#39;detection_masks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_dict</span><span class="p">[</span><span class="s1">&#39;detection_masks&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">
</span></span><span class="line"><span class="ln">52</span><span class="cl">        <span class="n">visualize_boxes_and_labels_on_image_array</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">            <span class="n">image_np</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">            <span class="n">output_dict</span><span class="p">[</span><span class="s1">&#39;detection_boxes&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">            <span class="n">output_dict</span><span class="p">[</span><span class="s1">&#39;detection_classes&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">            <span class="n">output_dict</span><span class="p">[</span><span class="s1">&#39;detection_scores&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">            <span class="n">category_index</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">            <span class="n">instance_masks</span><span class="o">=</span><span class="n">output_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;detection_masks&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">            <span class="n">use_normalized_coordinates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">            <span class="n">line_thickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">            <span class="n">max_boxes_to_draw</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">output_dict</span><span class="p">[</span><span class="s1">&#39;num_detections&#39;</span><span class="p">],</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">
</span></span><span class="line"><span class="ln">64</span><span class="cl">    <span class="k">return</span> <span class="n">image_np</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;img2.jpg&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">with</span> <span class="n">detection_graph</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">detection_graph</span><span class="p">)</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">        <span class="n">image_np</span> <span class="o">=</span> <span class="n">detect_frame</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sess</span><span class="p">,</span> <span class="n">detection_graph</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s1">&#39;output.jpg&#39;</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
</span></span></code></pre></div><p>Kết quả file output.jpg của chúng ta là:</p>
<p><img class="img-fluid" alt="Phân vùng của mark ca sĩ midu" src="/blog/2018-10-08-mask-rnn/mask_rnn_output_mieule.jpg" loading="lazy"  title="Phân vùng của mark ca sĩ midu"
  
   />

</p>
<p>Thử với bức ảnh người và xe hơi.</p>
<p><img class="img-fluid" alt="Phân vùng của người và xe hơi" src="/blog/2018-10-08-mask-rnn/mask_rnn_output_nguoidep_xehoi.jpg" loading="lazy"  title="Phân vùng của người và xe hơi"
  
   />

</p>
<p>Cảm ơn các bạn đã theo dõi. Hẹn gặp bạn ở các bài viết tiếp theo.</p>
</div></div>
  <div class="card-footer"><div class="post-navs d-flex justify-content-evenly"><div class="post-nav post-prev">
    <i class="fas fa-fw fa-chevron-left"></i>
    <a href="/blog/2018-10-05-deep-learning-base-multiple-human-pose-estimation/">Deep Learning Based Multiple Human Pose Estimation Using OpenCV
</a>
  </div><div class="post-nav post-next">
    <a href="/blog/2018-10-29-phan-loai-cho-meo/">Phân Loại Chó Mèo Sử Dụng Pretrain Model
</a>
    <i class="fas fa-fw fa-chevron-right"></i>
  </div></div></div>
</article><div class="card component row post-comments" id="post-comments">
  <div class="card-header">
    <h2 class="card-title">Comments</h2>
  </div>
  <div class="card-body"><script src="https://utteranc.es/client.js"
  repo="AlexBlack2202/utterances"
  issue-term="pathname"
  label="comment"
  theme="github-dark"
  crossorigin="anonymous"
  async>
</script></div>
</div></div>
</div><aside class="col-lg-3 col-md-4 sidebar d-flex">
  <div class="container d-flex flex-column">
    
    <div class="post-toc row mb-4 card component" id="postTOC">
  <div class="card-header">
    <h2 class="card-title">Contents</h2>
  </div>
  <div class="card-body">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#lời-mở-đầu">Lời mở đầu</a></li>
    <li><a href="#sử-dụng-pretrain-model">Sử dụng pretrain model</a></li>
  </ul>
</nav>
  </div>
</div><section class="recent-posts row card component">
  <div class="card-header">
    <h2 class="card-title">Recent Posts</h2>
  </div>
  <div class="card-body">
    <ul class="post-list"><li>
        <a href="/blog/2025-04-29-etting-off-work-at-6-pm-is-already-quite-late/">Tan Làm Lúc 6 Giờ Tối Đã Là Khá Muộn Rồi - Quản Lý Thời Gian – Sống Trọn Vẹn – Quyền Được Nghỉ Ngơi Của Người Trẻ
</a>
      </li><li>
        <a href="/blog/2025-04-28-structured-prompt-outputs/">Machine Learning - Sử Dụng Structured Prompt Outputs Để Tối Ưu Hóa Kết Quả Từ LLMs
</a>
      </li><li>
        <a href="/blog/2025-04-26-phishing-email/">Machine Learning - Train Mô Hình Nhận Dạng Email Lừa Đảo
</a>
      </li><li>
        <a href="/blog/2025-04-26-how-brands-grow/">Khám Phá Bí Mật Đằng Sau Sự Thành Công Của Các Thương Hiệu
</a>
      </li><li>
        <a href="/blog/2025-04-20-ai-viet-truyen-tuyet-giac-truc-lam/">Tuyết Giác Trúc Lâm - Truyện AI
</a>
      </li></ul>
  </div>
</section><section class="series-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/series">series</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/series/kh%C3%B3a-h%E1%BB%8Dc-python-c%C4%83n-b%E1%BA%A3n/" class="badge rounded post-taxonomy" title="Khóa Học Python Căn Bản">
            Khóa Học Python Căn Bản<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/series/kh%C3%B3a-h%E1%BB%8Dc-c&#43;&#43;-c%C4%83n-b%E1%BA%A3n/" class="badge rounded post-taxonomy" title="Khóa Học C&#43;&#43; Căn Bản">
            Khóa Học C&#43;&#43; Căn Bản<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/series/machine-learning-dataset/" class="badge rounded post-taxonomy" title="Machine Learning Dataset">
            Machine Learning Dataset<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href="/series/ch%E1%BB%A9ng-kho%C3%A1n-c%C4%83n-b%E1%BA%A3n/" class="badge rounded post-taxonomy" title="Chứng Khoán Căn Bản">
            Chứng Khoán Căn Bản<span class="badge badge-sm text-white bg-accent ms-1">1</span></a></div>
      </div>
    </section><section class="tools-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/tools">tools</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/tools/tool-random/" class="badge rounded post-taxonomy" title="Tool Random">
            Tool Random<span class="badge badge-sm text-white bg-accent ms-1">2</span></a></div>
      </div>
    </section><section class="categories-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/categories">categories</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/categories/python/" class="badge rounded post-taxonomy" title="Python">
            Python<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/categories/c&#43;&#43;/" class="badge rounded post-taxonomy" title="C&#43;&#43;">
            C&#43;&#43;<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/categories/dataset/" class="badge rounded post-taxonomy" title="Dataset">
            Dataset<span class="badge badge-sm text-white bg-accent ms-1">2</span></a></div>
      </div>
    </section><section class="tags-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/tags">tags</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/tags/machine-learning/" class="badge rounded post-taxonomy" title="Machine Learning">
            Machine Learning<span class="badge badge-sm text-white bg-accent ms-1">45</span></a><a href="/tags/deep-learning/" class="badge rounded post-taxonomy" title="Deep Learning">
            Deep Learning<span class="badge badge-sm text-white bg-accent ms-1">21</span></a><a href="/tags/deeplearning/" class="badge rounded post-taxonomy" title="DeepLearning">
            DeepLearning<span class="badge badge-sm text-white bg-accent ms-1">21</span></a><a href="/tags/python/" class="badge rounded post-taxonomy" title="Python">
            Python<span class="badge badge-sm text-white bg-accent ms-1">11</span></a><a href="/tags/opencv/" class="badge rounded post-taxonomy" title="Opencv">
            Opencv<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/tags/c&#43;&#43;/" class="badge rounded post-taxonomy" title="C&#43;&#43;">
            C&#43;&#43;<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/marketing/" class="badge rounded post-taxonomy" title="Marketing">
            Marketing<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/normalization/" class="badge rounded post-taxonomy" title="Normalization">
            Normalization<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/object-detector/" class="badge rounded post-taxonomy" title="Object Detector">
            Object Detector<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/recommendation/" class="badge rounded post-taxonomy" title="Recommendation">
            Recommendation<span class="badge badge-sm text-white bg-accent ms-1">4</span></a></div>
      </div>
    </section>
    
  </div>
</aside>
</div>
    </main><footer class="footer mt-auto py-3 text-center container"><ul class="nav justify-content-between footer-memu mb-3"><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Support
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-github"></i>Repository
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-comments"></i>Discussions
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="/contact/"><i class="fas fa-fw fa-info-circle"></i>Contact Us
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="/faq/"><i class="fas fa-fw fa-question-circle"></i>FAQs
</a>
        </li></ul></li><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Docs
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="/team_of_services" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-users"></i>Điều khoản sử dụng
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="/privacy" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-lock"></i>Chính sách bảo mật
</a>
        </li></ul></li><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Features
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="https://www.phamduytung.com/utils/gen_paswords/" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-paw"></i>Tạo password ngẫu nhiên
</a>
        </li></ul></li><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Liên kết khác
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">Netlify
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">facebook
</a>
        </li></ul></li></ul>
<div class="copyright mb-2">
  Copyright © 2016-2025 Phạm Duy Tùng. All Rights Reserved.
</div>
<div class="powered-by mb-2">
  Website chia sẻ kiến thức của Phạm Duy Tùng và Đặng Thị Hằng. Vui lòng liên hệ email alexblack2202@gmail.com nếu bạn có thông tin cần trao đổi.
</div></footer>
<script src="/js/main.ed2053ad82a243b263761567b5c1aaf974487aa84adacb89ae3ddf803ecc248a.js" integrity="sha256-7SBTrYKiQ7JjdhVntcGq&#43;XRIeqhK2suJrj3fgD7MJIo=" crossorigin="anonymous" defer></script><script src="/js/icons.min.8ff200851002b8138e6b35314683092e02edc155465d9dbfb7d115460f8f1fbe.js" integrity="sha256-j/IAhRACuBOOazUxRoMJLgLtwVVGXZ2/t9EVRg&#43;PH74=" crossorigin="anonymous" defer></script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('\/service-worker.js').then(function(reg) {
      console.log('Successfully registered service worker', reg);
    }).catch(function(err) {
      console.warn('Error whilst registering service worker', err);
    });
  });
}
</script><script src="/js/viewer.min.ec58d2aa1a8916addf393be975fdf0070e8c872b0caef1673cb9f7eea067ce57.js" integrity="sha256-7FjSqhqJFq3fOTvpdf3wBw6MhysMrvFnPLn37qBnzlc=" crossorigin="anonymous" defer></script><script defer src="/js/katex.min.d5052035160facae59b60000106771baf2eb7671123813d21f1097a5a9218b6e.js" integrity="sha256-1QUgNRYPrK5ZtgAAEGdxuvLrdnESOBPSHxCXpakhi24=" crossorigin="anonymous"></script>

<script  data-ad-client="ca-pub-4644989745435991"  async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4644989745435991"
     crossorigin="anonymous"></script><script data-cfasync="false" type="text/javascript" data-adel="atag" src="//acscdn.com/script/atg.js" czid="eul3gyjdmm"></script>
  </body>
</html>
