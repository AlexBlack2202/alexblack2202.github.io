<!doctype html><html lang="en" data-palette="blue"
   data-mode="dark">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hệ thống gợi ý khoá học cho website DonorChoose.org - Phạm Duy Tùng Machine Learning Blog</title>
    <meta name="a.validate.02" content="1QZXZ8oi7g57H-GxBrBPkTYBydwii-Ic9iJu" /><link rel="apple-touch-icon" href="/images/icons/icon-180x180.png" sizes="180x180">
<link rel="icon" href="/images/icons/icon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="/images/icons/icon-16x16.png" sizes="16x16" type="image/png">
<link rel="icon" href="/images/icons/favicon.ico">
<link rel="manifest" href="/manifest.json">
<meta name="keywords" content="" />
<meta name="description" content="Ở bài viết này, chúng ta tìm hiểu một số mẹo khi huấn luyện mô hình sử dụng deep learning." /><meta name="robots" content="index, follow" />
  <meta itemprop="name" content="Hệ thống gợi ý khoá học cho website DonorChoose.org">
  <meta itemprop="description" content="Ở bài viết này, chúng ta tìm hiểu một số mẹo khi huấn luyện mô hình sử dụng deep learning.">
  <meta itemprop="datePublished" content="2018-12-11T00:19:00+03:00">
  <meta itemprop="dateModified" content="2018-12-11T00:19:00+03:00">
  <meta itemprop="wordCount" content="4032">
  <meta itemprop="keywords" content="Machine Learning,DeepLearning,Recommender System"><meta property="og:url" content="/blog/2019-01-03-donor-project-matching-with-recommender-systems/">
  <meta property="og:site_name" content="Phạm Duy Tùng Machine Learning Blog">
  <meta property="og:title" content="Hệ thống gợi ý khoá học cho website DonorChoose.org">
  <meta property="og:description" content="Ở bài viết này, chúng ta tìm hiểu một số mẹo khi huấn luyện mô hình sử dụng deep learning.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2018-12-11T00:19:00+03:00">
    <meta property="article:modified_time" content="2018-12-11T00:19:00+03:00">
    <meta property="article:tag" content="Machine Learning">
    <meta property="article:tag" content="DeepLearning">
    <meta property="article:tag" content="Recommender System">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Hệ thống gợi ý khoá học cho website DonorChoose.org">
  <meta name="twitter:description" content="Ở bài viết này, chúng ta tìm hiểu một số mẹo khi huấn luyện mô hình sử dụng deep learning.">
<meta property="og:image" content="/images/logo.png"/>
  <meta name="twitter:image" content="/images/logo.png"/><link rel="stylesheet" href="/css/main.min.c06cf34535ee1f60ba08893b4d57e76b2bbd5e11c17ab12ef976f02983a51b54.css" integrity="sha256-wGzzRTXuH2C6CIk7TVfnayu9XhHBerEu&#43;XbwKYOlG1Q=" crossorigin="anonymous"><link rel="stylesheet" href="/css/katex.min.d080a89e03e1eb850f547d835c186b4273f69879aa497eb8b0e88c1578bf1f0b.css" integrity="sha256-0ICongPh64UPVH2DXBhrQnP2mHmqSX64sOiMFXi/Hws=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/viewer.min.3d228794bcedbbfa0412beb8fbc1ec6973202945e42af7004f742a4d7bd620ab.css" integrity="sha256-PSKHlLztu/oEEr64&#43;8HsaXMgKUXkKvcAT3QqTXvWIKs=" crossorigin="anonymous"><style>
    .bgcover {
        display: block;
        overflow: hidden;
        height: 450px;
        background: no-repeat center center;
        -webkit-background-size: cover;
        -moz-background-size: cover;
        -o-background-size: cover;
        background-size: cover;
        position: relative;
        margin-bottom: -65px;
    }
    .bgcover {
        margin-bottom: 0 !important;
    }

    .bgcover .bgtrans {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        display: block;
        overflow: hidden;
        height: inherit;
        background: rgba(0,0,0,.8);
        background: -webkit-gradient(linear,0% 0%,0% 100%,from(rgba(0,0,0,.8)),to (rgba(0,0,0,.6)),to(rgba(255,255,255,0)));
        background: -webkit-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
        background: -moz-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
        background: -ms-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
        background: -o-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
    }

    .bgcover .bgtrans h1 {
        display: block;
        overflow: hidden;
        font-size: 45px;
        line-height: 55px;
        color: #fff;
        width: 800px;
        margin: auto;
        position: absolute;
        left: 0;
        right: 0;
        bottom: 50px;
        font-family: 'Roboto Condensed',sans-serif;
        font-weight: 600;
    }
</style></head>
  <body><script>const items=["mode","palette"];items.forEach(function(e){const t=localStorage.getItem("hbs-"+e);t&&document.body.parentElement.setAttribute("data-"+e,t)})</script><header><nav class="navbar top-app-bar top-app-bar-expand-lg fixed-top">
  <div class="container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button><a class="navbar-brand flex-grow-1 flex-lg-grow-0 text-center text-lg-start mx-auto me-lg-3" href="/"><img class="logo" alt="Logo" src="/images/logo.webp" loading="lazy"  title="Logo"
   width="400" height="400"
   />
HOME
    </a>
    <div class="offcanvas offcanvas-bottom surface" tabindex="-1" id="offcanvasSocialShare" aria-labelledby="offcanvasSocialShare">
  <div class="offcanvas-header">
    <h3 class="offcanvas-title">Share</h3>
    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="offcanvas-body">
    <a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Twitter Share Button"
      target="_blank" href="https://twitter.com/intent/tweet?title=H%e1%bb%87%20th%e1%bb%91ng%20g%e1%bb%a3i%20%c3%bd%20kho%c3%a1%20h%e1%bb%8dc%20cho%20website%20DonorChoose.org&url=%2fblog%2f2019-01-03-donor-project-matching-with-recommender-systems%2f">
      <i class="fab fa-fw fa-twitter"></i> Twitter
    </a>
    <a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Facebook Share Button"
      target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=%2fblog%2f2019-01-03-donor-project-matching-with-recommender-systems%2f">
      <i class="fab fa-fw fa-facebook-f"></i> Facebook
    </a>
  </div>
</div>
    <button class="navbar-settings" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSettings"
  aria-controls="offcanvasSettings" aria-label="Toggle settings">
  <i class="fas fa-ellipsis-v"></i>
</button>

<div class="offcanvas offcanvas-end surface h-100" tabindex="-1" id="offcanvasSettings" aria-labelledby="offcanvasSettings">
  <div class="offcanvas-header">
    <h3 class="offcanvas-title">Settings</h3>
    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="offcanvas-body d-flex flex-column">



<section class="setting">
  <form class="font-size-switcher-form row">
    <div class="col-auto">
      <label for="fontSize" class="form-label"><i class="fas fa-fw fa-font"></i> Font Size</label>
    </div>
    <div class="col-auto ms-auto">
      <input type="range" class="form-range" min="-2" max="2" id="fontSize">
    </div>
  </form>
</section>


<section class="setting palettes">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-palette"></i> Palette</label>
    </div>
    <div class="col-auto ms-auto">
      <a id="btnPalette" class="btn btn-sm btn-outline-primary" role="button" aria-label="palettePicker">
        <i class="fas fa-eye-dropper"></i>
      </a>
    </div>
  </form>
  <div class="mt-2 d-flex justify-content-between visually-hidden" id="palettePicker"><button type="button" id="palette-blue" aria-label="Blue"
        class="btn btn-sm w-100 palette" data-palette="blue">
      </button><button type="button" id="palette-blue-gray" aria-label="Blue Gray"
        class="btn btn-sm w-100 palette" data-palette="blue-gray">
      </button><button type="button" id="palette-brown" aria-label="Brown"
        class="btn btn-sm w-100 palette" data-palette="brown">
      </button><button type="button" id="palette-cyan" aria-label="Cyan"
        class="btn btn-sm w-100 palette" data-palette="cyan">
      </button><button type="button" id="palette-green" aria-label="Green"
        class="btn btn-sm w-100 palette" data-palette="green">
      </button><button type="button" id="palette-indigo" aria-label="Indigo"
        class="btn btn-sm w-100 palette" data-palette="indigo">
      </button><button type="button" id="palette-orange" aria-label="Orange"
        class="btn btn-sm w-100 palette" data-palette="orange">
      </button><button type="button" id="palette-pink" aria-label="Pink"
        class="btn btn-sm w-100 palette" data-palette="pink">
      </button><button type="button" id="palette-purple" aria-label="Purple"
        class="btn btn-sm w-100 palette" data-palette="purple">
      </button><button type="button" id="palette-red" aria-label="Red"
        class="btn btn-sm w-100 palette" data-palette="red">
      </button><button type="button" id="palette-teal" aria-label="Teal"
        class="btn btn-sm w-100 palette" data-palette="teal">
      </button><button type="button" id="palette-yellow" aria-label="Yellow"
        class="btn btn-sm w-100 palette" data-palette="yellow">
      </button></div>
</section>
<section class="setting actions d-flex justify-content-around mt-auto overflow-auto">
  <a role="button" class="action action-go-back" href="javascript: window.history.back();">
    <span class="action-icon"><i class="fas fa-2x fa-arrow-left"></i></span> Go back
  </a>
  <a role="button" class="action action-reload-page">
    <span class="action-icon"><i class="fas fa-2x fa-redo-alt"></i></span> Reload
  </a>
  <a role="button" class="action action-copy-url">
    <span class="action-icon"><i class="fas fa-2x fa-link"></i></span> Copy URL
  </a><a class="action action-social-share" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSocialShare"
    aria-controls="offcanvasSocialShare" aria-label="Toggle social share">
    <span class="action-icon"><i class="fas fa-2x fa-share-alt"></i></span> Share
  </a></section>

</div>
</div>

    <div class="collapse navbar-collapse" tabindex="-1" id="navbarSupportedContent" aria-labelledby="navbarSupportedContent">
      <form class="search-bar my-1" action="/search">
  <div class="input-group input-group-sm">
    <span class="btn btn-search disabled position-absolute left-0"><i class="fas fa-fw fa-search"></i></span>
    <input class="form-control rounded-pill" name="q" type="search" aria-label="Search">
  </div>
</form>
      <ul class="navbar-nav ms-auto"><li class="nav-item">
          <a class="nav-link" href="/series/">
            <i class="fas fa-fw fa-columns"></i>Courses
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/tools/">
            <i class="fas fa-fw fa-folder"></i>Tools
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/categories/">
            <i class="fas fa-fw fa-folder"></i>Categories
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/archives/">
            <i class="fas fa-fw fa-file-archive"></i>Archives
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/tags/">
            <i class="fas fa-fw fa-tags"></i>Tags
          </a>
        </li><li class="nav-item dropdown">
          <a class="nav-link" id="navbarDropdownSupport" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-fw fa-chevron-circle-down"></i>Support
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdownSupport"><li>
              <a class="dropdown-item"
                href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">
                Repository
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">
                Discussions
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">
                Features Request
              </a>
            </li><li><hr class="dropdown-divider"></li><li>
              <a class="dropdown-item"
                href="/faq/">
                FAQs
              </a>
            </li></ul>
        </li></ul>
    </div>
  </div>
</nav>
</header>
<main role="main" class="container" style="line-height:1.7em">
      <div class="row content">
<div class="col-lg-9 col-md-8">
  <div class="container"><nav class="row card component" aria-label="breadcrumb">
  <div class="card-body">
    <ol class="breadcrumb "><li class="breadcrumb-item"><a href="/">Home</a></li><li class="breadcrumb-item"><a href="/blog/">Blogs</a></li><li class="breadcrumb-item active">Hệ Thống Gợi Ý Khoá Học Cho Website DonorChoose.org</li></ol>
  </div>
</nav>
<div class="post-panel-wrapper">
  <div class="d-flex flex-column component rounded post-panel">
    
    <a class="action action-panel-toggler" role="button" title="Panel toggler">
      <i class="fas fa-fw fa-chevron-circle-down"></i>
    </a>
    <a id="sidebarToggler" class="action d-none d-lg-block" role="button" title="Sidebar toggler">
  <i class="fas fa-fw fa-expand-alt" data-fa-transform="rotate-45"></i>
</a>

    

    
    
    <a class="action" href="#post-comments" role="button" aria-label="Comments" title="Comments">
  <i class="fas fa-fw fa-comments"></i>
</a>
    <a class="action" href="#postTOC" aria-controls="Table of contents" role="button" title="Table of contents">
  <i class="fas fa-fw fa-list-alt"></i>
</a>
    
  </div>
</div>
<article class="row card component mb-4 post">
  <div class="card-header ">
    <div class="bgcover" style="background-image:url(https://unsplash.it/1920/1080)" alt="Hệ thống gợi ý khoá học cho website DonorChoose.org">
      <div class="bgtrans">
          <h1>Hệ Thống Gợi Ý Khoá Học Cho Website DonorChoose.org
</h1>
      </div>
  </div>
</div>
  <div class="card-body"><div class="post-meta">
  <span class="post-date" title="created on 2018-12-11 04:19:00 &#43;0700 &#43;07.">
    Dec 11, 2018
  </span><span class="post-reading-time">
    19 min read
  </span><span class="post-taxonomies"><a href="/tags/machine-learning/" class="badge post-taxonomy">Machine learning</a><a href="/tags/deeplearning/" class="badge post-taxonomy">Deeplearning</a><a href="/tags/recommender-system/" class="badge post-taxonomy">recommender system</a></span>
</div>
<div class="post-content mb-3"><div class="toc">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#đặt-vấn-đề">Đặt vấn đề</a>
      <ul>
        <li><a href="#phân-tích-dữ-liệu">Phân tích dữ liệu</a></li>
        <li><a href="#xây-dựng-chiến-lược-tiếp-cận-bài-toán">Xây dựng chiến lược tiếp cận bài toán</a></li>
        <li><a href="#1-tiền-xử-lý-dữ-liệu">1. Tiền xử lý dữ liệu</a></li>
        <li><a href="#2-xây-dựng-mô-hình-content-based-filtering">2. Xây dựng mô hình Content-Based Filtering</a>
          <ul>
            <li><a href="#a-xây-dựng-tập-đặc-trưng">a. Xây dựng tập đặc trưng</a></li>
            <li><a href="#b-xây-dựng-mô-hình">b. Xây dựng mô hình</a></li>
          </ul>
        </li>
        <li><a href="#3-collaborative-filtering-model">3. Collaborative Filtering Model</a>
          <ul>
            <li><a href="#a-xây-dựng-ma-trận-donor---project">a. Xây dựng ma trận donor - project</a></li>
            <li><a href="#b-singular-value-decomposition">b. Singular Value Decomposition</a></li>
            <li><a href="#c-xây-dựng-collaborative-filtering-model">c. Xây dựng Collaborative Filtering Model</a></li>
          </ul>
        </li>
        <li><a href="#4-hybrid-method">4. Hybrid Method</a></li>
        <li><a href="#5-đánh-giá-mô-hình">5. Đánh giá mô hình</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
<h1 id="đặt-vấn-đề">Đặt vấn đề<a class="anchor ms-1" href="#đặt-vấn-đề"><i class="fas fa-link"></i></a></h1>
<p>DonorsChoose.org được thành lập vào năm 2000 bởi một giáo viên lịch sử tại Mỹ tên là Bronx và đã huy động được 685 triệu đô la cho các lớp học. 3/4 các giáo viên ở các trường công lập ở Hoa Kỳ đã sử dụng Donor để gửi các yêu cầu bài tập cho học sinh. Từ đó, Donor trở thành nền tảng giáo dục hàng đầu hỗ trợ cho các vấn đề giáo dục công cộng.</p>
<p>Đến nay, hơn 3 triệu người dùng và đối tác đã đóng góp hơn 1,1 triệu dự án cho Donor. Nhưng các giáo viên vẫn phải tốn hàng tỷ đô tiền túi để chuẩn bị các dụng cụ học tập trên lớp (để truyền tải kiến thức cho học sinh).</p>
<p>Giải pháp được đưa ra ở đây là xây dựng một chiến dịch gợi ý cho các nhà tại trợ.</p>
<h2 id="phân-tích-dữ-liệu">Phân tích dữ liệu<a class="anchor ms-1" href="#phân-tích-dữ-liệu"><i class="fas fa-link"></i></a></h2>
<p>Chúng ta có các file sau:</p>
<p>File Donations.csv.  Với mỗi dự án (Project ID), sẽ có 1 hoặc nhiều nhà quyên góp (Donor ID) mỗi cặp (dự án - nhà quyên góp sẽ định dang bằng 1 mã chung (Donation ID) và có các cột thông tin liên quan đến việc quyên góp đó). File có xấp xỉ 4.67 triệu dòng (chính xác là 4687844 dòng) và 7 cột. (Project ID - Định danh dự án, Donation ID - Định danh khoảng đóng góp (tưởng tượng như khoá tự tăng của bảng này đó các bạn), Donor ID - Mã định danh người đóng góp, Donation Included Option - hỗ trợ website donoschoose 15% giá trị quyên góp, Donation Amount - Số tiền quyên góp, Donor Cart Sequence - Thứ tự của dự án trọng bảng danh sách quyên góp,Donation Received Date - Ngày giờ quyên góp).</p>
<p>File Donors.csv. File định danh người quyên góp. Chứa tổng cộng hơn 2 triệu dòng( chính xác là 2122640 dòng)
File có kích thước 2122640 x 5 với các thông tin cột là Donor ID (khoá chính, không trùng), Donor City (tên thành phố nhà đầu tư đang sinh sống), Donor State (tiểu bang mà người quyên góp đang sống), Donor is teacher, Donor Zip (3 ký tự đầu của mã bưu điện nhà từ thiện).</p>
<p>File Teacher.csv. File có tổng cộng 402900 dòng với các cột TeachId, Teacher Prefix (Mr, Mrs, Ms), Teacher First Project Posted Date.</p>
<p>File Schools.csv. File có tổng cộng 72994 dòng với các cột là SchoolID, SchoolName (tên trường có thể trùng nhau), School Metro Type ( phân loại trường thuộc 1 trong 5 nhóm : suburnban - ngoại ô, rural - nông thôn, uban - thành thị, town - thị trấn, unknow), School Percentage Free Lunch ( Số nguyên, mô tả tỷ lệ phần trăm số học sinh đủ điều kiện ăn trưa miễn phí hoặc ăn trưa giảm phí. Dữ liệu thu được cung cấp bởi một đối tác thống kê độc lập là NCES. Nếu trường nào không có giá trị do NCES cung cấp, chúng ta sẽ lấy số phần trăm này là trung bình phần trăm của các trường cùng huyện), School State (Trường đang toạ lạc ở bang nào (vd cali, Florida, Virginia, &hellip;)), School Zip (mã bưu chính), School City, School County</p>
<p>File Resources.csv. Với mỗi dự án, chúng ta cần các loại tài nguyên khác nhau. Các cột là Project ID (mã dự án), Resource Item Name (tên tài nguyên cần cho dự án đó vd project 000009891526c0ade7180f8423792063 cần &lsquo;chair move and store cart&rsquo;), Resource Quantity (số lượng tài nguyên cần, vd cần 1 cái ghế, 2 cái bảng v.v),
Resource Unit Price (đơn giá cho 1 đơn vị tài nguyên, vd cái ghế giá 7 ngàn, cái bảng giá 10 ngàn, nếu 1 unit là ghế + bảng thì là 17 ngàn), Resource Vendor Name(nhà cung cấp, vd: Amazon Business, Woodwind and Brasswind).</p>
<p>File Projects.csv</p>
<h2 id="xây-dựng-chiến-lược-tiếp-cận-bài-toán">Xây dựng chiến lược tiếp cận bài toán<a class="anchor ms-1" href="#xây-dựng-chiến-lược-tiếp-cận-bài-toán"><i class="fas fa-link"></i></a></h2>
<p>Hãy xem đây như là bài toán gợi ý. Và Donors chính là hệ thống cung cấp các sản phẩm. Ví dụ đơn giản là bạn có website nghe nhạc mp3.zing.vn, alice vào nghe một hoặc một vài bài nhạc. Chúng ta sẽ xây dựng một hệ gợi ý những bài nhạc tiếp theo alice nên nghe dựa vào những bài nhạc đã nghe trước đó của alice. Tương tự vậy, hệ thống Donor như là website mp3.zing, bài nhạc tương tự như các project đang có, người dùng tương tự như các nhà tự thiện. Một khi một nhà từ thiện đã quyên góp cho 1 hoặc 1 nhón các dự án, chúng ta sẽ lên kế hoạch và gợi ý cho khác hàng dự án tiếp theo khách hàng nên tìm hiểu kỹ để xét xem có nên donate hay không.</p>
<p>Dựa vào các chiến lược trên, chúng ta có 3 cách có thể tiếp cận vấn đề:</p>
<ul>
<li>Content-based filltering.</li>
<li>Collaborative Filtering</li>
<li>Hybrid methods</li>
</ul>
<h2 id="1-tiền-xử-lý-dữ-liệu">1. Tiền xử lý dữ liệu<a class="anchor ms-1" href="#1-tiền-xử-lý-dữ-liệu"><i class="fas fa-link"></i></a></h2>
<p>Trước khi bắt đầu xây dựng chương trình gợi ý, chúng ta cần phải load dữ liệu lên bộ nhớ chính và làm sạch dữ liệu.</p>
<p>Trước tiên, chúng ta sẽ import các thư viện cần thiết. Nếu thiếu các thư viện nào, các bạn cứ pip install tên thư viện trong cmd/terminal là được</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">import</span> <span class="nn">scipy</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kn">import</span> <span class="nn">math</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kn">import</span> <span class="nn">sklearn</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">cosine_similarity</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">svds</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span></code></pre></div><p>Tiếp theo, chúng ta sẽ load 3 file Projects.csv, Donations.csv, Donors.csv lên và merge donations với donors.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># Set up test mode to save some time</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">test_mode</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"># Read datasets</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">projects</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../input/Projects.csv&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">donations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../input/Donations.csv&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">donors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../input/Donors.csv&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1">#this piece of code converts Project_ID which is a 32-bit Hex int digits 10-1010</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"># create column &#34;project_id&#34; with sequential integers</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">f</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">projects</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">projects</span><span class="p">[</span><span class="s1">&#39;project_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">f</span><span class="o">+</span><span class="mi">10</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="n">projects</span><span class="p">[</span><span class="s1">&#39;project_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">values</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1"># Merge datasets</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="n">donations</span> <span class="o">=</span> <span class="n">donations</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">donors</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&#34;Donor ID&#34;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&#34;left&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">donations</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">projects</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s2">&#34;Project ID&#34;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&#34;left&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="c1"># only load a few lines in test mode</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">if</span> <span class="n">test_mode</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="n">donations_df</span> <span class="o">=</span> <span class="n">df</span>
</span></span></code></pre></div><p>Ở giai đoạn xây dựng code và debug, mình chỉ load 10000 dữ liệu lên để test thử  (để đảm bảo rằng mình code đúng - bằng cách set test_mode = True). Khi chạy thật mình sẽ set lại test_mode = False.</p>
<p>Thực hiện một vài bước phân tích kỹ thuật đơn giản để nắm rõ hơn về dữ liệu.</p>
<p>Thử đo mối quan hệ giữa các dự án và các &ldquo;mạnh thường quân&rdquo;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># Deal with missing values</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">donations</span><span class="p">[</span><span class="s2">&#34;Donation Amount&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">donations</span><span class="p">[</span><span class="s2">&#34;Donation Amount&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"># Define event strength as the donated amount to a certain project</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">donations_df</span><span class="p">[</span><span class="s1">&#39;eventStrength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">donations_df</span><span class="p">[</span><span class="s1">&#39;Donation Amount&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">def</span> <span class="nf">smooth_donor_preference</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">donations_full_df</span> <span class="o">=</span> <span class="n">donations_df</span> \
</span></span><span class="line"><span class="ln">11</span><span class="cl">                    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Donor ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Project ID&#39;</span><span class="p">])[</span><span class="s1">&#39;eventStrength&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> \
</span></span><span class="line"><span class="ln">12</span><span class="cl">                    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">smooth_donor_preference</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"># Update projects dataset</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="n">project_cols</span> <span class="o">=</span> <span class="n">projects</span><span class="o">.</span><span class="n">columns</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="n">projects</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">project_cols</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# of projects: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">projects</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# of unique user/project donations: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">donations_full_df</span><span class="p">))</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># of projects: 1889</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"># of unique user/project donations: 8648</span>
</span></span></code></pre></div><p>Dựa vào kết quả trên tập test, chúng ta có thể đưa ra một vài nhận xét như sau:</p>
<ul>
<li>Hầu hết các mạnh thường quân chỉ donate cho 1 project (tỷ lệ 86,48%)</li>
<li>Sẽ có trường hợp 1 mạnh thường quân sẽ donate cho nhiều dự án, và cũng có trường hợp 1 mạnh thường quân donate nhiều lần cho 1 dự án. Trường hợp này chiếm phần ít.</li>
</ul>
<p>Để đánh giá mô hình, chúng ta sẽ chia tập dữ liệu thành 2 phần là train và test. Ở đây, chúng ta sẽ set tỷ lệ train/test là 20%.</p>
<h2 id="2-xây-dựng-mô-hình-content-based-filtering">2. Xây dựng mô hình Content-Based Filtering<a class="anchor ms-1" href="#2-xây-dựng-mô-hình-content-based-filtering"><i class="fas fa-link"></i></a></h2>
<p>Cách tiếp cận đầu tiên, chúng ta sẽ tìm những project gần giống với những project mà donor đã donated. Đơn giản nhất là với mỗi project, chúng ta sẽ định nghĩa các vector đặc trưng của chúng và đo độ giống nhau giữa hai vector đó. Vector đặc trưng chúng ta có thể xây dựng trên các thuộc tính như project type, project catefory, grade level, resource category, cost, school zip code, &hellip; hoặc các bạn có thể từ các vector cơ bản do tập dữ liệu cung cấp bổ sung thêm các vector cấp cao hơn, ví dụ như là rút trích các feature từ tên project hoặc mô tả của project, loại bỏ stopwords &hellip;</p>
<p>Ở đây, chúng ta sẽ sử dụng kỹ thuật TF-IDF để rút trích thông tin đặc trưng của dự án dựa trên project tittle và description. Về TF-IDF, các bạn có thể đọc ở một bài viết nào đó của google, mình không tiện nhắc đến nó chi tiết ở bài viết này.</p>
<h3 id="a-xây-dựng-tập-đặc-trưng">a. Xây dựng tập đặc trưng<a class="anchor ms-1" href="#a-xây-dựng-tập-đặc-trưng"><i class="fas fa-link"></i></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"># Preprocessing of text data</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">textfeats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Project Title&#34;</span><span class="p">,</span><span class="s2">&#34;Project Essay&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="n">textfeats</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">projects</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">projects</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="n">projects</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">projects</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># FILL NA</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">projects</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">projects</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="c1"># Lowercase all text, so that capitalized words dont get treated differently</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">text</span> <span class="o">=</span> <span class="n">projects</span><span class="p">[</span><span class="s2">&#34;Project Title&#34;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">projects</span><span class="p">[</span><span class="s2">&#34;Project Essay&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">vectorizer</span> <span class="o">=</span> <span class="n">TfidfVectorizer</span><span class="p">(</span><span class="n">strip_accents</span><span class="o">=</span><span class="s1">&#39;unicode&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">                             <span class="n">analyzer</span><span class="o">=</span><span class="s1">&#39;word&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">                             <span class="n">lowercase</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># Convert all uppercase to lowercase</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">                             <span class="n">stop_words</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">,</span> <span class="c1"># Remove commonly found english words (&#39;it&#39;, &#39;a&#39;, &#39;the&#39;) which do not typically contain much signal</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">                             <span class="n">max_df</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="c1"># Only consider words that appear in fewer than max_df percent of all documents</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">                             <span class="c1"># max_features=5000 # Maximum features to be extracted</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">                            <span class="p">)</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="n">project_ids</span> <span class="o">=</span> <span class="n">projects</span><span class="p">[</span><span class="s1">&#39;Project ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="n">tfidf_matrix</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="n">tfidf_feature_names</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="c1"># build profile</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="k">def</span> <span class="nf">get_project_profile</span><span class="p">(</span><span class="n">project_id</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="n">idx</span> <span class="o">=</span> <span class="n">project_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">project_id</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="n">project_profile</span> <span class="o">=</span> <span class="n">tfidf_matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="k">return</span> <span class="n">project_profile</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="k">def</span> <span class="nf">get_project_profiles</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="n">project_profiles_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_project_profile</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">([</span><span class="n">ids</span><span class="p">])]</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="n">project_profiles</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">project_profiles_list</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="k">return</span> <span class="n">project_profiles</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="k">def</span> <span class="nf">build_donors_profile</span><span class="p">(</span><span class="n">donor_id</span><span class="p">,</span> <span class="n">donations_indexed_df</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="n">donations_donor_df</span> <span class="o">=</span> <span class="n">donations_indexed_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">donor_id</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="n">donor_project_profiles</span> <span class="o">=</span> <span class="n">get_project_profiles</span><span class="p">(</span><span class="n">donations_donor_df</span><span class="p">[</span><span class="s1">&#39;Project ID&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="n">donor_project_strengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">donations_donor_df</span><span class="p">[</span><span class="s1">&#39;eventStrength&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="c1">#Weighted average of project profiles by the donations strength</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="n">donor_project_strengths_weighted_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">donor_project_profiles</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">donor_project_strengths</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">donor_project_strengths</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">    <span class="n">donor_profile_norm</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">donor_project_strengths_weighted_avg</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="k">return</span> <span class="n">donor_profile_norm</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">
</span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="k">def</span> <span class="nf">build_donors_profiles</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">    <span class="n">donations_indexed_df</span> <span class="o">=</span> <span class="n">donations_full_df</span><span class="p">[</span><span class="n">donations_full_df</span><span class="p">[</span><span class="s1">&#39;Project ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">projects</span><span class="p">[</span><span class="s1">&#39;Project ID&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Donor ID&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">    <span class="n">donor_profiles</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">    <span class="k">for</span> <span class="n">donor_id</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">donations_indexed_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">        <span class="n">donor_profiles</span><span class="p">[</span><span class="n">donor_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_donors_profile</span><span class="p">(</span><span class="n">donor_id</span><span class="p">,</span> <span class="n">donations_indexed_df</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">    <span class="k">return</span> <span class="n">donor_profiles</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">
</span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="n">donor_profiles</span> <span class="o">=</span> <span class="n">build_donors_profiles</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;# of donors with profiles: </span><span class="si">%d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">donor_profiles</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">
</span></span><span class="line"><span class="ln">55</span><span class="cl"><span class="n">mydonor1</span> <span class="o">=</span> <span class="s2">&#34;6d5b22d39e68c656071a842732c63a0c&#34;</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl"><span class="n">mydonor2</span> <span class="o">=</span> <span class="s2">&#34;0016b23800f7ea46424b3254f016007a&#34;</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl"><span class="n">mydonor1_profile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">tfidf_feature_names</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">                        <span class="n">donor_profiles</span><span class="p">[</span><span class="n">mydonor1</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">                        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[:</span><span class="mi">10</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="s1">&#39;relevance&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl"><span class="n">mydonor2_profile</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">tfidf_feature_names</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">                        <span class="n">donor_profiles</span><span class="p">[</span><span class="n">mydonor2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">                        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[:</span><span class="mi">10</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="s1">&#39;relevance&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">
</span></span><span class="line"><span class="ln">66</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;feature of user &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mydonor1</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">mydonor1_profile</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">68</span><span class="cl">
</span></span><span class="line"><span class="ln">69</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;feature of user &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mydonor2</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">mydonor2_profile</span><span class="p">)</span>
</span></span></code></pre></div><p>Mã nguồn ở trên cũng có chú thích đầy đủ, và đọc cũng dễ hiểu, nên mình không nói thêm gì nhiều. Mình tóm gọn một chút là chúng ta sẽ convert toàn bộ project tittle và description về dạng chữ thường, tách từ dựa vào khoảng trắng, loại bỏ những english stopwords. Sau đó xây dựng profile cho từng donor.</p>
<p>Kết quả</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">feature</span> <span class="n">of</span>  <span class="n">user</span> <span class="mi">6</span><span class="n">d5b22d39e68c656071a842732c63a0c</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">        <span class="n">token</span>  <span class="n">relevance</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="mi">0</span>       <span class="n">music</span>   <span class="mf">0.450057</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="mi">1</span>  <span class="n">auditorium</span>   <span class="mf">0.355256</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="mi">2</span>        <span class="n">cart</span>   <span class="mf">0.272809</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="mi">3</span>       <span class="n">chair</span>   <span class="mf">0.223861</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="mi">4</span>   <span class="n">equipment</span>   <span class="mf">0.211338</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="mi">5</span>   <span class="n">musicians</span>   <span class="mf">0.179244</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="mi">6</span>        <span class="n">time</span>   <span class="mf">0.172908</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="mi">7</span>      <span class="n">moving</span>   <span class="mf">0.137749</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="mi">8</span>        <span class="n">ohms</span>   <span class="mf">0.134065</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="mi">9</span>     <span class="n">prepare</span>   <span class="mf">0.131274</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">feature</span> <span class="n">of</span>  <span class="n">user</span> <span class="mi">0016</span><span class="n">b23800f7ea46424b3254f016007a</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">         <span class="n">token</span>  <span class="n">relevance</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="mi">0</span>  <span class="n">pollinators</span>   <span class="mf">0.670222</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="mi">1</span>       <span class="n">plants</span>   <span class="mf">0.305398</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="mi">2</span>       <span class="n">module</span>   <span class="mf">0.223407</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="mi">3</span>  <span class="n">pollination</span>   <span class="mf">0.211870</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="mi">4</span>        <span class="n">seeds</span>   <span class="mf">0.180609</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="mi">5</span>      <span class="n">writing</span>   <span class="mf">0.166816</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="mi">6</span>        <span class="n">books</span>   <span class="mf">0.137455</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="mi">7</span>      <span class="n">reading</span>   <span class="mf">0.115003</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="mi">8</span>       <span class="n">weaved</span>   <span class="mf">0.111704</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="mi">9</span>         <span class="n">bees</span>   <span class="mf">0.101842</span>
</span></span></code></pre></div><p>Nhìn kết quả trên, ta thấy rằng donor 1 có vẻ thích những thứ liên quan đến âm nhạc (music, auditorim), trong khi đó donor 2 thích những thứ liên quan đến trồng trọt (pollinators - thụ phấn, plants - cây cối)</p>
<h3 id="b-xây-dựng-mô-hình">b. Xây dựng mô hình<a class="anchor ms-1" href="#b-xây-dựng-mô-hình"><i class="fas fa-link"></i></a></h3>
<p>Việc xây dựng mô hình đến đây là khá đơn giản. Chúng ta chỉ việc tính khoảng cách cosin giữa vector cần dự đoán và toàn bộ vector có trong tập train rồi show top K prject có liên quan cao nhất</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">class</span> <span class="nc">ContentBasedRecommender</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">MODEL_NAME</span> <span class="o">=</span> <span class="s1">&#39;Content-Based&#39;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">projects_df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">project_ids</span> <span class="o">=</span> <span class="n">project_ids</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">projects_df</span> <span class="o">=</span> <span class="n">projects_df</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">def</span> <span class="nf">get_model_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODEL_NAME</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">def</span> <span class="nf">_get_similar_projects_to_donor_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">donor_id</span><span class="p">,</span> <span class="n">topn</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="c1">#Computes the cosine similarity between the donor profile and all project profiles</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">cosine_similarities</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">donor_profiles</span><span class="p">[</span><span class="n">donor_id</span><span class="p">],</span> <span class="n">tfidf_matrix</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1">#Gets the top similar projects</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="n">similar_indices</span> <span class="o">=</span> <span class="n">cosine_similarities</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="o">-</span><span class="n">topn</span><span class="p">:]</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1">#Sort the similar projects by similarity</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">similar_projects</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">project_ids</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cosine_similarities</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">similar_indices</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">return</span> <span class="n">similar_projects</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">def</span> <span class="nf">recommend_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">donor_id</span><span class="p">,</span> <span class="n">projects_to_ignore</span><span class="o">=</span><span class="p">[],</span> <span class="n">topn</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="n">similar_projects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_similar_projects_to_donor_profile</span><span class="p">(</span><span class="n">donor_id</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="c1">#Ignores projects the donor has already donated</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="n">similar_projects_filtered</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">projects_to_ignore</span><span class="p">,</span> <span class="n">similar_projects</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="n">recommendations_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">similar_projects_filtered</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Project ID&#39;</span><span class="p">,</span> <span class="s1">&#39;recStrength&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">topn</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="n">recommendations_df</span> <span class="o">=</span> <span class="n">recommendations_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projects_df</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">                                                    <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;Project ID&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">                                                    <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;Project ID&#39;</span><span class="p">)[[</span><span class="s1">&#39;recStrength&#39;</span><span class="p">,</span> <span class="s1">&#39;Project ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Project Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Project Essay&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl">        <span class="k">return</span> <span class="n">recommendations_df</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="n">cbr_model</span> <span class="o">=</span> <span class="n">ContentBasedRecommender</span><span class="p">(</span><span class="n">projects</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;recommend for user &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mydonor1</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">cbr_model</span><span class="o">.</span><span class="n">recommend_projects</span><span class="p">(</span><span class="n">mydonor1</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;recommend for user &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mydonor2</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">cbr_model</span><span class="o">.</span><span class="n">recommend_projects</span><span class="p">(</span><span class="n">mydonor2</span><span class="p">))</span>
</span></span></code></pre></div><p>Kết quả</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">recommend</span> <span class="k">for</span> <span class="n">user</span> <span class="mi">6</span><span class="n">d5b22d39e68c656071a842732c63a0c</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">   <span class="n">recStrength</span>                        <span class="o">...</span>                                                              <span class="n">Project</span> <span class="n">Essay</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="mi">0</span>     <span class="mf">1.000000</span>                        <span class="o">...</span>                          <span class="n">the</span> <span class="n">music</span> <span class="n">students</span> <span class="ow">in</span> <span class="n">our</span> <span class="n">classes</span> <span class="n">perform</span> <span class="n">freq</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="mi">1</span>     <span class="mf">0.390997</span>                        <span class="o">...</span>                          <span class="n">i</span> <span class="n">have</span> <span class="n">spent</span> <span class="mi">12</span> <span class="n">years</span> <span class="k">as</span> <span class="n">an</span> <span class="n">educator</span> <span class="n">rebuildin</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="mi">2</span>     <span class="mf">0.338676</span>                        <span class="o">...</span>                          <span class="s2">&#34;music is what feelings sound like.&#34;</span> <span class="o">-</span><span class="n">g</span><span class="o">.</span> <span class="n">cates</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="mi">3</span>     <span class="mf">0.331034</span>                        <span class="o">...</span>                          <span class="n">true</span> <span class="n">music</span> <span class="ow">is</span> <span class="n">created</span> <span class="ow">not</span> <span class="n">by</span> <span class="n">the</span> <span class="n">teacher</span> <span class="n">but</span> <span class="n">b</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="mi">4</span>     <span class="mf">0.324355</span>                        <span class="o">...</span>                          <span class="n">every</span> <span class="n">morning</span> <span class="n">my</span> <span class="n">first</span> <span class="n">grade</span> <span class="n">students</span> <span class="n">come</span> <span class="n">to</span> <span class="o">...</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="mi">5</span>     <span class="mf">0.322923</span>                        <span class="o">...</span>                          <span class="ow">in</span> <span class="n">today</span><span class="s1">&#39;s fast paced environment, students ne...</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="mi">6</span>     <span class="mf">0.315910</span>                        <span class="o">...</span>                          <span class="s2">&#34;music is a moral law.  it gives soul to the u...</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="mi">7</span>     <span class="mf">0.314845</span>                        <span class="o">...</span>                          <span class="n">i</span> <span class="n">walk</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">door</span> <span class="n">so</span> <span class="n">excited</span> <span class="n">to</span> <span class="n">get</span> <span class="n">the</span> <span class="n">stude</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="mi">8</span>     <span class="mf">0.310103</span>                        <span class="o">...</span>                          <span class="n">some</span> <span class="n">students</span> <span class="n">have</span> <span class="n">never</span> <span class="n">put</span> <span class="n">their</span> <span class="n">hands</span> <span class="n">on</span> <span class="n">a</span> <span class="o">...</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="mi">9</span>     <span class="mf">0.297516</span>                        <span class="o">...</span>                          <span class="n">my</span> <span class="n">students</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">have</span> <span class="n">money</span><span class="p">,</span> <span class="n">but</span> <span class="n">they</span> <span class="n">do</span> <span class="n">hav</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">[</span><span class="mi">10</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">4</span> <span class="n">columns</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="n">recommend</span> <span class="k">for</span> <span class="n">user</span> <span class="mi">0016</span><span class="n">b23800f7ea46424b3254f016007a</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">   <span class="n">recStrength</span>                        <span class="o">...</span>                                                              <span class="n">Project</span> <span class="n">Essay</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="mi">0</span>     <span class="mf">1.000000</span>                        <span class="o">...</span>                          <span class="n">my</span> <span class="n">students</span> <span class="n">are</span> <span class="n">creative</span><span class="p">,</span> <span class="n">curious</span><span class="p">,</span> <span class="ow">and</span> <span class="n">excited</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="mi">1</span>     <span class="mf">0.211962</span>                        <span class="o">...</span>                          <span class="n">our</span> <span class="n">school</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">title</span> <span class="mi">1</span> <span class="n">school</span><span class="o">.</span>  <span class="mi">100</span><span class="o">%</span> <span class="n">of</span> <span class="n">stude</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="mi">2</span>     <span class="mf">0.189111</span>                        <span class="o">...</span>                          <span class="n">my</span> <span class="n">students</span> <span class="n">are</span> <span class="n">active</span> <span class="ow">and</span> <span class="n">eager</span> <span class="n">learners</span> <span class="n">who</span> <span class="o">...</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="mi">3</span>     <span class="mf">0.188095</span>                        <span class="o">...</span>                          <span class="n">being</span> <span class="n">a</span> <span class="n">small</span> <span class="n">rural</span> <span class="n">school</span> <span class="n">we</span> <span class="n">do</span> <span class="n">a</span> <span class="n">lot</span> <span class="n">of</span> <span class="n">trad</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="mi">4</span>     <span class="mf">0.173520</span>                        <span class="o">...</span>                          <span class="s2">&#34;science is a way of life...science is the pro...</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="mi">5</span>     <span class="mf">0.159015</span>                        <span class="o">...</span>                          <span class="n">my</span> <span class="n">second</span> <span class="n">grade</span> <span class="n">students</span> <span class="n">love</span> <span class="n">to</span> <span class="n">come</span> <span class="n">to</span> <span class="n">schoo</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="mi">6</span>     <span class="mf">0.158071</span>                        <span class="o">...</span>                          <span class="n">i</span> <span class="n">teach</span> <span class="mi">28</span> <span class="n">fourth</span> <span class="n">graders</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">neighborhood</span> <span class="n">sc</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="mi">7</span>     <span class="mf">0.150389</span>                        <span class="o">...</span>                          <span class="ow">in</span> <span class="n">my</span> <span class="n">classroom</span> <span class="n">we</span> <span class="n">are</span> <span class="n">working</span> <span class="n">hard</span> <span class="n">to</span> <span class="n">become</span> <span class="o">...</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="mi">8</span>     <span class="mf">0.144724</span>                        <span class="o">...</span>                          <span class="k">as</span> <span class="n">a</span> <span class="n">teacher</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">diverse</span><span class="p">,</span> <span class="n">low</span><span class="o">-</span><span class="n">income</span><span class="p">,</span> <span class="n">high</span><span class="o">-</span><span class="n">po</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="mi">9</span>     <span class="mf">0.139937</span>                        <span class="o">...</span>                          <span class="n">have</span> <span class="n">you</span> <span class="n">ever</span> <span class="n">been</span> <span class="n">told</span> <span class="n">you</span> <span class="n">need</span> <span class="n">to</span> <span class="n">read</span><span class="p">,</span> <span class="n">but</span> <span class="o">...</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">[</span><span class="mi">10</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">4</span> <span class="n">columns</span><span class="p">]</span>
</span></span></code></pre></div><p>Mình dùng cmd nên bị giới hạn kết quả, các bạn có thể write log vào file hoặc dùng jupiter để show kết quả rõ hơn.</p>
<p>Ở đây, chúng ta nhận thấy rằng các recommend cho donor 1 thường là những project liên quan tới âm nhạc (nhìn tập feature ta cũng có thể đoán được). Và recommend cho donor 2 là những thứ liên quan đến chủ đề làm vườn và reading.</p>
<h2 id="3-collaborative-filtering-model">3. Collaborative Filtering Model<a class="anchor ms-1" href="#3-collaborative-filtering-model"><i class="fas fa-link"></i></a></h2>
<p>Lý thuyết về Collaborative Filtering Model các bạn có thể xem ở các bài viết khác của mình hoặc tham khảo thêm trên mạng. Ở đây, mình sẽ sử dụng Singular Value Decomposition (SVD) để xây dựng ma trận đặc trưng.</p>
<h3 id="a-xây-dựng-ma-trận-donor---project">a. Xây dựng ma trận donor - project<a class="anchor ms-1" href="#a-xây-dựng-ma-trận-donor---project"><i class="fas fa-link"></i></a></h3>
<p>Đầu tiên, chúng ta sẽ xây dựng ma trận mối quan hệ giữa donor và project. Nếu donor i có donated cho 1 project j thì dòng i cột j của ma trận sẽ được đánh dấu là 1, ngược lại là 0.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">## create matrix</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1">#Creating a sparse pivot table with donors in rows and projects in columns</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">donors_projects_pivot_matrix_df</span> <span class="o">=</span> <span class="n">donations_full_df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;Donor ID&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">                                                          <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Project ID&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">                                                          <span class="n">values</span><span class="o">=</span><span class="s1">&#39;eventStrength&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"># Transform the donor-project dataframe into a matrix</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">donors_projects_pivot_matrix</span> <span class="o">=</span> <span class="n">donors_projects_pivot_matrix_df</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"># Get donor ids</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">donors_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">donors_projects_pivot_matrix_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">donors_projects_pivot_matrix</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span> <span class="c1"># print first 5 row</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl">
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">array</span><span class="p">([[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">       <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">       <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">       <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">       <span class="p">[</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">]])</span>
</span></span></code></pre></div><h3 id="b-singular-value-decomposition">b. Singular Value Decomposition<a class="anchor ms-1" href="#b-singular-value-decomposition"><i class="fas fa-link"></i></a></h3>
<p>Sau khi có ma trận trên, ta có một nhận xét rằng nó rất thưa, số lượng 0 thì nhiều mà 1 thì ít. Sau khi áp dụng SVD, ma trận kết quả sẽ ít thưa hơn (có thể đạt được đến mức không còn thưa nữa).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># Performs matrix factorization of the original donor-project matrix</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"># Here we set k = 20, which is the number of factors we are going to get</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"># In the definition of SVD, an original matrix A is approxmated as a product A ≈ UΣV</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"># where U and V have orthonormal columns, and Σ is non-negative diagonal.</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">U</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">Vt</span> <span class="o">=</span> <span class="n">svds</span><span class="p">(</span><span class="n">donors_projects_pivot_matrix</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"># Reconstruct the matrix by multiplying its factors</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">all_donor_predicted_ratings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">Vt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1">#Converting the reconstructed matrix back to a Pandas dataframe</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">cf_preds_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_donor_predicted_ratings</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">                           <span class="n">columns</span> <span class="o">=</span> <span class="n">donors_projects_pivot_matrix_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">                           <span class="n">index</span><span class="o">=</span><span class="n">donors_ids</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">cf_preds_df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">                                  <span class="mi">0003</span><span class="n">aba06ccf49f8c44fc2dd3b582411</span>                <span class="o">...</span>                 <span class="n">ffff088c35d3455779a30898d1327b76</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">Project</span> <span class="n">ID</span>                                                                        <span class="o">...</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="mi">000009891526</span><span class="n">c0ade7180f8423792063</span>                     <span class="o">-</span><span class="mf">3.423182e-34</span>                <span class="o">...-</span><span class="mf">4.577244e-34</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="mi">00000</span><span class="n">ce845c00cbf0686c992fc369df4</span>                     <span class="o">-</span><span class="mf">3.061322e-36</span>                <span class="o">...-</span><span class="mf">6.492305e-36</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="mi">00002</span><span class="n">d44003ed46b066607c5455a999a</span>                      <span class="mf">1.368936e-33</span>                <span class="o">...-</span><span class="mf">2.239156e-32</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="mi">00002</span><span class="n">eb25d60a09c318efbd0797bffb5</span>                      <span class="mf">1.784576e-33</span>                <span class="o">..</span><span class="mf">.1.163684e-32</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="mi">0000300773</span><span class="n">fe015f870914b42528541b</span>                      <span class="mf">4.314216e-34</span>                <span class="o">...-</span><span class="mf">4.666110e-34</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">[</span><span class="mi">5</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">8015</span> <span class="n">columns</span><span class="p">]</span>
</span></span></code></pre></div><h3 id="c-xây-dựng-collaborative-filtering-model">c. Xây dựng Collaborative Filtering Model<a class="anchor ms-1" href="#c-xây-dựng-collaborative-filtering-model"><i class="fas fa-link"></i></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">class</span> <span class="nc">CFRecommender</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">MODEL_NAME</span> <span class="o">=</span> <span class="s1">&#39;Collaborative Filtering&#39;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cf_predictions_df</span><span class="p">,</span> <span class="n">projects_df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">cf_predictions_df</span> <span class="o">=</span> <span class="n">cf_predictions_df</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">projects_df</span> <span class="o">=</span> <span class="n">projects_df</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">def</span> <span class="nf">get_model_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODEL_NAME</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">def</span> <span class="nf">recommend_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">donor_id</span><span class="p">,</span> <span class="n">projects_to_ignore</span><span class="o">=</span><span class="p">[],</span> <span class="n">topn</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="c1"># Get and sort the donor&#39;s predictions</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">sorted_donor_predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf_predictions_df</span><span class="p">[</span><span class="n">donor_id</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> \
</span></span><span class="line"><span class="ln">17</span><span class="cl">                                    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">donor_id</span><span class="p">:</span> <span class="s1">&#39;recStrength&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># Recommend the highest predicted projects that the donor hasn&#39;t donated to</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">recommendations_df</span> <span class="o">=</span> <span class="n">sorted_donor_predictions</span><span class="p">[</span><span class="o">~</span><span class="n">sorted_donor_predictions</span><span class="p">[</span><span class="s1">&#39;Project ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">projects_to_ignore</span><span class="p">)]</span> \
</span></span><span class="line"><span class="ln">21</span><span class="cl">                               <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;recStrength&#39;</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> \
</span></span><span class="line"><span class="ln">22</span><span class="cl">                               <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">topn</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="n">recommendations_df</span> <span class="o">=</span> <span class="n">recommendations_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projects_df</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">                                                          <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;Project ID&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">                                                          <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;Project ID&#39;</span><span class="p">)[[</span><span class="s1">&#39;recStrength&#39;</span><span class="p">,</span> <span class="s1">&#39;Project ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Project Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Project Essay&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="k">return</span> <span class="n">recommendations_df</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="n">cfr_model</span> <span class="o">=</span> <span class="n">CFRecommender</span><span class="p">(</span><span class="n">cf_preds_df</span><span class="p">,</span> <span class="n">projects</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">cfr_model</span><span class="o">.</span><span class="n">recommend_projects</span><span class="p">(</span><span class="n">mydonor1</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">cfr_model</span><span class="o">.</span><span class="n">recommend_projects</span><span class="p">(</span><span class="n">mydonor2</span><span class="p">))</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="p">[</span><span class="mi">5</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">8015</span> <span class="n">columns</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="n">recStrength</span>                        <span class="o">...</span>                                                              <span class="n">Project</span> <span class="n">Essay</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="mi">0</span>  <span class="mf">3.015461e-17</span>                        <span class="o">...</span>                          <span class="n">Our</span> <span class="n">students</span> <span class="n">are</span> <span class="n">some</span> <span class="n">of</span> <span class="n">the</span> <span class="n">hardest</span> <span class="n">working</span> <span class="n">k</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="mi">1</span>  <span class="mf">2.237275e-17</span>                        <span class="o">...</span>                          <span class="n">As</span> <span class="n">Service</span> <span class="n">Learning</span> <span class="n">Coordinators</span> <span class="n">at</span> <span class="n">our</span> <span class="n">elemen</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="mi">2</span>  <span class="mf">2.188501e-17</span>                        <span class="o">...</span>                          <span class="n">We</span> <span class="n">are</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">engage</span> <span class="n">more</span> <span class="n">students</span> <span class="ow">in</span> <span class="n">scien</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="mi">3</span>  <span class="mf">1.768711e-17</span>                        <span class="o">...</span>                          <span class="n">We</span> <span class="n">are</span> <span class="n">a</span> <span class="n">brand</span> <span class="n">new</span> <span class="n">charter</span> <span class="n">school</span> <span class="n">that</span> <span class="n">has</span> <span class="n">onl</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="mi">4</span>  <span class="mf">1.344489e-17</span>                        <span class="o">...</span>                          <span class="n">Sitting</span> <span class="n">at</span> <span class="n">a</span> <span class="n">desk</span> <span class="k">for</span> <span class="n">a</span> <span class="n">sustained</span> <span class="n">period</span> <span class="n">of</span> <span class="n">ti</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="mi">5</span>  <span class="mf">9.957278e-18</span>                        <span class="o">...</span>                          <span class="n">Our</span> <span class="n">students</span> <span class="n">come</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">Title</span> <span class="n">I</span> <span class="n">school</span> <span class="ow">in</span> <span class="n">Jer</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="mi">6</span>  <span class="mf">6.932330e-18</span>                        <span class="o">...</span>                          <span class="n">In</span> <span class="n">my</span> <span class="n">school</span> <span class="mi">50</span><span class="o">%</span> <span class="n">of</span> <span class="n">the</span> <span class="n">students</span> <span class="n">are</span> <span class="n">socioecon</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="mi">7</span>  <span class="mf">8.589640e-19</span>                        <span class="o">...</span>                          <span class="n">Have</span> <span class="n">you</span> <span class="n">ever</span> <span class="n">been</span> <span class="n">told</span> <span class="n">you</span> <span class="n">need</span> <span class="n">to</span> <span class="n">read</span><span class="p">,</span> <span class="n">but</span> <span class="o">...</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="mi">8</span>  <span class="mf">6.698040e-19</span>                        <span class="o">...</span>                          <span class="s2">&#34;I cannot say good-bye to those whom I have gr...</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="mi">9</span>  <span class="mf">5.733941e-19</span>                        <span class="o">...</span>                          <span class="n">I</span> <span class="n">have</span> <span class="n">students</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">who</span> <span class="n">are</span> <span class="n">squinting</span> <span class="ow">and</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">[</span><span class="mi">10</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">4</span> <span class="n">columns</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="n">recStrength</span>                        <span class="o">...</span>                                                              <span class="n">Project</span> <span class="n">Essay</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="mi">0</span>  <span class="mf">3.015461e-17</span>                        <span class="o">...</span>                          <span class="n">Our</span> <span class="n">students</span> <span class="n">are</span> <span class="n">some</span> <span class="n">of</span> <span class="n">the</span> <span class="n">hardest</span> <span class="n">working</span> <span class="n">k</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="mi">1</span>  <span class="mf">2.237275e-17</span>                        <span class="o">...</span>                          <span class="n">As</span> <span class="n">Service</span> <span class="n">Learning</span> <span class="n">Coordinators</span> <span class="n">at</span> <span class="n">our</span> <span class="n">elemen</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="mi">2</span>  <span class="mf">2.188501e-17</span>                        <span class="o">...</span>                          <span class="n">We</span> <span class="n">are</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">engage</span> <span class="n">more</span> <span class="n">students</span> <span class="ow">in</span> <span class="n">scien</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="mi">3</span>  <span class="mf">1.768711e-17</span>                        <span class="o">...</span>                          <span class="n">We</span> <span class="n">are</span> <span class="n">a</span> <span class="n">brand</span> <span class="n">new</span> <span class="n">charter</span> <span class="n">school</span> <span class="n">that</span> <span class="n">has</span> <span class="n">onl</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="mi">4</span>  <span class="mf">1.344489e-17</span>                        <span class="o">...</span>                          <span class="n">Sitting</span> <span class="n">at</span> <span class="n">a</span> <span class="n">desk</span> <span class="k">for</span> <span class="n">a</span> <span class="n">sustained</span> <span class="n">period</span> <span class="n">of</span> <span class="n">ti</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="mi">5</span>  <span class="mf">9.957278e-18</span>                        <span class="o">...</span>                          <span class="n">Our</span> <span class="n">students</span> <span class="n">come</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">Title</span> <span class="n">I</span> <span class="n">school</span> <span class="ow">in</span> <span class="n">Jer</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="mi">6</span>  <span class="mf">6.932330e-18</span>                        <span class="o">...</span>                          <span class="n">In</span> <span class="n">my</span> <span class="n">school</span> <span class="mi">50</span><span class="o">%</span> <span class="n">of</span> <span class="n">the</span> <span class="n">students</span> <span class="n">are</span> <span class="n">socioecon</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="mi">7</span>  <span class="mf">8.589640e-19</span>                        <span class="o">...</span>                          <span class="n">Have</span> <span class="n">you</span> <span class="n">ever</span> <span class="n">been</span> <span class="n">told</span> <span class="n">you</span> <span class="n">need</span> <span class="n">to</span> <span class="n">read</span><span class="p">,</span> <span class="n">but</span> <span class="o">...</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="mi">8</span>  <span class="mf">6.698040e-19</span>                        <span class="o">...</span>                          <span class="s2">&#34;I cannot say good-bye to those whom I have gr...</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="mi">9</span>  <span class="mf">5.733941e-19</span>                        <span class="o">...</span>                          <span class="n">I</span> <span class="n">have</span> <span class="n">students</span> <span class="ow">in</span> <span class="k">class</span> <span class="nc">who</span> <span class="n">are</span> <span class="n">squinting</span> <span class="ow">and</span><span class="o">...</span>
</span></span></code></pre></div><p>Kết quả trả về có vẻ không được đẹp như ở phương pháp trên. Ở đây, thuật toán dựa vào hành vi donated của những người khác có điểm tương đồng với user donor 1 và 2. Bởi vậy gợi ý những project sẽ khác những gợi ý ở phương pháp 1.</p>
<h2 id="4-hybrid-method">4. Hybrid Method<a class="anchor ms-1" href="#4-hybrid-method"><i class="fas fa-link"></i></a></h2>
<p>Phương pháp lai này kết hợp cả 2 hướng tiếp cận của hai phương pháp ở trên. Ở đây, chúng ta sẽ xây dựng một mô hình nhỏ, nhân điểm của content based và collaborative filtering lại với nhau, sau đó xếp hạng để được điểm hybrid. Đây là 1 cách đơn giản, các bạn có thể tìm đọc nhiều cách tiếp cận khác và ứng dụng vào bài toán.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">class</span> <span class="nc">HybridRecommender</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="n">MODEL_NAME</span> <span class="o">=</span> <span class="s1">&#39;Hybrid&#39;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb_rec_model</span><span class="p">,</span> <span class="n">cf_rec_model</span><span class="p">,</span> <span class="n">projects_df</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">cb_rec_model</span> <span class="o">=</span> <span class="n">cb_rec_model</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">cf_rec_model</span> <span class="o">=</span> <span class="n">cf_rec_model</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">projects_df</span> <span class="o">=</span> <span class="n">projects_df</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">def</span> <span class="nf">get_model_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODEL_NAME</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">def</span> <span class="nf">recommend_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">donor_id</span><span class="p">,</span> <span class="n">projects_to_ignore</span><span class="o">=</span><span class="p">[],</span> <span class="n">topn</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="c1">#Getting the top-1000 Content-based filtering recommendations</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">cb_recs_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb_rec_model</span><span class="o">.</span><span class="n">recommend_projects</span><span class="p">(</span><span class="n">donor_id</span><span class="p">,</span> <span class="n">projects_to_ignore</span><span class="o">=</span><span class="n">projects_to_ignore</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">                                                           <span class="n">topn</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;recStrength&#39;</span><span class="p">:</span> <span class="s1">&#39;recStrengthCB&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1">#Getting the top-1000 Collaborative filtering recommendations</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="n">cf_recs_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf_rec_model</span><span class="o">.</span><span class="n">recommend_projects</span><span class="p">(</span><span class="n">donor_id</span><span class="p">,</span> <span class="n">projects_to_ignore</span><span class="o">=</span><span class="n">projects_to_ignore</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">                                                           <span class="n">topn</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;recStrength&#39;</span><span class="p">:</span> <span class="s1">&#39;recStrengthCF&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="c1">#Combining the results by Project ID</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="n">recs_df</span> <span class="o">=</span> <span class="n">cb_recs_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cf_recs_df</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">                                   <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">                                   <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;Project ID&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">                                   <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;Project ID&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="c1">#Computing a hybrid recommendation score based on CF and CB scores</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="n">recs_df</span><span class="p">[</span><span class="s1">&#39;recStrengthHybrid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recs_df</span><span class="p">[</span><span class="s1">&#39;recStrengthCB&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">recs_df</span><span class="p">[</span><span class="s1">&#39;recStrengthCF&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="c1">#Sorting recommendations by hybrid score</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="n">recommendations_df</span> <span class="o">=</span> <span class="n">recs_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;recStrengthHybrid&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">topn</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="n">recommendations_df</span> <span class="o">=</span> <span class="n">recommendations_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projects_df</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">                                                    <span class="n">left_on</span> <span class="o">=</span> <span class="s1">&#39;Project ID&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">                                                    <span class="n">right_on</span> <span class="o">=</span> <span class="s1">&#39;Project ID&#39;</span><span class="p">)[[</span><span class="s1">&#39;recStrengthHybrid&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">                                                                              <span class="s1">&#39;Project ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Project Title&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">                                                                              <span class="s1">&#39;Project Essay&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl">        <span class="k">return</span> <span class="n">recommendations_df</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">
</span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="n">hybrid_model</span> <span class="o">=</span> <span class="n">HybridRecommender</span><span class="p">(</span><span class="n">cbr_model</span><span class="p">,</span> <span class="n">cfr_model</span><span class="p">,</span> <span class="n">projects</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">
</span></span><span class="line"><span class="ln">45</span><span class="cl">
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">hybrid_model</span><span class="o">.</span><span class="n">recommend_projects</span><span class="p">(</span><span class="n">mydonor1</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">
</span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">hybrid_model</span><span class="o">.</span><span class="n">recommend_projects</span><span class="p">(</span><span class="n">mydonor2</span><span class="p">))</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">   <span class="n">recStrengthHybrid</span>                        <span class="o">...</span>                                                              <span class="n">Project</span> <span class="n">Essay</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="mi">0</span>       <span class="mf">1.574375e-18</span>                        <span class="o">...</span>                          <span class="n">we</span> <span class="n">are</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">engage</span> <span class="n">more</span> <span class="n">students</span> <span class="ow">in</span> <span class="n">scien</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="mi">1</span>       <span class="mf">1.221807e-18</span>                        <span class="o">...</span>                          <span class="ow">in</span> <span class="n">my</span> <span class="n">school</span> <span class="mi">50</span><span class="o">%</span> <span class="n">of</span> <span class="n">the</span> <span class="n">students</span> <span class="n">are</span> <span class="n">socioecon</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="mi">2</span>       <span class="mf">1.214293e-18</span>                        <span class="o">...</span>                          <span class="n">our</span> <span class="n">students</span> <span class="n">are</span> <span class="n">some</span> <span class="n">of</span> <span class="n">the</span> <span class="n">hardest</span> <span class="n">working</span> <span class="n">k</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="mi">3</span>       <span class="mf">4.037232e-19</span>                        <span class="o">...</span>                          <span class="n">sitting</span> <span class="n">at</span> <span class="n">a</span> <span class="n">desk</span> <span class="k">for</span> <span class="n">a</span> <span class="n">sustained</span> <span class="n">period</span> <span class="n">of</span> <span class="n">ti</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="mi">4</span>       <span class="mf">6.661794e-20</span>                        <span class="o">...</span>                          <span class="err">“</span><span class="n">music</span> <span class="n">expresses</span> <span class="n">that</span> <span class="n">which</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">put</span> <span class="n">into</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="mi">5</span>       <span class="mf">4.872264e-20</span>                        <span class="o">...</span>                          <span class="n">i</span> <span class="n">walk</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">door</span> <span class="n">so</span> <span class="n">excited</span> <span class="n">to</span> <span class="n">get</span> <span class="n">the</span> <span class="n">stude</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="mi">6</span>       <span class="mf">4.410098e-20</span>                        <span class="o">...</span>                          <span class="n">i</span> <span class="n">have</span> <span class="n">spent</span> <span class="mi">12</span> <span class="n">years</span> <span class="k">as</span> <span class="n">an</span> <span class="n">educator</span> <span class="n">rebuildin</span><span class="o">...</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="mi">7</span>       <span class="mf">2.907349e-20</span>                        <span class="o">...</span>                          <span class="s2">&#34;music is what feelings sound like.&#34;</span> <span class="o">-</span><span class="n">g</span><span class="o">.</span> <span class="n">cates</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="mi">8</span>       <span class="mf">2.121616e-20</span>                        <span class="o">...</span>                          <span class="s2">&#34;i cannot say good-bye to those whom i have gr...</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="mi">9</span>       <span class="mf">1.353927e-20</span>                        <span class="o">...</span>                          <span class="n">our</span> <span class="n">band</span> <span class="n">program</span> <span class="ow">is</span> <span class="n">one</span> <span class="n">of</span> <span class="n">the</span> <span class="n">largest</span> <span class="ow">in</span> <span class="n">our</span> <span class="o">...</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">[</span><span class="mi">10</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">4</span> <span class="n">columns</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">   <span class="n">recStrengthHybrid</span>                        <span class="o">...</span>                                                              <span class="n">Project</span> <span class="n">Essay</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="mi">0</span>       <span class="mf">2.811124e-18</span>                        <span class="o">...</span>                          <span class="ow">in</span> <span class="n">this</span> <span class="n">modern</span><span class="p">,</span> <span class="n">digital</span> <span class="n">age</span><span class="p">,</span> <span class="n">i</span> <span class="n">would</span> <span class="n">like</span> <span class="n">to</span> <span class="n">u</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="mi">1</span>       <span class="mf">1.249967e-18</span>                        <span class="o">...</span>                          <span class="n">we</span> <span class="n">are</span> <span class="n">a</span> <span class="n">brand</span> <span class="n">new</span> <span class="n">charter</span> <span class="n">school</span> <span class="n">that</span> <span class="n">has</span> <span class="n">onl</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="mi">2</span>       <span class="mf">6.055628e-19</span>                        <span class="o">...</span>                          <span class="n">my</span> <span class="n">students</span> <span class="n">are</span> <span class="n">african</span> <span class="n">american</span> <span class="ow">and</span> <span class="n">hispanic</span><span class="o">....</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="mi">3</span>       <span class="mf">5.912367e-19</span>                        <span class="o">...</span>                          <span class="n">the</span> <span class="n">a</span><span class="o">.</span> <span class="n">community</span> <span class="ow">and</span> <span class="n">its</span> <span class="n">students</span> <span class="n">are</span> <span class="n">a</span> <span class="n">very</span> <span class="n">s</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="mi">4</span>       <span class="mf">2.541749e-19</span>                        <span class="o">...</span>                          <span class="n">do</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">go</span> <span class="n">on</span> <span class="n">an</span> <span class="n">adventure</span> <span class="ow">and</span> <span class="n">learn</span> <span class="n">ab</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="mi">5</span>       <span class="mf">2.494812e-19</span>                        <span class="o">...</span>                          <span class="n">the</span> <span class="n">average</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">my</span> <span class="k">class</span> <span class="nc">involves</span> <span class="n">students</span> <span class="o">...</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="mi">6</span>       <span class="mf">2.323313e-19</span>                        <span class="o">...</span>                          <span class="n">i</span> <span class="n">teach</span> <span class="n">ela</span> <span class="p">(</span><span class="n">reading</span> <span class="n">component</span><span class="p">)</span> <span class="n">to</span> <span class="bp">self</span><span class="o">-</span><span class="n">contai</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="mi">7</span>       <span class="mf">1.271629e-19</span>                        <span class="o">...</span>                          <span class="n">hi</span> <span class="n">there</span><span class="err">!</span> <span class="n">do</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">help</span> <span class="n">to</span> <span class="n">instill</span> <span class="n">a</span> <span class="n">lif</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="mi">8</span>       <span class="mf">1.044990e-19</span>                        <span class="o">...</span>                          <span class="n">having</span> <span class="n">writing</span> <span class="n">utensils</span> <span class="ow">is</span> <span class="n">essential</span> <span class="k">for</span> <span class="n">stude</span><span class="o">...</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="mi">9</span>       <span class="mf">1.004780e-19</span>                        <span class="o">...</span>                          <span class="n">there</span><span class="s1">&#39;s no such thing as a kid who hates readi...</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">[</span><span class="mi">10</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">4</span> <span class="n">columns</span><span class="p">]</span>
</span></span></code></pre></div><p>Kết quả trả ra tốt hơn nhiều so với cách 2, donor1 có music, donor2 có cây trồng và sách.</p>
<h2 id="5-đánh-giá-mô-hình">5. Đánh giá mô hình<a class="anchor ms-1" href="#5-đánh-giá-mô-hình"><i class="fas fa-link"></i></a></h2>
<p>Có rất nhiều cách khác nhau để đánh giá mô hình recommend system. Một trong các cách mình sử dụng ở đây là sử dụng độ đo top K accuracy. Độ đo này được tính như sau:</p>
<p>Với mỗi user:
Với mỗi item user đã pick trong test set
Lấy mẫu 1000 item khác mà người dùng chưa bao giờ pick</p>
<p>Cảm ơn các bạn đã theo dõi. Hẹn gặp bạn ở các bài viết tiếp theo. Cố lên.</p>
</div></div>
  <div class="card-footer"><div class="post-navs d-flex justify-content-evenly"><div class="post-nav post-prev">
    <i class="fas fa-fw fa-chevron-left"></i>
    <a href="/blog/2018-12-11-a-bunch-of-tips-and-tricks-for-training-deep-neural-networks/">Một Số Mẹo Để Lựa Chọn Mô Hình Object Detection
</a>
  </div><div class="post-nav post-next">
    <a href="/blog/2019-02-05-5-python-tricks-you-need-to-know-today/">5 Mẹo Hay Sử Dụng Python
</a>
    <i class="fas fa-fw fa-chevron-right"></i>
  </div></div></div>
</article><div class="card component row post-comments" id="post-comments">
  <div class="card-header">
    <h2 class="card-title">Comments</h2>
  </div>
  <div class="card-body"><script src="https://utteranc.es/client.js"
  repo="AlexBlack2202/utterances"
  issue-term="pathname"
  label="comment"
  theme="github-dark"
  crossorigin="anonymous"
  async>
</script></div>
</div></div>
</div><aside class="col-lg-3 col-md-4 sidebar d-flex">
  <div class="container d-flex flex-column">
    
    <div class="post-toc row mb-4 card component" id="postTOC">
  <div class="card-header">
    <h2 class="card-title">Contents</h2>
  </div>
  <div class="card-body">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#đặt-vấn-đề">Đặt vấn đề</a>
      <ul>
        <li><a href="#phân-tích-dữ-liệu">Phân tích dữ liệu</a></li>
        <li><a href="#xây-dựng-chiến-lược-tiếp-cận-bài-toán">Xây dựng chiến lược tiếp cận bài toán</a></li>
        <li><a href="#1-tiền-xử-lý-dữ-liệu">1. Tiền xử lý dữ liệu</a></li>
        <li><a href="#2-xây-dựng-mô-hình-content-based-filtering">2. Xây dựng mô hình Content-Based Filtering</a>
          <ul>
            <li><a href="#a-xây-dựng-tập-đặc-trưng">a. Xây dựng tập đặc trưng</a></li>
            <li><a href="#b-xây-dựng-mô-hình">b. Xây dựng mô hình</a></li>
          </ul>
        </li>
        <li><a href="#3-collaborative-filtering-model">3. Collaborative Filtering Model</a>
          <ul>
            <li><a href="#a-xây-dựng-ma-trận-donor---project">a. Xây dựng ma trận donor - project</a></li>
            <li><a href="#b-singular-value-decomposition">b. Singular Value Decomposition</a></li>
            <li><a href="#c-xây-dựng-collaborative-filtering-model">c. Xây dựng Collaborative Filtering Model</a></li>
          </ul>
        </li>
        <li><a href="#4-hybrid-method">4. Hybrid Method</a></li>
        <li><a href="#5-đánh-giá-mô-hình">5. Đánh giá mô hình</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div><section class="recent-posts row card component">
  <div class="card-header">
    <h2 class="card-title">Recent Posts</h2>
  </div>
  <div class="card-body">
    <ul class="post-list"><li>
        <a href="/blog/2025-04-11-hash-equilibrium/">Tuyết Giác Trúc Lâm - Truyện AI
</a>
      </li><li>
        <a href="/blog/2025-04-20-ai-viet-truyen-tuyet-giac-truc-lam/">Cân Bằng Nash - Nash Equilibrium
</a>
      </li><li>
        <a href="/blog/2025-04-10-prisoner-dilemma/">Prisoner’s Dilemma - Song Đề Tù Nhân
</a>
      </li><li>
        <a href="/blog/2025-04-07-generative-ai-expertise-teamwork/">Song Kiếm Hợp Bích Giữa Generative Ai Và Chuyên Viên. Nấc Thang Lên Thiên Đường
</a>
      </li><li>
        <a href="/blog/2025-04-07-the-dictator-game/">The Dictator Game - Trò Chơi Độc Tài
</a>
      </li></ul>
  </div>
</section><section class="series-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/series">series</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/series/kh%C3%B3a-h%E1%BB%8Dc-python-c%C4%83n-b%E1%BA%A3n/" class="badge rounded post-taxonomy" title="Khóa Học Python Căn Bản">
            Khóa Học Python Căn Bản<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/series/kh%C3%B3a-h%E1%BB%8Dc-c&#43;&#43;-c%C4%83n-b%E1%BA%A3n/" class="badge rounded post-taxonomy" title="Khóa Học C&#43;&#43; Căn Bản">
            Khóa Học C&#43;&#43; Căn Bản<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/series/machine-learning-dataset/" class="badge rounded post-taxonomy" title="Machine Learning Dataset">
            Machine Learning Dataset<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href="/series/ch%E1%BB%A9ng-kho%C3%A1n-c%C4%83n-b%E1%BA%A3n/" class="badge rounded post-taxonomy" title="Chứng Khoán Căn Bản">
            Chứng Khoán Căn Bản<span class="badge badge-sm text-white bg-accent ms-1">1</span></a></div>
      </div>
    </section><section class="tools-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/tools">tools</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/tools/tool-random/" class="badge rounded post-taxonomy" title="Tool Random">
            Tool Random<span class="badge badge-sm text-white bg-accent ms-1">2</span></a></div>
      </div>
    </section><section class="categories-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/categories">categories</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/categories/python/" class="badge rounded post-taxonomy" title="Python">
            Python<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/categories/c&#43;&#43;/" class="badge rounded post-taxonomy" title="C&#43;&#43;">
            C&#43;&#43;<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/categories/dataset/" class="badge rounded post-taxonomy" title="Dataset">
            Dataset<span class="badge badge-sm text-white bg-accent ms-1">2</span></a></div>
      </div>
    </section><section class="tags-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/tags">tags</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/tags/machine-learning/" class="badge rounded post-taxonomy" title="Machine Learning">
            Machine Learning<span class="badge badge-sm text-white bg-accent ms-1">45</span></a><a href="/tags/deep-learning/" class="badge rounded post-taxonomy" title="Deep Learning">
            Deep Learning<span class="badge badge-sm text-white bg-accent ms-1">21</span></a><a href="/tags/deeplearning/" class="badge rounded post-taxonomy" title="DeepLearning">
            DeepLearning<span class="badge badge-sm text-white bg-accent ms-1">21</span></a><a href="/tags/python/" class="badge rounded post-taxonomy" title="Python">
            Python<span class="badge badge-sm text-white bg-accent ms-1">11</span></a><a href="/tags/opencv/" class="badge rounded post-taxonomy" title="Opencv">
            Opencv<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/tags/c&#43;&#43;/" class="badge rounded post-taxonomy" title="C&#43;&#43;">
            C&#43;&#43;<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/normalization/" class="badge rounded post-taxonomy" title="Normalization">
            Normalization<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/object-detector/" class="badge rounded post-taxonomy" title="Object Detector">
            Object Detector<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/recommendation/" class="badge rounded post-taxonomy" title="Recommendation">
            Recommendation<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/alexnet/" class="badge rounded post-taxonomy" title="AlexNet">
            AlexNet<span class="badge badge-sm text-white bg-accent ms-1">3</span></a></div>
      </div>
    </section>
    
  </div>
</aside>
</div>
    </main><footer class="footer mt-auto py-3 text-center container"><ul class="nav justify-content-between footer-memu mb-3"><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Support
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-github"></i>Repository
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-comments"></i>Discussions
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="/contact/"><i class="fas fa-fw fa-info-circle"></i>Contact Us
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="/faq/"><i class="fas fa-fw fa-question-circle"></i>FAQs
</a>
        </li></ul></li><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Docs
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="/team_of_services" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-users"></i>Điều khoản sử dụng
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="/privacy" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-lock"></i>Chính sách bảo mật
</a>
        </li></ul></li><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Features
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="https://www.phamduytung.com/utils/gen_paswords/" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-paw"></i>Tạo password ngẫu nhiên
</a>
        </li></ul></li><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Liên kết khác
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">Netlify
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">facebook
</a>
        </li></ul></li></ul>
<div class="copyright mb-2">
  Copyright © 2016-2025 Phạm Duy Tùng. All Rights Reserved.
</div>
<div class="powered-by mb-2">
  Website chia sẻ kiến thức của Phạm Duy Tùng và Đặng Thị Hằng. Vui lòng liên hệ email alexblack2202@gmail.com nếu bạn có thông tin cần trao đổi.
</div></footer>
<script src="/js/main.ed2053ad82a243b263761567b5c1aaf974487aa84adacb89ae3ddf803ecc248a.js" integrity="sha256-7SBTrYKiQ7JjdhVntcGq&#43;XRIeqhK2suJrj3fgD7MJIo=" crossorigin="anonymous" defer></script><script src="/js/icons.min.8ff200851002b8138e6b35314683092e02edc155465d9dbfb7d115460f8f1fbe.js" integrity="sha256-j/IAhRACuBOOazUxRoMJLgLtwVVGXZ2/t9EVRg&#43;PH74=" crossorigin="anonymous" defer></script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('\/service-worker.js').then(function(reg) {
      console.log('Successfully registered service worker', reg);
    }).catch(function(err) {
      console.warn('Error whilst registering service worker', err);
    });
  });
}
</script><script src="/js/viewer.min.ec58d2aa1a8916addf393be975fdf0070e8c872b0caef1673cb9f7eea067ce57.js" integrity="sha256-7FjSqhqJFq3fOTvpdf3wBw6MhysMrvFnPLn37qBnzlc=" crossorigin="anonymous" defer></script><script defer src="/js/katex.min.d5052035160facae59b60000106771baf2eb7671123813d21f1097a5a9218b6e.js" integrity="sha256-1QUgNRYPrK5ZtgAAEGdxuvLrdnESOBPSHxCXpakhi24=" crossorigin="anonymous"></script>

<script  data-ad-client="ca-pub-4644989745435991"  async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4644989745435991"
     crossorigin="anonymous"></script><script data-cfasync="false" type="text/javascript" data-adel="atag" src="//acscdn.com/script/atg.js" czid="eul3gyjdmm"></script>
  </body>
</html>
