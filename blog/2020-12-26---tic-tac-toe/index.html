<!doctype html><html lang="en" data-palette="blue"
   data-mode="dark">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Reinforcement Learning và tictactoe - Phạm Duy Tùng Machine Learning Blog</title>
    <meta name="a.validate.02" content="1QZXZ8oi7g57H-GxBrBPkTYBydwii-Ic9iJu" /><link rel="apple-touch-icon" href="/images/icons/icon-180x180.png" sizes="180x180">
<link rel="icon" href="/images/icons/icon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="/images/icons/icon-16x16.png" sizes="16x16" type="image/png">
<link rel="icon" href="/images/icons/favicon.ico">
<link rel="manifest" href="/manifest.json">
<meta name="keywords" content="" />
<meta name="description" content="Trong khi trong các phương pháp lý thuyết trò chơi nói chung, ví dụ thuật toán min-max, thuật toán luôn giả định chúng ta có một đối thủ hoàn hảo, công việc phải thực hiện là tối đa hóa phần thưởng của mình và giảm thiểu phần thưởng của đối thủ ( tối đa hóa điểm của mình và tối thiểu hóa điểm của đối thủ), trong học củng cố, chúng ta không cần giả định đối thủ của chúng ta là 1 thiên tài xuất chúng, nhưng chung ta vẫn thu được mô hình với kết quả rất tốt." /><meta name="robots" content="index, follow" />
  <meta itemprop="name" content="Reinforcement Learning và tictactoe">
  <meta itemprop="description" content="Trong khi trong các phương pháp lý thuyết trò chơi nói chung, ví dụ thuật toán min-max, thuật toán luôn giả định chúng ta có một đối thủ hoàn hảo, công việc phải thực hiện là tối đa hóa phần thưởng của mình và giảm thiểu phần thưởng của đối thủ ( tối đa hóa điểm của mình và tối thiểu hóa điểm của đối thủ), trong học củng cố, chúng ta không cần giả định đối thủ của chúng ta là 1 thiên tài xuất chúng, nhưng chung ta vẫn thu được mô hình với kết quả rất tốt.">
  <meta itemprop="datePublished" content="2020-12-27T00:19:00+03:00">
  <meta itemprop="dateModified" content="2020-12-27T00:19:00+03:00">
  <meta itemprop="wordCount" content="2758">
  <meta itemprop="image" content="https://unsplash.it/1920/1080?image=39">
  <meta itemprop="keywords" content="Reinforcement Learning,TicTacToe,Opencv"><meta property="og:url" content="/blog/2020-12-26---tic-tac-toe/">
  <meta property="og:site_name" content="Phạm Duy Tùng Machine Learning Blog">
  <meta property="og:title" content="Reinforcement Learning và tictactoe">
  <meta property="og:description" content="Trong khi trong các phương pháp lý thuyết trò chơi nói chung, ví dụ thuật toán min-max, thuật toán luôn giả định chúng ta có một đối thủ hoàn hảo, công việc phải thực hiện là tối đa hóa phần thưởng của mình và giảm thiểu phần thưởng của đối thủ ( tối đa hóa điểm của mình và tối thiểu hóa điểm của đối thủ), trong học củng cố, chúng ta không cần giả định đối thủ của chúng ta là 1 thiên tài xuất chúng, nhưng chung ta vẫn thu được mô hình với kết quả rất tốt.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2020-12-27T00:19:00+03:00">
    <meta property="article:modified_time" content="2020-12-27T00:19:00+03:00">
    <meta property="article:tag" content="Reinforcement Learning">
    <meta property="article:tag" content="TicTacToe">
    <meta property="article:tag" content="Opencv">
    <meta property="og:image" content="https://unsplash.it/1920/1080?image=39">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://unsplash.it/1920/1080?image=39">
  <meta name="twitter:title" content="Reinforcement Learning và tictactoe">
  <meta name="twitter:description" content="Trong khi trong các phương pháp lý thuyết trò chơi nói chung, ví dụ thuật toán min-max, thuật toán luôn giả định chúng ta có một đối thủ hoàn hảo, công việc phải thực hiện là tối đa hóa phần thưởng của mình và giảm thiểu phần thưởng của đối thủ ( tối đa hóa điểm của mình và tối thiểu hóa điểm của đối thủ), trong học củng cố, chúng ta không cần giả định đối thủ của chúng ta là 1 thiên tài xuất chúng, nhưng chung ta vẫn thu được mô hình với kết quả rất tốt.">
<link rel="stylesheet" href="/css/main.min.c06cf34535ee1f60ba08893b4d57e76b2bbd5e11c17ab12ef976f02983a51b54.css" integrity="sha256-wGzzRTXuH2C6CIk7TVfnayu9XhHBerEu&#43;XbwKYOlG1Q=" crossorigin="anonymous"><link rel="stylesheet" href="/css/katex.min.d080a89e03e1eb850f547d835c186b4273f69879aa497eb8b0e88c1578bf1f0b.css" integrity="sha256-0ICongPh64UPVH2DXBhrQnP2mHmqSX64sOiMFXi/Hws=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/viewer.min.3d228794bcedbbfa0412beb8fbc1ec6973202945e42af7004f742a4d7bd620ab.css" integrity="sha256-PSKHlLztu/oEEr64&#43;8HsaXMgKUXkKvcAT3QqTXvWIKs=" crossorigin="anonymous"><style>
    .bgcover {
        display: block;
        overflow: hidden;
        height: 450px;
        background: no-repeat center center;
        -webkit-background-size: cover;
        -moz-background-size: cover;
        -o-background-size: cover;
        background-size: cover;
        position: relative;
        margin-bottom: -65px;
    }
    .bgcover {
        margin-bottom: 0 !important;
    }

    .bgcover .bgtrans {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        display: block;
        overflow: hidden;
        height: inherit;
        background: rgba(0,0,0,.8);
        background: -webkit-gradient(linear,0% 0%,0% 100%,from(rgba(0,0,0,.8)),to (rgba(0,0,0,.6)),to(rgba(255,255,255,0)));
        background: -webkit-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
        background: -moz-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
        background: -ms-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
        background: -o-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
    }

    .bgcover .bgtrans h1 {
        display: block;
        overflow: hidden;
        font-size: 45px;
        line-height: 55px;
        color: #fff;
        width: 800px;
        margin: auto;
        position: absolute;
        left: 0;
        right: 0;
        bottom: 50px;
        font-family: 'Roboto Condensed',sans-serif;
        font-weight: 600;
    }
</style></head>
  <body><script>const items=["mode","palette"];items.forEach(function(e){const t=localStorage.getItem("hbs-"+e);t&&document.body.parentElement.setAttribute("data-"+e,t)})</script><header><nav class="navbar top-app-bar top-app-bar-expand-lg fixed-top">
  <div class="container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button><a class="navbar-brand flex-grow-1 flex-lg-grow-0 text-center text-lg-start mx-auto me-lg-3" href="/"><img class="logo" alt="Logo" src="/images/logo.webp" loading="lazy"  title="Logo"
   width="400" height="400"
   />
HOME
    </a>
    <div class="offcanvas offcanvas-bottom surface" tabindex="-1" id="offcanvasSocialShare" aria-labelledby="offcanvasSocialShare">
  <div class="offcanvas-header">
    <h3 class="offcanvas-title">Share</h3>
    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="offcanvas-body">
    <a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Twitter Share Button"
      target="_blank" href="https://twitter.com/intent/tweet?title=Reinforcement%20Learning%20v%c3%a0%20tictactoe&url=%2fblog%2f2020-12-26---tic-tac-toe%2f">
      <i class="fab fa-fw fa-twitter"></i> Twitter
    </a>
    <a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Facebook Share Button"
      target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=%2fblog%2f2020-12-26---tic-tac-toe%2f">
      <i class="fab fa-fw fa-facebook-f"></i> Facebook
    </a>
  </div>
</div>
    <button class="navbar-settings" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSettings"
  aria-controls="offcanvasSettings" aria-label="Toggle settings">
  <i class="fas fa-ellipsis-v"></i>
</button>

<div class="offcanvas offcanvas-end surface h-100" tabindex="-1" id="offcanvasSettings" aria-labelledby="offcanvasSettings">
  <div class="offcanvas-header">
    <h3 class="offcanvas-title">Settings</h3>
    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="offcanvas-body d-flex flex-column">



<section class="setting">
  <form class="font-size-switcher-form row">
    <div class="col-auto">
      <label for="fontSize" class="form-label"><i class="fas fa-fw fa-font"></i> Font Size</label>
    </div>
    <div class="col-auto ms-auto">
      <input type="range" class="form-range" min="-2" max="2" id="fontSize">
    </div>
  </form>
</section>


<section class="setting palettes">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-palette"></i> Palette</label>
    </div>
    <div class="col-auto ms-auto">
      <a id="btnPalette" class="btn btn-sm btn-outline-primary" role="button" aria-label="palettePicker">
        <i class="fas fa-eye-dropper"></i>
      </a>
    </div>
  </form>
  <div class="mt-2 d-flex justify-content-between visually-hidden" id="palettePicker"><button type="button" id="palette-blue" aria-label="Blue"
        class="btn btn-sm w-100 palette" data-palette="blue">
      </button><button type="button" id="palette-blue-gray" aria-label="Blue Gray"
        class="btn btn-sm w-100 palette" data-palette="blue-gray">
      </button><button type="button" id="palette-brown" aria-label="Brown"
        class="btn btn-sm w-100 palette" data-palette="brown">
      </button><button type="button" id="palette-cyan" aria-label="Cyan"
        class="btn btn-sm w-100 palette" data-palette="cyan">
      </button><button type="button" id="palette-green" aria-label="Green"
        class="btn btn-sm w-100 palette" data-palette="green">
      </button><button type="button" id="palette-indigo" aria-label="Indigo"
        class="btn btn-sm w-100 palette" data-palette="indigo">
      </button><button type="button" id="palette-orange" aria-label="Orange"
        class="btn btn-sm w-100 palette" data-palette="orange">
      </button><button type="button" id="palette-pink" aria-label="Pink"
        class="btn btn-sm w-100 palette" data-palette="pink">
      </button><button type="button" id="palette-purple" aria-label="Purple"
        class="btn btn-sm w-100 palette" data-palette="purple">
      </button><button type="button" id="palette-red" aria-label="Red"
        class="btn btn-sm w-100 palette" data-palette="red">
      </button><button type="button" id="palette-teal" aria-label="Teal"
        class="btn btn-sm w-100 palette" data-palette="teal">
      </button><button type="button" id="palette-yellow" aria-label="Yellow"
        class="btn btn-sm w-100 palette" data-palette="yellow">
      </button></div>
</section>
<section class="setting actions d-flex justify-content-around mt-auto overflow-auto">
  <a role="button" class="action action-go-back" href="javascript: window.history.back();">
    <span class="action-icon"><i class="fas fa-2x fa-arrow-left"></i></span> Go back
  </a>
  <a role="button" class="action action-reload-page">
    <span class="action-icon"><i class="fas fa-2x fa-redo-alt"></i></span> Reload
  </a>
  <a role="button" class="action action-copy-url">
    <span class="action-icon"><i class="fas fa-2x fa-link"></i></span> Copy URL
  </a><a class="action action-social-share" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSocialShare"
    aria-controls="offcanvasSocialShare" aria-label="Toggle social share">
    <span class="action-icon"><i class="fas fa-2x fa-share-alt"></i></span> Share
  </a></section>

</div>
</div>

    <div class="collapse navbar-collapse" tabindex="-1" id="navbarSupportedContent" aria-labelledby="navbarSupportedContent">
      <form class="search-bar my-1" action="/search">
  <div class="input-group input-group-sm">
    <span class="btn btn-search disabled position-absolute left-0"><i class="fas fa-fw fa-search"></i></span>
    <input class="form-control rounded-pill" name="q" type="search" aria-label="Search">
  </div>
</form>
      <ul class="navbar-nav ms-auto"><li class="nav-item">
          <a class="nav-link" href="/series/">
            <i class="fas fa-fw fa-columns"></i>Courses
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/tools/">
            <i class="fas fa-fw fa-folder"></i>Tools
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/categories/">
            <i class="fas fa-fw fa-folder"></i>Categories
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/archives/">
            <i class="fas fa-fw fa-file-archive"></i>Archives
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/tags/">
            <i class="fas fa-fw fa-tags"></i>Tags
          </a>
        </li><li class="nav-item dropdown">
          <a class="nav-link" id="navbarDropdownSupport" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-fw fa-chevron-circle-down"></i>Support
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdownSupport"><li>
              <a class="dropdown-item"
                href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">
                Repository
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">
                Discussions
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">
                Features Request
              </a>
            </li><li><hr class="dropdown-divider"></li><li>
              <a class="dropdown-item"
                href="/faq/">
                FAQs
              </a>
            </li></ul>
        </li></ul>
    </div>
  </div>
</nav>
</header>
<main role="main" class="container" style="line-height:1.7em">
      <div class="row content">
<div class="col-lg-9 col-md-8">
  <div class="container"><nav class="row card component" aria-label="breadcrumb">
  <div class="card-body">
    <ol class="breadcrumb "><li class="breadcrumb-item"><a href="/">Home</a></li><li class="breadcrumb-item"><a href="/blog/">Blogs</a></li><li class="breadcrumb-item active">Reinforcement Learning Và Tictactoe</li></ol>
  </div>
</nav>
<div class="post-panel-wrapper">
  <div class="d-flex flex-column component rounded post-panel">
    
    <a class="action action-panel-toggler" role="button" title="Panel toggler">
      <i class="fas fa-fw fa-chevron-circle-down"></i>
    </a>
    <a id="sidebarToggler" class="action d-none d-lg-block" role="button" title="Sidebar toggler">
  <i class="fas fa-fw fa-expand-alt" data-fa-transform="rotate-45"></i>
</a>

    

    
    
    <a class="action" href="#post-comments" role="button" aria-label="Comments" title="Comments">
  <i class="fas fa-fw fa-comments"></i>
</a>
    <a class="action" href="#postTOC" aria-controls="Table of contents" role="button" title="Table of contents">
  <i class="fas fa-fw fa-list-alt"></i>
</a>
    
  </div>
</div>
<article class="row card component mb-4 post">
  <div class="card-header ">
    <div class="bgcover" style="background-image:url(https://unsplash.it/1920/1080)" alt="Reinforcement Learning và tictactoe">
      <div class="bgtrans">
          <h1>Reinforcement Learning Và Tictactoe
</h1>
      </div>
  </div>
</div>
  <div class="card-body"><div class="post-meta">
  <span class="post-date" title="created on 2020-12-27 04:19:00 &#43;0700 &#43;07.">
    Dec 27, 2020
  </span><span class="post-reading-time">
    13 min read
  </span><span class="post-taxonomies"><a href="/tags/reinforcement-learning/" class="badge post-taxonomy">Reinforcement Learning</a><a href="/tags/tictactoe/" class="badge post-taxonomy">TicTacToe</a><a href="/tags/opencv/" class="badge post-taxonomy">Opencv</a></span>
</div>
<div class="post-content mb-3"><div class="toc">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#advantages-of-reinforcement-learning">Advantages of Reinforcement Learning</a></li>
    <li><a href="#thiết-lập-bàn-cờ">Thiết lập bàn cờ</a>
      <ul>
        <li><a href="#khởi-tạo-bàn-cờ">Khởi tạo bàn cờ</a></li>
        <li><a href="#kiểm-tra-reward">Kiểm tra Reward</a></li>
      </ul>
    </li>
    <li><a href="#thiết-lập-người-chơi">Thiết lập người chơi</a>
      <ul>
        <li><a href="#khởi-tạo">Khởi tạo</a></li>
        <li><a href="#chọn-nước-đi">Chọn nước đi</a></li>
        <li><a href="#cập-nhật-trạng-thái">Cập nhật trạng thái</a></li>
        <li><a href="#huấn-luyện-mô-hình">Huấn luyện mô hình</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
<h1 id="advantages-of-reinforcement-learning">Advantages of Reinforcement Learning<a class="anchor ms-1" href="#advantages-of-reinforcement-learning"><i class="fas fa-link"></i></a></h1>
<p>Trong khi trong các phương pháp lý thuyết trò chơi nói chung, ví dụ thuật toán min-max, thuật toán luôn giả định chúng ta có một đối thủ hoàn hảo, công việc phải thực hiện là tối đa hóa phần thưởng của mình và giảm thiểu phần thưởng của đối thủ ( tối đa hóa điểm của mình và tối thiểu hóa điểm của đối thủ), trong học củng cố, chúng ta không cần giả định đối thủ của chúng ta là 1 thiên tài xuất chúng, nhưng chung ta vẫn thu được mô hình với kết quả rất tốt.</p>
<p>Bằng cách coi đối thủ là một phần của môi trường mà chúng ta có thể tương tác, sau một số lần lặp lại nhất định, đối thủ có thể lập kế hoạch trước mà không cần chúng ta phải làm gì cả. Ưu điểm của phương pháp này là giảm số lượng không gian tìm kiếm và giảm số phép toán suy luận phải thực hiện, nhưng nó có thể đạt được kỹ năng hiện đại chỉ bằng cách thử và học.</p>
<p>Trong bài viết này, chúng ta sẽ làm các công việc sau:</p>
<ul>
<li>
<p>Thứ nhất, huấn luyện mô hình cho 2 máy đấu với nhau mà thu được các trọng số cần thiết.</p>
</li>
<li>
<p>Thứ hai, cho người đánh với máy</p>
</li>
</ul>
<p>Để hình thành bài toán học củng cố Reinforcement Learning , chúng ta cần  phải xác định rõ 3 thành phần chính:</p>
<ul>
<li>
<p>State</p>
</li>
<li>
<p>Action</p>
</li>
<li>
<p>Reward</p>
</li>
</ul>
<p>Với:</p>
<p>State chính là bàn cờ với các nước đi của các người chơi. Chúng ta sẽ tạo một bàn cờ có kích thước 3x3, giá trị của mỗi ô cờ đều là 0. Vị trí người chơi 1 đặt quân sẽ được gán là 1. Vị trí người chơi 2 đặt quân sẽ được gán là -1.</p>
<p>Action là vị trí người chơi sẽ đi quân khi biết state hiện tại (nghĩa là biết đối thủ đi nước nào, và có những nước nào hiện đang trên bàn cờ).</p>
<p>Reward: mang giá trị 0 hoặc 1. Khi kết thúc game sẽ trả về giá trị cho reward.</p>
<p>Ở phần dưới đây, mình sẽ note lại code và sẽ comment trong code để cho rõ ý</p>
<h1 id="thiết-lập-bàn-cờ">Thiết lập bàn cờ<a class="anchor ms-1" href="#thiết-lập-bàn-cờ"><i class="fas fa-link"></i></a></h1>
<h2 id="khởi-tạo-bàn-cờ">Khởi tạo bàn cờ<a class="anchor ms-1" href="#khởi-tạo-bàn-cờ"><i class="fas fa-link"></i></a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl">
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">BOARD_ROWS</span><span class="p">,</span> <span class="n">BOARD_COLS</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span> <span class="o">=</span> <span class="n">p1</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span> <span class="o">=</span> <span class="n">p2</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">boardHash</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">        <span class="c1"># init p1 plays first</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">playerSymbol</span> <span class="o">=</span> <span class="mi">1</span>
</span></span></code></pre></div><p>Chúng ta sẽ tạo một bàn cờ có kích thước 3x3, 2 biến người chơi. Người 1 là người chơi đầu tiên.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"># Trả về danh sách các nước có thể đi</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">def</span> <span class="nf">availablePositions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">        <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BOARD_ROWS</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BOARD_COLS</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">                    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>  <span class="c1"># need to be tuple</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="k">return</span> <span class="n">positions</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"># Cập nhật lại lên bàn cờ vị trí của người chơi đặt quân</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">def</span> <span class="nf">updateState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">position</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">playerSymbol</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="c1"># switch to another player</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">playerSymbol</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">playerSymbol</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span>
</span></span></code></pre></div><h2 id="kiểm-tra-reward">Kiểm tra Reward<a class="anchor ms-1" href="#kiểm-tra-reward"><i class="fas fa-link"></i></a></h2>
<p>Sau mỗi nước đi của các kỳ thủ, chúng ta cần 1 hàm để kiểm tra xem kỳ thủ thắng hay thua và trả về kết quả cho reward như đề cập ở trên</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">def</span> <span class="nf">winner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">	<span class="c1"># Kiểm tra theo dòng</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BOARD_ROWS</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">		<span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">			<span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">			<span class="k">return</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">		<span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">			<span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">	<span class="c1"># kiểm tra theo cột</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BOARD_COLS</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">		<span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">			<span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">			<span class="k">return</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">		<span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">			<span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">	<span class="c1"># kiểm tra theo đường chéo chính và theo đường chéo phụ</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">	<span class="n">diag_sum1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BOARD_COLS</span><span class="p">)])</span> <span class="c1"># đường chéo chính</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">	<span class="n">diag_sum2</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">BOARD_COLS</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BOARD_COLS</span><span class="p">)])</span> <span class="c1"># đường chéo phụ</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">	<span class="n">diag_sum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">diag_sum1</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diag_sum2</span><span class="p">))</span> <span class="c1"># lấy trị tuyệt đối của các nước đi, nếu bằng 3 nghĩa là có người chơi chiến thắng</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">	<span class="k">if</span> <span class="n">diag_sum</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">		<span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">		<span class="k">if</span> <span class="n">diag_sum1</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">diag_sum2</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">			<span class="k">return</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">		<span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">	<span class="c1"># Kiểm tra xem còn nước đi hay không</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availablePositions</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">		<span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">		<span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">
</span></span><span class="line"><span class="ln">43</span><span class="cl">	<span class="c1"># not end</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">	<span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">	<span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">
</span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="c1"># only when game ends</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="k">def</span> <span class="nf">giveReward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">	<span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">	<span class="c1"># backpropagate reward</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">	<span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">		<span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">feedReward</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">		<span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">feedReward</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">	<span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">		<span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">feedReward</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">		<span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">feedReward</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">	<span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">		<span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">feedReward</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">		<span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">feedReward</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span></span></code></pre></div><p>Ở đây có một lưu ý. Khi cờ hòa thì chúng ta cũng xem rằng người đi trước thua, nên hệ số lúc cờ hòa sẽ là 0.1-0.5. Các bạn có thể thiết lập một giá trị khác, ví dụ 0.2-0.5 hoặc 0.5-0.5 tùy thích.</p>
<h1 id="thiết-lập-người-chơi">Thiết lập người chơi<a class="anchor ms-1" href="#thiết-lập-người-chơi"><i class="fas fa-link"></i></a></h1>
<p>Người chơi cần có các phương thức sau:</p>
<ul>
<li>
<p>Chọn nước đi dựa trên trạng thái hiện tại của bàn cờ.</p>
</li>
<li>
<p>Lưu lại trạng thái của ván cờ.</p>
</li>
<li>
<p>Cập nhật lại giá trị trạng thái sau mỗi ván.</p>
</li>
<li>
<p>Lưu và load các trọng số lên.</p>
</li>
</ul>
<h2 id="khởi-tạo">Khởi tạo<a class="anchor ms-1" href="#khởi-tạo"><i class="fas fa-link"></i></a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl">
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">exp_rate</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># record all positions taken</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="mf">0.2</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">exp_rate</span> <span class="o">=</span> <span class="n">exp_rate</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">decay_gamma</span> <span class="o">=</span> <span class="mf">0.9</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># state -&gt; value</span>
</span></span></code></pre></div><h2 id="chọn-nước-đi">Chọn nước đi<a class="anchor ms-1" href="#chọn-nước-đi"><i class="fas fa-link"></i></a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">def</span> <span class="nf">chooseAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">current_board</span><span class="p">,</span> <span class="n">symbol</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">	<span class="n">randValue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">	<span class="n">value_max</span> <span class="o">=</span> <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="mi">999</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">	<span class="k">if</span>  <span class="n">randValue</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_rate</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">		<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">			<span class="n">next_board</span> <span class="o">=</span> <span class="n">current_board</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">			<span class="n">next_board</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbol</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">			<span class="n">next_boardHash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHash</span><span class="p">(</span><span class="n">next_board</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">			<span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="mi">999</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">next_boardHash</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">next_boardHash</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">			<span class="c1"># print(&#34;value&#34;, value)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">			<span class="k">if</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="n">value_max</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">				<span class="n">value_max</span> <span class="o">=</span> <span class="n">value</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">				<span class="n">action</span> <span class="o">=</span> <span class="n">p</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl">	<span class="k">if</span>  <span class="n">value_max</span> <span class="o">==</span> <span class="o">-</span><span class="mi">999</span> <span class="p">:</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">		<span class="c1"># take random action</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">		<span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">		<span class="n">action</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">	<span class="c1"># print(&#34;{} takes action {}&#34;.format(self.name, action))</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">	<span class="k">return</span> <span class="n">action</span>
</span></span></code></pre></div><h2 id="cập-nhật-trạng-thái">Cập nhật trạng thái<a class="anchor ms-1" href="#cập-nhật-trạng-thái"><i class="fas fa-link"></i></a></h2>
<p>Chúng ta sẽ cập nhật trạng thái với công thức sau</p>
<p>$$ V(S_t) = V(S_t) + \alpha [V(S_{t+1}) - V(S_t)]   $$</p>
<p>Diễn giải ra tiếng việt, giá trị của trạng thái tại thời điểm t bằng giá trị tại thời điểm hiện tại cộng với độ lệch của trạng thái hiện tại và trạng thái tiếp theo nhân với một hệ số học alpha.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl">
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"># at the end of game, backpropagate and update states value</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">def</span> <span class="nf">feedReward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reward</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">        <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">st</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span><span class="p">[</span><span class="n">st</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span><span class="p">[</span><span class="n">st</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decay_gamma</span> <span class="o">*</span> <span class="n">reward</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span><span class="p">[</span><span class="n">st</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">            <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span><span class="p">[</span><span class="n">st</span><span class="p">]</span>
</span></span></code></pre></div><h2 id="huấn-luyện-mô-hình">Huấn luyện mô hình<a class="anchor ms-1" href="#huấn-luyện-mô-hình"><i class="fas fa-link"></i></a></h2>
<p>Phần này nằm trong lớp State. Chúng ta sẽ lần lượt đi qua các quá trình luân phiên nhau giữa người chơi 1 và người chơi 2</p>
<p>người chơi chọn nước có thể đi -&gt; cập nhật trạng thái -&gt; kiểm tra thắng/thua -&gt; người chơi chọn nước có thể đi &hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rounds</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rounds</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">		<span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">			<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Rounds </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">		<span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">			<span class="c1"># Player 1</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">			<span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">availablePositions</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">			<span class="n">p1_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">chooseAction</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">playerSymbol</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">			<span class="c1"># take action and upate board state</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">			<span class="bp">self</span><span class="o">.</span><span class="n">updateState</span><span class="p">(</span><span class="n">p1_action</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">			<span class="n">board_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHash</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">			<span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">addState</span><span class="p">(</span><span class="n">board_hash</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">			<span class="c1"># check board status if it is end</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">			<span class="n">win</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">			<span class="k">if</span> <span class="n">win</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">				<span class="c1"># self.showBoard()</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">				<span class="c1"># ended with p1 either win or draw</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">				<span class="bp">self</span><span class="o">.</span><span class="n">giveReward</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">				<span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">				<span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">				<span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">				<span class="k">break</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">			<span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">				<span class="c1"># Player 2</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">				<span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">availablePositions</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">				<span class="n">p2_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">chooseAction</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">playerSymbol</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">				<span class="bp">self</span><span class="o">.</span><span class="n">updateState</span><span class="p">(</span><span class="n">p2_action</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">				<span class="n">board_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHash</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">				<span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">addState</span><span class="p">(</span><span class="n">board_hash</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl">				<span class="n">win</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">				<span class="k">if</span> <span class="n">win</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">					<span class="c1"># self.showBoard()</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">					<span class="c1"># ended with p2 either win or draw</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">					<span class="bp">self</span><span class="o">.</span><span class="n">giveReward</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">					<span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">					<span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">					<span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">					<span class="k">break</span>
</span></span></code></pre></div><p>Sau khi huấn luyện 100 ngàn lần, chúng ta sẽ chơi với máy, chỉ là 1 thay đổi nhỏ trong hàm chooseAction là thay vì lấy nước đi có trọng số lớn nhất, chúng ta sẽ cho người dùng nhập từ bàn phím dòng và cột vào</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl">
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">def</span> <span class="nf">chooseAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">            <span class="n">row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Input your action row:&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">            <span class="n">col</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Input your action col:&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">            <span class="n">action</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">            <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl">                <span class="k">return</span> <span class="n">action</span>
</span></span></code></pre></div><p>Và sửa lại hàm play một chút, bỏ loop 100k lần đi, bỏ gọi hàm cập nhật thưởng và bỏ các hàm reset đi</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"># play with human</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">def</span> <span class="nf">play2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">	<span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">		<span class="c1"># Player 1</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">		<span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">availablePositions</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">		<span class="n">p1_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">chooseAction</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">playerSymbol</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">		<span class="c1"># take action and upate board state</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">		<span class="bp">self</span><span class="o">.</span><span class="n">updateState</span><span class="p">(</span><span class="n">p1_action</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">		<span class="bp">self</span><span class="o">.</span><span class="n">showBoard</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">		<span class="c1"># check board status if it is end</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">		<span class="n">win</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">		<span class="k">if</span> <span class="n">win</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">			<span class="k">if</span> <span class="n">win</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">				<span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&#34;wins!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">			<span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">				<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;tie!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">			<span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">			<span class="k">break</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">		<span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">			<span class="c1"># Player 2</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">			<span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">availablePositions</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">			<span class="n">p2_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">chooseAction</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">			<span class="bp">self</span><span class="o">.</span><span class="n">updateState</span><span class="p">(</span><span class="n">p2_action</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">			<span class="bp">self</span><span class="o">.</span><span class="n">showBoard</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">			<span class="n">win</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">			<span class="k">if</span> <span class="n">win</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">				<span class="k">if</span> <span class="n">win</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">					<span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&#34;wins!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">				<span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">					<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;tie!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">				<span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">				<span class="k">break</span>
</span></span></code></pre></div><p>Mã nguồn hoàn chỉnh của chương trình</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">  1</span><span class="cl">
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="kn">import</span> <span class="nn">pickle</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl">
</span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="n">BOARD_ROWS</span> <span class="o">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="n">BOARD_COLS</span> <span class="o">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl">
</span></span><span class="line"><span class="ln">  8</span><span class="cl">
</span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="k">class</span> <span class="nc">State</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">BOARD_ROWS</span><span class="p">,</span> <span class="n">BOARD_COLS</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span> <span class="o">=</span> <span class="n">p1</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span> <span class="o">=</span> <span class="n">p2</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">boardHash</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">        <span class="c1"># init p1 plays first</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">playerSymbol</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">    <span class="c1"># get unique hash of current board state</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">    <span class="k">def</span> <span class="nf">getHash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">boardHash</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">BOARD_COLS</span> <span class="o">*</span> <span class="n">BOARD_ROWS</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boardHash</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">
</span></span><span class="line"><span class="ln"> 24</span><span class="cl">    <span class="k">def</span> <span class="nf">winner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">        <span class="c1"># row</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BOARD_ROWS</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">                <span class="k">return</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">        <span class="c1"># col</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BOARD_COLS</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">                <span class="k">return</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">        <span class="c1"># diagonal</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">        <span class="n">diag_sum1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BOARD_COLS</span><span class="p">)])</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">        <span class="n">diag_sum2</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">BOARD_COLS</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BOARD_COLS</span><span class="p">)])</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">        <span class="n">diag_sum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">diag_sum1</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diag_sum2</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">        <span class="k">if</span> <span class="n">diag_sum</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">            <span class="k">if</span> <span class="n">diag_sum1</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">diag_sum2</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">                <span class="k">return</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">        <span class="c1"># tie</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">        <span class="c1"># no available positions</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">availablePositions</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">            <span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">        <span class="c1"># not end</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">        <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">    <span class="k">def</span> <span class="nf">availablePositions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">        <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BOARD_ROWS</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BOARD_COLS</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">                    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>  <span class="c1"># need to be tuple</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">        <span class="k">return</span> <span class="n">positions</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">    <span class="k">def</span> <span class="nf">updateState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">position</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">playerSymbol</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">        <span class="c1"># switch to another player</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">playerSymbol</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">playerSymbol</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">    <span class="c1"># only when game ends</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">    <span class="k">def</span> <span class="nf">giveReward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">        <span class="c1"># backpropagate reward</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">        <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">feedReward</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">feedReward</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">        <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">feedReward</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">feedReward</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">feedReward</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">feedReward</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">    <span class="c1"># board reset</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">BOARD_ROWS</span><span class="p">,</span> <span class="n">BOARD_COLS</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">boardHash</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">playerSymbol</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">    <span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rounds</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rounds</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Rounds </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">            <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">                <span class="c1"># Player 1</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">                <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">availablePositions</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">                <span class="n">p1_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">chooseAction</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">playerSymbol</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">                <span class="c1"># take action and upate board state</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">updateState</span><span class="p">(</span><span class="n">p1_action</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">                <span class="n">board_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHash</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">addState</span><span class="p">(</span><span class="n">board_hash</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">                <span class="c1"># check board status if it is end</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl">
</span></span><span class="line"><span class="ln">109</span><span class="cl">                <span class="n">win</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">                <span class="k">if</span> <span class="n">win</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">                    <span class="c1"># self.showBoard()</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">                    <span class="c1"># ended with p1 either win or draw</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">giveReward</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">                    <span class="k">break</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl">
</span></span><span class="line"><span class="ln">119</span><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl">                    <span class="c1"># Player 2</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">                    <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">availablePositions</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">                    <span class="n">p2_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">chooseAction</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">playerSymbol</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">updateState</span><span class="p">(</span><span class="n">p2_action</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">                    <span class="n">board_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHash</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">addState</span><span class="p">(</span><span class="n">board_hash</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">
</span></span><span class="line"><span class="ln">127</span><span class="cl">                    <span class="n">win</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">                    <span class="k">if</span> <span class="n">win</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">                        <span class="c1"># self.showBoard()</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl">                        <span class="c1"># ended with p2 either win or draw</span>
</span></span><span class="line"><span class="ln">131</span><span class="cl">                        <span class="bp">self</span><span class="o">.</span><span class="n">giveReward</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">                        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">                        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">                        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">                        <span class="k">break</span>
</span></span><span class="line"><span class="ln">136</span><span class="cl">
</span></span><span class="line"><span class="ln">137</span><span class="cl">
</span></span><span class="line"><span class="ln">138</span><span class="cl">    <span class="c1"># play with human</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">    <span class="k">def</span> <span class="nf">play2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">140</span><span class="cl">        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isEnd</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl">            <span class="c1"># Player 1</span>
</span></span><span class="line"><span class="ln">142</span><span class="cl">            <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">availablePositions</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl">            <span class="n">p1_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">chooseAction</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">playerSymbol</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">            <span class="c1"># take action and upate board state</span>
</span></span><span class="line"><span class="ln">145</span><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">updateState</span><span class="p">(</span><span class="n">p1_action</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">showBoard</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl">            <span class="c1"># check board status if it is end</span>
</span></span><span class="line"><span class="ln">148</span><span class="cl">            <span class="n">win</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">149</span><span class="cl">            <span class="k">if</span> <span class="n">win</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">150</span><span class="cl">                <span class="k">if</span> <span class="n">win</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">151</span><span class="cl">                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&#34;wins!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">152</span><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">153</span><span class="cl">                    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;tie!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">154</span><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">155</span><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="ln">156</span><span class="cl">
</span></span><span class="line"><span class="ln">157</span><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">158</span><span class="cl">                <span class="c1"># Player 2</span>
</span></span><span class="line"><span class="ln">159</span><span class="cl">                <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">availablePositions</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">160</span><span class="cl">                <span class="n">p2_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">chooseAction</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">161</span><span class="cl">
</span></span><span class="line"><span class="ln">162</span><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">updateState</span><span class="p">(</span><span class="n">p2_action</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">163</span><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">showBoard</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">164</span><span class="cl">                <span class="n">win</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">165</span><span class="cl">                <span class="k">if</span> <span class="n">win</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">166</span><span class="cl">                    <span class="k">if</span> <span class="n">win</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">167</span><span class="cl">                        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&#34;wins!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">168</span><span class="cl">                    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">169</span><span class="cl">                        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;tie!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">170</span><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">171</span><span class="cl">                    <span class="k">break</span>
</span></span><span class="line"><span class="ln">172</span><span class="cl">
</span></span><span class="line"><span class="ln">173</span><span class="cl">
</span></span><span class="line"><span class="ln">174</span><span class="cl">    <span class="k">def</span> <span class="nf">showBoard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">175</span><span class="cl">        <span class="c1"># p1: x  p2: o</span>
</span></span><span class="line"><span class="ln">176</span><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">BOARD_ROWS</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">177</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------------&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">178</span><span class="cl">            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;| &#39;</span>
</span></span><span class="line"><span class="ln">179</span><span class="cl">            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">BOARD_COLS</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">180</span><span class="cl">                <span class="n">token</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">181</span><span class="cl">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">182</span><span class="cl">                    <span class="n">token</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
</span></span><span class="line"><span class="ln">183</span><span class="cl">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">184</span><span class="cl">                    <span class="n">token</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span>
</span></span><span class="line"><span class="ln">185</span><span class="cl">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">186</span><span class="cl">                    <span class="n">token</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
</span></span><span class="line"><span class="ln">187</span><span class="cl">                <span class="n">out</span> <span class="o">+=</span> <span class="n">token</span> <span class="o">+</span> <span class="s1">&#39; | &#39;</span>
</span></span><span class="line"><span class="ln">188</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">189</span><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------------&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">190</span><span class="cl">
</span></span><span class="line"><span class="ln">191</span><span class="cl">
</span></span><span class="line"><span class="ln">192</span><span class="cl"><span class="k">class</span> <span class="nc">Player</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">193</span><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">exp_rate</span><span class="o">=</span><span class="mf">0.3</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">194</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="ln">195</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># record all positions taken</span>
</span></span><span class="line"><span class="ln">196</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="mf">0.3</span>
</span></span><span class="line"><span class="ln">197</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">exp_rate</span> <span class="o">=</span> <span class="n">exp_rate</span>
</span></span><span class="line"><span class="ln">198</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">decay_gamma</span> <span class="o">=</span> <span class="mf">0.9</span>
</span></span><span class="line"><span class="ln">199</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># state -&gt; value</span>
</span></span><span class="line"><span class="ln">200</span><span class="cl">
</span></span><span class="line"><span class="ln">201</span><span class="cl">    <span class="k">def</span> <span class="nf">getHash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">board</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">202</span><span class="cl">        <span class="n">boardHash</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">BOARD_COLS</span> <span class="o">*</span> <span class="n">BOARD_ROWS</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">203</span><span class="cl">        <span class="k">return</span> <span class="n">boardHash</span>
</span></span><span class="line"><span class="ln">204</span><span class="cl">
</span></span><span class="line"><span class="ln">205</span><span class="cl">    <span class="k">def</span> <span class="nf">chooseAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">current_board</span><span class="p">,</span> <span class="n">symbol</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">206</span><span class="cl">        <span class="n">randValue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">207</span><span class="cl">        <span class="n">value_max</span> <span class="o">=</span> <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="mi">999</span>
</span></span><span class="line"><span class="ln">208</span><span class="cl">        <span class="k">if</span>  <span class="n">randValue</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_rate</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">209</span><span class="cl">
</span></span><span class="line"><span class="ln">210</span><span class="cl">            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">211</span><span class="cl">                <span class="n">next_board</span> <span class="o">=</span> <span class="n">current_board</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">212</span><span class="cl">                <span class="n">next_board</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbol</span>
</span></span><span class="line"><span class="ln">213</span><span class="cl">                <span class="n">next_boardHash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHash</span><span class="p">(</span><span class="n">next_board</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">214</span><span class="cl">                <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="mi">999</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">next_boardHash</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">next_boardHash</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">215</span><span class="cl">                <span class="c1"># print(&#34;value&#34;, value)</span>
</span></span><span class="line"><span class="ln">216</span><span class="cl">                <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="n">value_max</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">217</span><span class="cl">                    <span class="n">value_max</span> <span class="o">=</span> <span class="n">value</span>
</span></span><span class="line"><span class="ln">218</span><span class="cl">                    <span class="n">action</span> <span class="o">=</span> <span class="n">p</span>
</span></span><span class="line"><span class="ln">219</span><span class="cl">
</span></span><span class="line"><span class="ln">220</span><span class="cl">        <span class="k">if</span>  <span class="n">value_max</span> <span class="o">==</span> <span class="o">-</span><span class="mi">999</span> <span class="p">:</span>
</span></span><span class="line"><span class="ln">221</span><span class="cl">            <span class="c1"># take random action</span>
</span></span><span class="line"><span class="ln">222</span><span class="cl">            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">223</span><span class="cl">            <span class="n">action</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">224</span><span class="cl">
</span></span><span class="line"><span class="ln">225</span><span class="cl">        <span class="c1"># print(&#34;{} takes action {}&#34;.format(self.name, action))</span>
</span></span><span class="line"><span class="ln">226</span><span class="cl">        <span class="k">return</span> <span class="n">action</span>
</span></span><span class="line"><span class="ln">227</span><span class="cl">
</span></span><span class="line"><span class="ln">228</span><span class="cl">    <span class="c1"># append a hash state</span>
</span></span><span class="line"><span class="ln">229</span><span class="cl">    <span class="k">def</span> <span class="nf">addState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">230</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">231</span><span class="cl">
</span></span><span class="line"><span class="ln">232</span><span class="cl">    <span class="c1"># at the end of game, backpropagate and update states value</span>
</span></span><span class="line"><span class="ln">233</span><span class="cl">    <span class="k">def</span> <span class="nf">feedReward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reward</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">234</span><span class="cl">        <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">235</span><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">st</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">236</span><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span><span class="p">[</span><span class="n">st</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln">237</span><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span><span class="p">[</span><span class="n">st</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decay_gamma</span> <span class="o">*</span> <span class="n">reward</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span><span class="p">[</span><span class="n">st</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">238</span><span class="cl">            <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span><span class="p">[</span><span class="n">st</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">239</span><span class="cl">
</span></span><span class="line"><span class="ln">240</span><span class="cl">    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">241</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="ln">242</span><span class="cl">
</span></span><span class="line"><span class="ln">243</span><span class="cl">    <span class="k">def</span> <span class="nf">savePolicy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">244</span><span class="cl">        <span class="n">fw</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;policy_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">245</span><span class="cl">        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states_value</span><span class="p">,</span> <span class="n">fw</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">246</span><span class="cl">        <span class="n">fw</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">247</span><span class="cl">
</span></span><span class="line"><span class="ln">248</span><span class="cl">    <span class="k">def</span> <span class="nf">loadPolicy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">249</span><span class="cl">        <span class="n">fr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">250</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">states_value</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fr</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">251</span><span class="cl">        <span class="n">fr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">252</span><span class="cl">
</span></span><span class="line"><span class="ln">253</span><span class="cl">
</span></span><span class="line"><span class="ln">254</span><span class="cl"><span class="k">class</span> <span class="nc">HumanPlayer</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">255</span><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">256</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="ln">257</span><span class="cl">
</span></span><span class="line"><span class="ln">258</span><span class="cl">    <span class="k">def</span> <span class="nf">chooseAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">259</span><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">260</span><span class="cl">            <span class="n">row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Input your action row:&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">261</span><span class="cl">            <span class="n">col</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Input your action col:&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">262</span><span class="cl">            <span class="n">action</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">263</span><span class="cl">            <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">264</span><span class="cl">                <span class="k">return</span> <span class="n">action</span>
</span></span><span class="line"><span class="ln">265</span><span class="cl">
</span></span><span class="line"><span class="ln">266</span><span class="cl">    <span class="c1"># append a hash state</span>
</span></span><span class="line"><span class="ln">267</span><span class="cl">    <span class="k">def</span> <span class="nf">addState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">268</span><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="ln">269</span><span class="cl">
</span></span><span class="line"><span class="ln">270</span><span class="cl">    <span class="c1"># at the end of game, backpropagate and update states value</span>
</span></span><span class="line"><span class="ln">271</span><span class="cl">    <span class="k">def</span> <span class="nf">feedReward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reward</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">272</span><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="ln">273</span><span class="cl">
</span></span><span class="line"><span class="ln">274</span><span class="cl">    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">275</span><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="ln">276</span><span class="cl">
</span></span><span class="line"><span class="ln">277</span><span class="cl">
</span></span><span class="line"><span class="ln">278</span><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">279</span><span class="cl">    <span class="c1"># training</span>
</span></span><span class="line"><span class="ln">280</span><span class="cl">    <span class="n">p1</span> <span class="o">=</span> <span class="n">Player</span><span class="p">(</span><span class="s2">&#34;p1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">281</span><span class="cl">    <span class="n">p2</span> <span class="o">=</span> <span class="n">Player</span><span class="p">(</span><span class="s2">&#34;p2&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">282</span><span class="cl">
</span></span><span class="line"><span class="ln">283</span><span class="cl">    <span class="n">st</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">284</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;training...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">285</span><span class="cl">    <span class="n">st</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">286</span><span class="cl">
</span></span><span class="line"><span class="ln">287</span><span class="cl">    <span class="n">p1</span><span class="o">.</span><span class="n">savePolicy</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">288</span><span class="cl">
</span></span><span class="line"><span class="ln">289</span><span class="cl">    <span class="c1"># play with human</span>
</span></span><span class="line"><span class="ln">290</span><span class="cl">    <span class="n">p1</span> <span class="o">=</span> <span class="n">Player</span><span class="p">(</span><span class="s2">&#34;computer&#34;</span><span class="p">,</span> <span class="n">exp_rate</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">291</span><span class="cl">    <span class="n">p1</span><span class="o">.</span><span class="n">loadPolicy</span><span class="p">(</span><span class="s2">&#34;policy_p1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">292</span><span class="cl">
</span></span><span class="line"><span class="ln">293</span><span class="cl">    <span class="n">p2</span> <span class="o">=</span> <span class="n">HumanPlayer</span><span class="p">(</span><span class="s2">&#34;human&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">294</span><span class="cl">
</span></span><span class="line"><span class="ln">295</span><span class="cl">    <span class="n">st</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">296</span><span class="cl">    <span class="n">st</span><span class="o">.</span><span class="n">play2</span><span class="p">()</span>
</span></span></code></pre></div><p>Nguồn</p>
<ul>
<li>
<p>Reinforcement Learning: An Introduction phiên bản 2 của Richard S. Sutton and Andrew G. Barto</p>
</li>
<li>
<p><a href="https://towardsdatascience.com/reinforcement-learning-implement-tictactoe-189582bea542" target="_blank" rel="noopener noreferrer">https://towardsdatascience.com/reinforcement-learning-implement-tictactoe-189582bea542</a></p>
</li>
</ul>
</div></div>
  <div class="card-footer"><div class="post-navs d-flex justify-content-evenly"><div class="post-nav post-prev">
    <i class="fas fa-fw fa-chevron-left"></i>
    <a href="/blog/2020-12-25---tetric/">Xây Dựng Game Xếp Gạch Bằng Opencv Và Python
</a>
  </div><div class="post-nav post-next">
    <a href="/blog/2021-01-15---adabelief-optimizer/">Tìm Hiểu Thuật Toán Tối Ưu Hóa Adabelief Optimizer
</a>
    <i class="fas fa-fw fa-chevron-right"></i>
  </div></div></div>
</article><div class="card component row post-comments" id="post-comments">
  <div class="card-header">
    <h2 class="card-title">Comments</h2>
  </div>
  <div class="card-body"><script src="https://utteranc.es/client.js"
  repo="AlexBlack2202/utterances"
  issue-term="pathname"
  label="comment"
  theme="github-dark"
  crossorigin="anonymous"
  async>
</script></div>
</div></div>
</div><aside class="col-lg-3 col-md-4 sidebar d-flex">
  <div class="container d-flex flex-column">
    
    <div class="post-toc row mb-4 card component" id="postTOC">
  <div class="card-header">
    <h2 class="card-title">Contents</h2>
  </div>
  <div class="card-body">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#advantages-of-reinforcement-learning">Advantages of Reinforcement Learning</a></li>
    <li><a href="#thiết-lập-bàn-cờ">Thiết lập bàn cờ</a>
      <ul>
        <li><a href="#khởi-tạo-bàn-cờ">Khởi tạo bàn cờ</a></li>
        <li><a href="#kiểm-tra-reward">Kiểm tra Reward</a></li>
      </ul>
    </li>
    <li><a href="#thiết-lập-người-chơi">Thiết lập người chơi</a>
      <ul>
        <li><a href="#khởi-tạo">Khởi tạo</a></li>
        <li><a href="#chọn-nước-đi">Chọn nước đi</a></li>
        <li><a href="#cập-nhật-trạng-thái">Cập nhật trạng thái</a></li>
        <li><a href="#huấn-luyện-mô-hình">Huấn luyện mô hình</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div><section class="recent-posts row card component">
  <div class="card-header">
    <h2 class="card-title">Recent Posts</h2>
  </div>
  <div class="card-body">
    <ul class="post-list"><li>
        <a href="/blog/2025-04-26-how-brands-grow/">Khám Phá Bí Mật Đằng Sau Sự Thành Công Của Các Thương Hiệu
</a>
      </li><li>
        <a href="/blog/2025-04-11-hash-equilibrium/">Tuyết Giác Trúc Lâm - Truyện AI
</a>
      </li><li>
        <a href="/blog/2025-04-20-ai-viet-truyen-tuyet-giac-truc-lam/">Cân Bằng Nash - Nash Equilibrium
</a>
      </li><li>
        <a href="/blog/2025-04-10-prisoner-dilemma/">Prisoner’s Dilemma - Song Đề Tù Nhân
</a>
      </li><li>
        <a href="/blog/2025-04-07-generative-ai-expertise-teamwork/">Song Kiếm Hợp Bích Giữa Generative Ai Và Chuyên Viên. Nấc Thang Lên Thiên Đường
</a>
      </li></ul>
  </div>
</section><section class="series-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/series">series</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/series/kh%C3%B3a-h%E1%BB%8Dc-python-c%C4%83n-b%E1%BA%A3n/" class="badge rounded post-taxonomy" title="Khóa Học Python Căn Bản">
            Khóa Học Python Căn Bản<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/series/kh%C3%B3a-h%E1%BB%8Dc-c&#43;&#43;-c%C4%83n-b%E1%BA%A3n/" class="badge rounded post-taxonomy" title="Khóa Học C&#43;&#43; Căn Bản">
            Khóa Học C&#43;&#43; Căn Bản<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/series/machine-learning-dataset/" class="badge rounded post-taxonomy" title="Machine Learning Dataset">
            Machine Learning Dataset<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href="/series/ch%E1%BB%A9ng-kho%C3%A1n-c%C4%83n-b%E1%BA%A3n/" class="badge rounded post-taxonomy" title="Chứng Khoán Căn Bản">
            Chứng Khoán Căn Bản<span class="badge badge-sm text-white bg-accent ms-1">1</span></a></div>
      </div>
    </section><section class="tools-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/tools">tools</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/tools/tool-random/" class="badge rounded post-taxonomy" title="Tool Random">
            Tool Random<span class="badge badge-sm text-white bg-accent ms-1">2</span></a></div>
      </div>
    </section><section class="categories-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/categories">categories</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/categories/python/" class="badge rounded post-taxonomy" title="Python">
            Python<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/categories/c&#43;&#43;/" class="badge rounded post-taxonomy" title="C&#43;&#43;">
            C&#43;&#43;<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/categories/dataset/" class="badge rounded post-taxonomy" title="Dataset">
            Dataset<span class="badge badge-sm text-white bg-accent ms-1">2</span></a></div>
      </div>
    </section><section class="tags-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/tags">tags</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/tags/machine-learning/" class="badge rounded post-taxonomy" title="Machine Learning">
            Machine Learning<span class="badge badge-sm text-white bg-accent ms-1">45</span></a><a href="/tags/deep-learning/" class="badge rounded post-taxonomy" title="Deep Learning">
            Deep Learning<span class="badge badge-sm text-white bg-accent ms-1">21</span></a><a href="/tags/deeplearning/" class="badge rounded post-taxonomy" title="DeepLearning">
            DeepLearning<span class="badge badge-sm text-white bg-accent ms-1">21</span></a><a href="/tags/python/" class="badge rounded post-taxonomy" title="Python">
            Python<span class="badge badge-sm text-white bg-accent ms-1">11</span></a><a href="/tags/opencv/" class="badge rounded post-taxonomy" title="Opencv">
            Opencv<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/tags/c&#43;&#43;/" class="badge rounded post-taxonomy" title="C&#43;&#43;">
            C&#43;&#43;<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/game-theory/" class="badge rounded post-taxonomy" title="Game Theory">
            Game Theory<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/normalization/" class="badge rounded post-taxonomy" title="Normalization">
            Normalization<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/object-detector/" class="badge rounded post-taxonomy" title="Object Detector">
            Object Detector<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/recommendation/" class="badge rounded post-taxonomy" title="Recommendation">
            Recommendation<span class="badge badge-sm text-white bg-accent ms-1">4</span></a></div>
      </div>
    </section>
    
  </div>
</aside>
</div>
    </main><footer class="footer mt-auto py-3 text-center container"><ul class="nav justify-content-between footer-memu mb-3"><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Support
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-github"></i>Repository
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-comments"></i>Discussions
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="/contact/"><i class="fas fa-fw fa-info-circle"></i>Contact Us
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="/faq/"><i class="fas fa-fw fa-question-circle"></i>FAQs
</a>
        </li></ul></li><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Docs
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="/team_of_services" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-users"></i>Điều khoản sử dụng
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="/privacy" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-lock"></i>Chính sách bảo mật
</a>
        </li></ul></li><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Features
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="https://www.phamduytung.com/utils/gen_paswords/" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-paw"></i>Tạo password ngẫu nhiên
</a>
        </li></ul></li><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Liên kết khác
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">Netlify
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">facebook
</a>
        </li></ul></li></ul>
<div class="copyright mb-2">
  Copyright © 2016-2025 Phạm Duy Tùng. All Rights Reserved.
</div>
<div class="powered-by mb-2">
  Website chia sẻ kiến thức của Phạm Duy Tùng và Đặng Thị Hằng. Vui lòng liên hệ email alexblack2202@gmail.com nếu bạn có thông tin cần trao đổi.
</div></footer>
<script src="/js/main.ed2053ad82a243b263761567b5c1aaf974487aa84adacb89ae3ddf803ecc248a.js" integrity="sha256-7SBTrYKiQ7JjdhVntcGq&#43;XRIeqhK2suJrj3fgD7MJIo=" crossorigin="anonymous" defer></script><script src="/js/icons.min.8ff200851002b8138e6b35314683092e02edc155465d9dbfb7d115460f8f1fbe.js" integrity="sha256-j/IAhRACuBOOazUxRoMJLgLtwVVGXZ2/t9EVRg&#43;PH74=" crossorigin="anonymous" defer></script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('\/service-worker.js').then(function(reg) {
      console.log('Successfully registered service worker', reg);
    }).catch(function(err) {
      console.warn('Error whilst registering service worker', err);
    });
  });
}
</script><script src="/js/viewer.min.ec58d2aa1a8916addf393be975fdf0070e8c872b0caef1673cb9f7eea067ce57.js" integrity="sha256-7FjSqhqJFq3fOTvpdf3wBw6MhysMrvFnPLn37qBnzlc=" crossorigin="anonymous" defer></script><script defer src="/js/katex.min.d5052035160facae59b60000106771baf2eb7671123813d21f1097a5a9218b6e.js" integrity="sha256-1QUgNRYPrK5ZtgAAEGdxuvLrdnESOBPSHxCXpakhi24=" crossorigin="anonymous"></script>

<script  data-ad-client="ca-pub-4644989745435991"  async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4644989745435991"
     crossorigin="anonymous"></script><script data-cfasync="false" type="text/javascript" data-adel="atag" src="//acscdn.com/script/atg.js" czid="eul3gyjdmm"></script>
  </body>
</html>
