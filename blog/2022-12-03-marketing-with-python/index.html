<!doctype html><html lang="en" data-palette="blue"
   data-mode="dark">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Marketing thực chiến - Phân loại khách hàng sử dụng RFM Analysis - Phạm Duy Tùng Machine Learning Blog</title>
    <meta name="a.validate.02" content="1QZXZ8oi7g57H-GxBrBPkTYBydwii-Ic9iJu" /><link rel="apple-touch-icon" href="/images/icons/icon-180x180.png" sizes="180x180">
<link rel="icon" href="/images/icons/icon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="/images/icons/icon-16x16.png" sizes="16x16" type="image/png">
<link rel="icon" href="/images/icons/favicon.ico">
<link rel="manifest" href="/manifest.json">
<meta name="keywords" content="" />
<meta name="description" content="RFM là model được sử dụng trong phân tích marketing, dùng để phân nhóm khách hàng của công ty dựa trên các pattern mua hàng hoặc thói quen của họ. Chúng ta cùng tìm hiểu chi tiết về RFM, ứng dụng của nó, và thử sử dụng nó để phân tích data xem sao nhé" /><meta name="robots" content="index, follow" />
  <meta itemprop="name" content="Marketing thực chiến - Phân loại khách hàng sử dụng RFM Analysis">
  <meta itemprop="description" content="RFM là model được sử dụng trong phân tích marketing, dùng để phân nhóm khách hàng của công ty dựa trên các pattern mua hàng hoặc thói quen của họ. Chúng ta cùng tìm hiểu chi tiết về RFM, ứng dụng của nó, và thử sử dụng nó để phân tích data xem sao nhé">
  <meta itemprop="datePublished" content="2022-12-04T00:19:00+03:00">
  <meta itemprop="dateModified" content="2022-12-04T00:19:00+03:00">
  <meta itemprop="wordCount" content="3435">
  <meta itemprop="image" content="https://unsplash.it/1920/1080?image=17">
  <meta itemprop="keywords" content="RFM,Recommendation,Marketing"><meta property="og:url" content="/blog/2022-12-03-marketing-with-python/">
  <meta property="og:site_name" content="Phạm Duy Tùng Machine Learning Blog">
  <meta property="og:title" content="Marketing thực chiến - Phân loại khách hàng sử dụng RFM Analysis">
  <meta property="og:description" content="RFM là model được sử dụng trong phân tích marketing, dùng để phân nhóm khách hàng của công ty dựa trên các pattern mua hàng hoặc thói quen của họ. Chúng ta cùng tìm hiểu chi tiết về RFM, ứng dụng của nó, và thử sử dụng nó để phân tích data xem sao nhé">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2022-12-04T00:19:00+03:00">
    <meta property="article:modified_time" content="2022-12-04T00:19:00+03:00">
    <meta property="article:tag" content="RFM">
    <meta property="article:tag" content="Recommendation">
    <meta property="article:tag" content="Marketing">
    <meta property="og:image" content="https://unsplash.it/1920/1080?image=17">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://unsplash.it/1920/1080?image=17">
  <meta name="twitter:title" content="Marketing thực chiến - Phân loại khách hàng sử dụng RFM Analysis">
  <meta name="twitter:description" content="RFM là model được sử dụng trong phân tích marketing, dùng để phân nhóm khách hàng của công ty dựa trên các pattern mua hàng hoặc thói quen của họ. Chúng ta cùng tìm hiểu chi tiết về RFM, ứng dụng của nó, và thử sử dụng nó để phân tích data xem sao nhé">
<link rel="stylesheet" href="/css/main.min.c06cf34535ee1f60ba08893b4d57e76b2bbd5e11c17ab12ef976f02983a51b54.css" integrity="sha256-wGzzRTXuH2C6CIk7TVfnayu9XhHBerEu&#43;XbwKYOlG1Q=" crossorigin="anonymous"><link rel="stylesheet" href="/css/katex.min.d080a89e03e1eb850f547d835c186b4273f69879aa497eb8b0e88c1578bf1f0b.css" integrity="sha256-0ICongPh64UPVH2DXBhrQnP2mHmqSX64sOiMFXi/Hws=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/viewer.min.3d228794bcedbbfa0412beb8fbc1ec6973202945e42af7004f742a4d7bd620ab.css" integrity="sha256-PSKHlLztu/oEEr64&#43;8HsaXMgKUXkKvcAT3QqTXvWIKs=" crossorigin="anonymous"><style>
    .bgcover {
        display: block;
        overflow: hidden;
        height: 450px;
        background: no-repeat center center;
        -webkit-background-size: cover;
        -moz-background-size: cover;
        -o-background-size: cover;
        background-size: cover;
        position: relative;
        margin-bottom: -65px;
    }
    .bgcover {
        margin-bottom: 0 !important;
    }

    .bgcover .bgtrans {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        display: block;
        overflow: hidden;
        height: inherit;
        background: rgba(0,0,0,.8);
        background: -webkit-gradient(linear,0% 0%,0% 100%,from(rgba(0,0,0,.8)),to (rgba(0,0,0,.6)),to(rgba(255,255,255,0)));
        background: -webkit-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
        background: -moz-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
        background: -ms-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
        background: -o-linear-gradient(top,rgba(255,255,255,0),rgba(0,0,0,.6),rgba(0,0,0,.8));
    }

    .bgcover .bgtrans h1 {
        display: block;
        overflow: hidden;
        font-size: 45px;
        line-height: 55px;
        color: #fff;
        width: 800px;
        margin: auto;
        position: absolute;
        left: 0;
        right: 0;
        bottom: 50px;
        font-family: 'Roboto Condensed',sans-serif;
        font-weight: 600;
    }
</style></head>
  <body><script>const items=["mode","palette"];items.forEach(function(e){const t=localStorage.getItem("hbs-"+e);t&&document.body.parentElement.setAttribute("data-"+e,t)})</script><header><nav class="navbar top-app-bar top-app-bar-expand-lg fixed-top">
  <div class="container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button><a class="navbar-brand flex-grow-1 flex-lg-grow-0 text-center text-lg-start mx-auto me-lg-3" href="/"><img class="logo" alt="Logo" src="/images/logo.webp" loading="lazy"  title="Logo"
   width="32" height="32"
   />
HOME
    </a>
    <div class="offcanvas offcanvas-bottom surface" tabindex="-1" id="offcanvasSocialShare" aria-labelledby="offcanvasSocialShare">
  <div class="offcanvas-header">
    <h3 class="offcanvas-title">Share</h3>
    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="offcanvas-body">
    <a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Twitter Share Button"
      target="_blank" href="https://twitter.com/intent/tweet?title=Marketing%20th%e1%bb%b1c%20chi%e1%ba%bfn%20-%20Ph%c3%a2n%20lo%e1%ba%a1i%20kh%c3%a1ch%20h%c3%a0ng%20s%e1%bb%ad%20d%e1%bb%a5ng%20RFM%20Analysis&url=%2fblog%2f2022-12-03-marketing-with-python%2f">
      <i class="fab fa-fw fa-twitter"></i> Twitter
    </a>
    <a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Facebook Share Button"
      target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=%2fblog%2f2022-12-03-marketing-with-python%2f">
      <i class="fab fa-fw fa-facebook-f"></i> Facebook
    </a>
  </div>
</div>
    <button class="navbar-settings" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSettings"
  aria-controls="offcanvasSettings" aria-label="Toggle settings">
  <i class="fas fa-ellipsis-v"></i>
</button>

<div class="offcanvas offcanvas-end surface h-100" tabindex="-1" id="offcanvasSettings" aria-labelledby="offcanvasSettings">
  <div class="offcanvas-header">
    <h3 class="offcanvas-title">Settings</h3>
    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="offcanvas-body d-flex flex-column">



<section class="setting">
  <form class="font-size-switcher-form row">
    <div class="col-auto">
      <label for="fontSize" class="form-label"><i class="fas fa-fw fa-font"></i> Font Size</label>
    </div>
    <div class="col-auto ms-auto">
      <input type="range" class="form-range" min="-2" max="2" id="fontSize">
    </div>
  </form>
</section>


<section class="setting palettes">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-palette"></i> Palette</label>
    </div>
    <div class="col-auto ms-auto">
      <a id="btnPalette" class="btn btn-sm btn-outline-primary" role="button" aria-label="palettePicker">
        <i class="fas fa-eye-dropper"></i>
      </a>
    </div>
  </form>
  <div class="mt-2 d-flex justify-content-between visually-hidden" id="palettePicker"><button type="button" id="palette-blue" aria-label="Blue"
        class="btn btn-sm w-100 palette" data-palette="blue">
      </button><button type="button" id="palette-blue-gray" aria-label="Blue Gray"
        class="btn btn-sm w-100 palette" data-palette="blue-gray">
      </button><button type="button" id="palette-brown" aria-label="Brown"
        class="btn btn-sm w-100 palette" data-palette="brown">
      </button><button type="button" id="palette-cyan" aria-label="Cyan"
        class="btn btn-sm w-100 palette" data-palette="cyan">
      </button><button type="button" id="palette-green" aria-label="Green"
        class="btn btn-sm w-100 palette" data-palette="green">
      </button><button type="button" id="palette-indigo" aria-label="Indigo"
        class="btn btn-sm w-100 palette" data-palette="indigo">
      </button><button type="button" id="palette-orange" aria-label="Orange"
        class="btn btn-sm w-100 palette" data-palette="orange">
      </button><button type="button" id="palette-pink" aria-label="Pink"
        class="btn btn-sm w-100 palette" data-palette="pink">
      </button><button type="button" id="palette-purple" aria-label="Purple"
        class="btn btn-sm w-100 palette" data-palette="purple">
      </button><button type="button" id="palette-red" aria-label="Red"
        class="btn btn-sm w-100 palette" data-palette="red">
      </button><button type="button" id="palette-teal" aria-label="Teal"
        class="btn btn-sm w-100 palette" data-palette="teal">
      </button><button type="button" id="palette-yellow" aria-label="Yellow"
        class="btn btn-sm w-100 palette" data-palette="yellow">
      </button></div>
</section>
<section class="setting actions d-flex justify-content-around mt-auto overflow-auto">
  <a role="button" class="action action-go-back" href="javascript: window.history.back();">
    <span class="action-icon"><i class="fas fa-2x fa-arrow-left"></i></span> Go back
  </a>
  <a role="button" class="action action-reload-page">
    <span class="action-icon"><i class="fas fa-2x fa-redo-alt"></i></span> Reload
  </a>
  <a role="button" class="action action-copy-url">
    <span class="action-icon"><i class="fas fa-2x fa-link"></i></span> Copy URL
  </a><a class="action action-social-share" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSocialShare"
    aria-controls="offcanvasSocialShare" aria-label="Toggle social share">
    <span class="action-icon"><i class="fas fa-2x fa-share-alt"></i></span> Share
  </a></section>

</div>
</div>

    <div class="collapse navbar-collapse" tabindex="-1" id="navbarSupportedContent" aria-labelledby="navbarSupportedContent">
      <form class="search-bar my-1" action="/search">
  <div class="input-group input-group-sm">
    <span class="btn btn-search disabled position-absolute left-0"><i class="fas fa-fw fa-search"></i></span>
    <input class="form-control rounded-pill" name="q" type="search" aria-label="Search">
  </div>
</form>
      <ul class="navbar-nav ms-auto"><li class="nav-item">
          <a class="nav-link" href="/series/">
            <i class="fas fa-fw fa-columns"></i>Courses
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/tools/">
            <i class="fas fa-fw fa-folder"></i>Tools
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/categories/">
            <i class="fas fa-fw fa-folder"></i>Categories
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/archives/">
            <i class="fas fa-fw fa-file-archive"></i>Archives
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/tags/">
            <i class="fas fa-fw fa-tags"></i>Tags
          </a>
        </li><li class="nav-item dropdown">
          <a class="nav-link" id="navbarDropdownSupport" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-fw fa-chevron-circle-down"></i>Support
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdownSupport"><li>
              <a class="dropdown-item"
                href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">
                Repository
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">
                Discussions
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">
                Features Request
              </a>
            </li><li><hr class="dropdown-divider"></li><li>
              <a class="dropdown-item"
                href="/faq/">
                FAQs
              </a>
            </li></ul>
        </li></ul>
    </div>
  </div>
</nav>
</header>
<main role="main" class="container" style="line-height:1.7em">
      <div class="row content">
<div class="col-lg-9 col-md-8">
  <div class="container"><nav class="row card component" aria-label="breadcrumb">
  <div class="card-body">
    <ol class="breadcrumb "><li class="breadcrumb-item"><a href="/">Home</a></li><li class="breadcrumb-item"><a href="/blog/">Blogs</a></li><li class="breadcrumb-item active">Marketing Thực Chiến - Phân Loại Khách Hàng Sử Dụng RFM Analysis</li></ol>
  </div>
</nav>
<div class="post-panel-wrapper">
  <div class="d-flex flex-column component rounded post-panel">
    
    <a class="action action-panel-toggler" role="button" title="Panel toggler">
      <i class="fas fa-fw fa-chevron-circle-down"></i>
    </a>
    <a id="sidebarToggler" class="action d-none d-lg-block" role="button" title="Sidebar toggler">
  <i class="fas fa-fw fa-expand-alt" data-fa-transform="rotate-45"></i>
</a>

    

    
    
    <a class="action" href="#post-comments" role="button" aria-label="Comments" title="Comments">
  <i class="fas fa-fw fa-comments"></i>
</a>
    <a class="action" href="#postTOC" aria-controls="Table of contents" role="button" title="Table of contents">
  <i class="fas fa-fw fa-list-alt"></i>
</a>
    
  </div>
</div>
<article class="row card component mb-4 post">
  <div class="card-header ">
    <div class="bgcover" style="background-image:url(https://unsplash.it/1920/1080)" alt="Marketing thực chiến - Phân loại khách hàng sử dụng RFM Analysis">
      <div class="bgtrans">
          <h1>Marketing Thực Chiến - Phân Loại Khách Hàng Sử Dụng RFM Analysis
</h1>
      </div>
  </div>
</div>
  <div class="card-body"><div class="post-meta">
  <span class="post-date" title="created on 2022-12-04 04:19:00 &#43;0700 &#43;07.">
    Dec 4, 2022
  </span><span class="post-reading-time">
    17 min read
  </span><span class="post-taxonomies"><a href="/tags/rfm/" class="badge post-taxonomy">RFM</a><a href="/tags/recommendation/" class="badge post-taxonomy">Recommendation</a><a href="/tags/marketing/" class="badge post-taxonomy">Marketing</a></span>
</div>
<div class="post-content mb-3"><div class="toc">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#1-giới-thiệu-rfm">1. Giới thiệu RFM</a></li>
    <li><a href="#2-giới-thiệu-data-và-tìm-hiểu-data">2. Giới thiệu data và tìm hiểu data</a>
      <ul>
        <li><a href="#21-giới-thiệu-data">2.1 Giới thiệu data</a></li>
        <li><a href="#22-thực-hiện-một-số-phép-thống-kê-trên-dữ-liệu">2.2 Thực hiện một số phép thống kê trên dữ liệu</a></li>
        <li><a href="#23-phân-tích-dữ-liệu">2.3 Phân tích dữ liệu</a>
          <ul>
            <li><a href="#231-tính-doanh-thu-theo-tháng">2.3.1 Tính doanh thu theo tháng</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#232-thống-kê-tăng-trưởng-của-doanh-thu">2.3.2 Thống kê tăng trưởng của doanh thu</a>
      <ul>
        <li>
          <ul>
            <li><a href="#233-phân-tích-số-lượng-khách-hàng-tháng">2.3.3 Phân tích số lượng khách hàng tháng</a></li>
            <li><a href="#234-số-đơn-đặt-hàng-trong-tháng">2.3.4 Số đơn đặt hàng trong tháng</a></li>
            <li><a href="#235-doanh-thu-trung-bình-mỗi-đơn-hàng">2.3.5 Doanh thu trung bình mỗi đơn hàng</a></li>
            <li><a href="#236-số-lượng-khách-hàng-mới-cũ-theo-từng-tháng">2.3.6 Số lượng khách hàng mới/ cũ theo từng tháng</a></li>
            <li><a href="#237-tỷ-lệ-tăng-trưởng-khách-hàng-mới">2.3.7 Tỷ lệ tăng trưởng khách hàng mới</a></li>
            <li><a href="#238-tỷ-lệ-giữ-chân-khách-hàng-cũ-hàng-tháng">2.3.8 Tỷ lệ giữ chân khách hàng cũ hàng tháng</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#3-phân-khúc-khách-hàng">3. Phân Khúc Khách Hàng</a>
      <ul>
        <li><a href="#31-clean-data">3.1 Clean data</a></li>
        <li><a href="#31-tính-recency">3.1 Tính Recency</a></li>
        <li><a href="#32-tính-frequency">3.2 Tính Frequency</a></li>
        <li><a href="#33-tính-monetary">3.3 Tính Monetary</a></li>
        <li><a href="#34-tạo-bảng-rfm">3.4 Tạo bảng RFM</a></li>
        <li><a href="#35-phân-nhóm-khách-hàng-sử-dụng-rfm">3.5 Phân nhóm khách hàng sử dụng RFM</a></li>
      </ul>
    </li>
    <li><a href="#tham-khảo">Tham khảo</a></li>
  </ul>
</nav>
  </div>
<h1 id="1-giới-thiệu-rfm">1. Giới thiệu RFM<a class="anchor ms-1" href="#1-giới-thiệu-rfm"><i class="fas fa-link"></i></a></h1>
<ul>
<li>
<p>RFM là 3 ký tự đầu tiên của Recency, frequency, monetary. Nó là công cụ phân tích được marketing sử dụng để định danh khách hàng của công ty dựa trên thói quen mua sắm tự nhiên của họ.</p>
</li>
<li>
<p>RFM phân tích và đánh giá khách hàng bằng cách tính điểm hành vi mua sắm của họ dựa trên ba tiêu chí:</p>
<ul>
<li>
<p>Recency: Khoảng thời gian mua hàng gần nhất là bao lâu. Nếu họ đã mua hàng gần đây, xác suất họ sẽ mua thêm một lần nữa rất cao. Tuy nhiên, nếu khách hàng không thực hiện bất kỳ một giao dịch nào trong một khoảng thời gian dài, chúng ta có thể lôi kéo họ bằng một offer đặc biệt, hoặc giới thiệu lại thương hiệu của mình cho họ.</p>
</li>
<li>
<p>Frequency: Tần suất mua hàng của khách hàng. Nếu khách hàng có tầng suất mua dày đặc, chúng ta sẽ biết thói quen và sở thích của họ. Nếu họ chỉ mua một lần và chưa bao giờ trở lại, họ có thể là một ứng viên tốt để thực hiện bài khảo sát sự hài lòng của khách hàng.</p>
</li>
<li>
<p>Monetary: Số tiền trung bình khách hàng sử dụng trên mỗi giao dịch. Tuy nhiên, đừng quá chú trọng vào con số này. Tất cả các giao dịch mua hàng đều có giá trị. Monetary tác động trực tiếp đến doanh thu của công ty, tác động gián tiếp với 2 chỉ số ở trên kia. Nếu chúng ta gặp một khách hàng thực hiện nhiều lần mua hàng gần đây với mức giá cao, những người đó có thể là khách hàng trung thành của chúng ta.</p>
</li>
</ul>
</li>
<li>
<p>RMF có thang điểm từ 1-5 ( 1 là tệ, 5 là tốt) của mỗi khách hàng cho mỗi tiêu chí.</p>
</li>
<li>
<p>RFM giúp công ty có khả năng dự đoán những khách hàng nào có khả năng cao sẽ mua lại sản phẩm của họ, doanh thu đến từ khách hàng mới là bao nhiêu, cách biến cơ hội mua hàng thành thói quen.</p>
</li>
</ul>
<h1 id="2-giới-thiệu-data-và-tìm-hiểu-data">2. Giới thiệu data và tìm hiểu data<a class="anchor ms-1" href="#2-giới-thiệu-data-và-tìm-hiểu-data"><i class="fas fa-link"></i></a></h1>
<h2 id="21-giới-thiệu-data">2.1 Giới thiệu data<a class="anchor ms-1" href="#21-giới-thiệu-data"><i class="fas fa-link"></i></a></h2>
<p>Dữ liệu ở bài viết này, chúng ta sẽ sử dụng từ nguồn <a href="https://www.kaggle.com/datasets/lissetteg/ecommerce-dataset" target="_blank" rel="noopener noreferrer">https://www.kaggle.com/datasets/lissetteg/ecommerce-dataset</a>.</p>
<p>Code load các thư viện cần thiết</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"># This Python 3 environment comes with many helpful analytics libraries installed</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"># It is defined by the kaggle/python docker image: https://github.com/kaggle/docker-python</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"># For example, here&#39;s several helpful packages to load in</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> <span class="c1"># linear algebra</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> <span class="c1"># data processing, CSV file I/O (e.g. pd.read_csv)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"># Input data files are available in the &#34;../input/&#34; directory.</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">#visualizations</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="kn">import</span> <span class="n">scatter_matrix</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>Code load data và in ra 20 dòng đầu tiên</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl">
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1">#load the dataset</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">retail_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../input/data.csv&#39;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&#34;ISO-8859-1&#34;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span><span class="s1">&#39;InvoiceID&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">})</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="n">retail_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</span></span></code></pre></div><p><img class="img-fluid" alt="Hình 1: Tổng quan về dữ liệu" src="/blog/2022-12-03-marketing-with-python/images/figure1.png" loading="lazy"  title="Hình 1: Tổng quan về dữ liệu"
  
   />


<strong>Hình 1: Tổng quan về dữ liệu</strong></p>
<h2 id="22-thực-hiện-một-số-phép-thống-kê-trên-dữ-liệu">2.2 Thực hiện một số phép thống kê trên dữ liệu<a class="anchor ms-1" href="#22-thực-hiện-một-số-phép-thống-kê-trên-dữ-liệu"><i class="fas fa-link"></i></a></h2>
<p>Sau khi nhận dữ liệu, chúng ta cần xem xét sơ lược tổng quan về dữ liệu bằng một số hàm thống kê cơ bản</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl">
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">retail_df</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">retail_df</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</span></span></code></pre></div><p><img class="img-fluid" alt="Hình 2" src="/blog/2022-12-03-marketing-with-python/images/figure2.png" loading="lazy"  title="Hình 2"
  
   />


<strong>Hình 2: Phân tích xác suất về dữ liệu</strong></p>
<p>Dựa vào kết quả hình 2, chúng ta thấy rằng data có tổng cộng 541909 dòng, 8 cột, trong đó có một số chỗ có giá trị null. Cột CustomerID có giá trị null nhiều nhất.</p>
<h2 id="23-phân-tích-dữ-liệu">2.3 Phân tích dữ liệu<a class="anchor ms-1" href="#23-phân-tích-dữ-liệu"><i class="fas fa-link"></i></a></h2>
<h3 id="231-tính-doanh-thu-theo-tháng">2.3.1 Tính doanh thu theo tháng<a class="anchor ms-1" href="#231-tính-doanh-thu-theo-tháng"><i class="fas fa-link"></i></a></h3>
<p>Doanh thu của một đơn hàng bằng số lượng nhân đơn giá.</p>
<p>Công việc cần làm:</p>
<ul>
<li>Tạo một key chung đại diện cho biến tháng trong năm ( ở đây mình đặt tên là MonthKey)</li>
<li>Tính doanh thu</li>
<li>Group doanh thu theo tháng</li>
<li>In ra màn hình doanh thu theo tháng</li>
<li>Vẽ chart doanh thu theo tháng</li>
</ul>
<p>Đoạn code mẫu mô tả các bước cần làm ở trên</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1">#converting the type of Invoice Date Field from string to datetime.</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">retail_df</span><span class="p">[</span><span class="s1">&#39;InvoiceDate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">retail_df</span><span class="p">[</span><span class="s1">&#39;InvoiceDate&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1">#creating MonthKey field for reporting and visualization</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">retail_df</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">retail_df</span><span class="p">[</span><span class="s1">&#39;InvoiceDate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">date</span><span class="p">:</span> <span class="mi">100</span><span class="o">*</span><span class="n">date</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1">#calculate Revenue for each row and create a new dataframe with MonthKey - Revenue columns</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">retail_df</span><span class="p">[</span><span class="s1">&#39;Revenue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">retail_df</span><span class="p">[</span><span class="s1">&#39;UnitPrice&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">retail_df</span><span class="p">[</span><span class="s1">&#39;Quantity&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">revenue_by_month</span> <span class="o">=</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">])[</span><span class="s1">&#39;Revenue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">revenue_by_month</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"># plot data</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="n">revenue_by_month</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">revenue_by_month</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&#34;figure.figsize&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">,</span> <span class="s1">&#39;Revenue&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">revenue_by_month</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Revenue by Month&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><p>Kết quả chúng mình nhận được</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">	<span class="n">MonthKey</span>	<span class="n">Revenue</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="mi">0</span>	<span class="mi">201012</span>	<span class="mf">748957.020</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="mi">1</span>	<span class="mi">201101</span>	<span class="mf">560000.260</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="mi">2</span>	<span class="mi">201102</span>	<span class="mf">498062.650</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="mi">3</span>	<span class="mi">201103</span>	<span class="mf">683267.080</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="mi">4</span>	<span class="mi">201104</span>	<span class="mf">493207.121</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="mi">5</span>	<span class="mi">201105</span>	<span class="mf">723333.510</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="mi">6</span>	<span class="mi">201106</span>	<span class="mf">691123.120</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="mi">7</span>	<span class="mi">201107</span>	<span class="mf">681300.111</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="mi">8</span>	<span class="mi">201108</span>	<span class="mf">682680.510</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="mi">9</span>	<span class="mi">201109</span>	<span class="mf">1019687.622</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="mi">10</span>	<span class="mi">201110</span>	<span class="mf">1070704.670</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="mi">11</span>	<span class="mi">201111</span>	<span class="mf">1461756.250</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="mi">12</span>	<span class="mi">201112</span>	<span class="mf">433668.010</span>
</span></span></code></pre></div><p><img class="img-fluid" alt="Hình 3" src="/blog/2022-12-03-marketing-with-python/images/figure3.png" loading="lazy"  title="Hình 3"
  
   />


<strong>Hình 3: Doanh thu theo tháng</strong></p>
<p>Nhìn vào hình 3 ở trên, chúng ta thấy rằng, doanh thu bắt đầu tăng từ tháng 8, đạt đỉnh điểm ở tháng 11, tháng 12 doanh thu siêu thấp, ngó qua tháng 12 năm ngoái thì doanh thu khá ổn, nên có thể tạm kết luận là data tháng 12 năm hiện tại có thể chưa đủ tháng. Chúng ta có thể bỏ data tháng 12 ra khỏi dataset để tránh bị nhiễu.</p>
<h1 id="232-thống-kê-tăng-trưởng-của-doanh-thu">2.3.2 Thống kê tăng trưởng của doanh thu<a class="anchor ms-1" href="#232-thống-kê-tăng-trưởng-của-doanh-thu"><i class="fas fa-link"></i></a></h1>
<p>Để tính tăng trưởng doanh thu, ta lấy doanh thu tháng hiện tại chia cho doanh thu tháng trước -1</p>
<p>Trong pandas, chúng ta sử dụng hàm pct_change</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">revenue_by_month</span><span class="p">[</span><span class="s1">&#39;MonthlyGrowth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">revenue_by_month</span><span class="p">[</span><span class="s1">&#39;Revenue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"># Plot data</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&#34;figure.figsize&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">,</span> <span class="s1">&#39;MonthlyGrowth&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">revenue_by_month</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">revenue_by_month</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">revenue_by_month</span><span class="o">.</span><span class="n">index</span><span class="p">))],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&#34;k&#34;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Monthly Revenue Growth Rate&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><p><img class="img-fluid" alt="Hình 4" src="/blog/2022-12-03-marketing-with-python/images/figure4.png" loading="lazy"  title="Hình 4"
  
   />


<strong>Hình 4: Biến động doanh thu theo tháng</strong></p>
<p>Qua  sơ đồ hình 4, chúng ta thấy rằng ở tháng 4 có sự sụt giảm mạnh về doanh thu, nhóm kinh doanh cần phải phân tích kỹ hơn các yếu tố ảnh hưởng đến sự sụt giảm nghiêm trọng về mặt doanh thu trong tháng này.</p>
<h3 id="233-phân-tích-số-lượng-khách-hàng-tháng">2.3.3 Phân tích số lượng khách hàng tháng<a class="anchor ms-1" href="#233-phân-tích-số-lượng-khách-hàng-tháng"><i class="fas fa-link"></i></a></h3>
<p>Để tính lượt khách mua hàng hằng tháng, chúng ta đếm không trùng mã khách hàng trong tháng</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">customer_by_month</span> <span class="o">=</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">])[</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">customer_by_month</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">customer_by_month</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">customer_by_month</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&#34;figure.figsize&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">,</span> <span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">customer_by_month</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Customer by Month&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">	<span class="n">MonthKey</span>	<span class="n">CustomerID</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="mi">0</span>	<span class="mi">201012</span>	<span class="mi">948</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="mi">1</span>	<span class="mi">201101</span>	<span class="mi">783</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="mi">2</span>	<span class="mi">201102</span>	<span class="mi">798</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="mi">3</span>	<span class="mi">201103</span>	<span class="mi">1020</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="mi">4</span>	<span class="mi">201104</span>	<span class="mi">899</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="mi">5</span>	<span class="mi">201105</span>	<span class="mi">1079</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="mi">6</span>	<span class="mi">201106</span>	<span class="mi">1051</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="mi">7</span>	<span class="mi">201107</span>	<span class="mi">993</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="mi">8</span>	<span class="mi">201108</span>	<span class="mi">980</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="mi">9</span>	<span class="mi">201109</span>	<span class="mi">1302</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="mi">10</span>	<span class="mi">201110</span>	<span class="mi">1425</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="mi">11</span>	<span class="mi">201111</span>	<span class="mi">1711</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="mi">12</span>	<span class="mi">201112</span>	<span class="mi">686</span>
</span></span></code></pre></div><p><img class="img-fluid" alt="Hình 5" src="/blog/2022-12-03-marketing-with-python/images/figure5.png" loading="lazy"  title="Hình 5"
  
   />


<strong>Hình 5: Lượt khách theo tháng</strong></p>
<p>Nhận xét rằng, lượt khách tăng từ tháng 8 trở về sau, từ tháng 5 đến tháng 8 thì lượt khách giảm nhẹ, đều. Tháng 1 và 2 lượt khách rất thấp.</p>
<h3 id="234-số-đơn-đặt-hàng-trong-tháng">2.3.4 Số đơn đặt hàng trong tháng<a class="anchor ms-1" href="#234-số-đơn-đặt-hàng-trong-tháng"><i class="fas fa-link"></i></a></h3>
<p>Cũng giống như lượt khách, chúng ta sẽ đếm số lượng InvoiceNo trong từng tháng</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl">
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">order_by_month</span> <span class="o">=</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">])[</span><span class="s1">&#39;InvoiceNo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">order_by_month</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="n">order_by_month</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">order_by_month</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&#34;figure.figsize&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">,</span> <span class="s1">&#39;InvoiceNo&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">order_by_month</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Count total order in Month&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><p><img class="img-fluid" alt="Hình 6" src="/blog/2022-12-03-marketing-with-python/images/figure6.png" loading="lazy"  title="Hình 6"
  
   />


<strong>Hình 6: Số lượng đơn đặt hàng trong tháng</strong></p>
<p>Từ tháng 5 đến tháng 7, số lượng đơn đặt hàng tăng nhẹ, tỷ lệ nghịch với lượt khách</p>
<p>Từ tháng 8 trở đi, số đơn đặt hàng tăng cao, tỷ lệ thuận với lượt khách</p>
<h3 id="235-doanh-thu-trung-bình-mỗi-đơn-hàng">2.3.5 Doanh thu trung bình mỗi đơn hàng<a class="anchor ms-1" href="#235-doanh-thu-trung-bình-mỗi-đơn-hàng"><i class="fas fa-link"></i></a></h3>
<p>Trong pandas, chúng ta chỉ cần gọi hàm mean để tính trung bình</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">avg_order_revenue</span> <span class="o">=</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">])[</span><span class="s1">&#39;Revenue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">avg_order_revenue</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_order_revenue</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"># Plot regression line</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&#34;figure.figsize&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">,</span> <span class="s1">&#39;Revenue&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">avg_order_revenue</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Average Revenue per Order&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><p><img class="img-fluid" alt="Hình 7" src="/blog/2022-12-03-marketing-with-python/images/figure7.png" loading="lazy"  title="Hình 7"
  
   />


<strong>Hình 7: Doanh thu trung bình mỗi đơn hàng</strong></p>
<p>Nhận xét rằng, tháng 10, 11, lượt khách tăng, số lượng đơn hàng tăng, nhưng trung bình mỗi đơn hàng lại thấp.</p>
<h3 id="236-số-lượng-khách-hàng-mới-cũ-theo-từng-tháng">2.3.6 Số lượng khách hàng mới/ cũ theo từng tháng<a class="anchor ms-1" href="#236-số-lượng-khách-hàng-mới-cũ-theo-từng-tháng"><i class="fas fa-link"></i></a></h3>
<p>Khách hàng mới và khách hàng cũ đều đóng vai trò rất quan trọng trong chiến lược marketing. Việc giữ chân khách hàng cũ giúp chúng ta hiểu hơn về họ và phục vụ họ tốt hơn. Việc phát triển khách hàng mới giúp chúng ta phát triển lớn lên.</p>
<p>Trong ngữ cảnh bài này, chúng ta sẽ xét yếu tốt khách hàng mới/cũ như sau</p>
<ul>
<li>
<p>Khách hàng mới là khách hàng trước đó chưa từng mua hàng. Không quan tâm tháng hiện tại khách đã mua bao nhiêu đơn.</p>
</li>
<li>
<p>Khách hàng cũ là khách hàng đã mua ít nhất 1 đơn hàng ở tháng trước đó.</p>
</li>
<li>
<p>Do đơn vị chúng ta thống kê tính bằng tháng, cho nên nếu 1 khách hàng có mua 2 hoặc nhiều hơn đơn hàng ở tháng hiện tại, chưa từng mua đơn hàng nào ở các tháng trước đó, khách hàng đó được coi là khách hàng mới.</p>
</li>
</ul>
<p>Kỹ thuật lập trình ở đây như sau:</p>
<ul>
<li>
<p>Lấy ra danh sách khách hàng  và ngày mua hàng đầu tiên của họ</p>
</li>
<li>
<p>Quy đổi ngày mua hàng đầu tiên thành tháng mua hàng đầu tiên</p>
</li>
<li>
<p>Tạo thêm cột loại khách hàng cho từng đơn hàng (UserType). Gán mặc định UserType = New. Nếu tháng lên đơn lớn hơn tháng mua đầu tiên -&gt; đơn hàng của khách cũ (UserType=Existing).</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">create</span> <span class="n">a</span> <span class="n">dataframe</span> <span class="n">contaning</span> <span class="n">CustomerID</span> <span class="ow">and</span> <span class="n">first</span> <span class="n">purchase</span> <span class="n">date</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">df_min_date_purchase</span> <span class="o">=</span><span class="n">retail_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">InvoiceDate</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">df_min_date_purchase</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span><span class="s1">&#39;MinPurchaseDate&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">df_min_date_purchase</span><span class="p">[</span><span class="s1">&#39;MinMonthKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_min_date_purchase</span><span class="p">[</span><span class="s1">&#39;MinPurchaseDate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">date</span><span class="p">:</span> <span class="mi">100</span><span class="o">*</span><span class="n">date</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1">#merge first purchase date column to our main dataframe (tx_uk)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">retail_new_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">retail_df</span><span class="p">,</span> <span class="n">df_min_date_purchase</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">retail_new_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1">#create a column called User Type and assign Existing</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">#if User&#39;s First Purchase Year Month before the selected Invoice Year Month</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="n">retail_new_df</span><span class="p">[</span><span class="s1">&#39;UserType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;New&#39;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="n">retail_new_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">retail_new_df</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">retail_new_df</span><span class="p">[</span><span class="s1">&#39;MinMonthKey&#39;</span><span class="p">],</span><span class="s1">&#39;UserType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Existing&#39;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1">#calculate the Revenue per month for each user type</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="n">revenue_per_month</span> <span class="o">=</span> <span class="n">retail_new_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">,</span><span class="s1">&#39;UserType&#39;</span><span class="p">])[</span><span class="s1">&#39;Revenue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1">#filtering the dates and plot the result</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="n">revenue_per_month</span> <span class="o">=</span> <span class="n">revenue_per_month</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;MonthKey != 201012 and MonthKey != 201112&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="n">revenue_per_month</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">revenue_per_month</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="n">revenue_per_month</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="c1"># Plot regression line</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&#34;figure.figsize&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">grp</span> <span class="ow">in</span> <span class="n">revenue_per_month</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;UserType&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="n">grp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">grp</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;Revenue&#39;</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;.-&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Old and New user&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><p><img class="img-fluid" alt="Hình 8" src="/blog/2022-12-03-marketing-with-python/images/figure8.png" loading="lazy"  title="Hình 8"
  
   />


<strong>Hình 8: Số lượng khách hàng mới/ cũ theo từng tháng</strong></p>
<p>Nhận xét rằng, doanh thu cho khách cũ tăng dần theo thời gian, còn doanh thu cho khách mới có vẻ giảm. Để chắc chắn, chúng ta thử vẽ ra tỷ lệ tăng trưởng khách hàng mới xem sao</p>
<h3 id="237-tỷ-lệ-tăng-trưởng-khách-hàng-mới">2.3.7 Tỷ lệ tăng trưởng khách hàng mới<a class="anchor ms-1" href="#237-tỷ-lệ-tăng-trưởng-khách-hàng-mới"><i class="fas fa-link"></i></a></h3>
<p>Ta tính tỷ lệ khách hàng mới / khách hàng cũ theo từng tháng</p>
<p>Trong pandas, chúng ta sẽ sử dụng hàm crosstab</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">new_user_ratio</span> <span class="o">=</span> <span class="n">retail_new_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;UserType == &#39;New&#39;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">])[</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="o">/</span><span class="n">retail_new_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;UserType == &#39;Existing&#39;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">])[</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">new_user_ratio</span> <span class="o">=</span> <span class="n">new_user_ratio</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">new_user_ratio</span> <span class="o">=</span> <span class="n">new_user_ratio</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">new_user_ratio</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;MonthKey&#34;</span><span class="p">,</span><span class="s2">&#34;NewCustomerRatio&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">new_user_ratio</span> <span class="o">=</span> <span class="n">new_user_ratio</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;MonthKey != 201012 and MonthKey != 201112&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">new_user_ratio</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_user_ratio</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"># Plot regression line</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&#34;figure.figsize&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">,</span> <span class="s1">&#39;NewCustomerRatio&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">new_user_ratio</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;New Customer Ratio&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><p><img class="img-fluid" alt="Hình 9" src="/blog/2022-12-03-marketing-with-python/images/figure9.png" loading="lazy"  title="Hình 9"
  
   />


<strong>Hình 9: Tỷ lệ tăng trưởng khách hàng mới</strong></p>
<p>Như hình trên, chúng ta thấy rằng tỷ lệ khách hàng mới / khách hàng cũ giảm dần theo thời gian</p>
<h3 id="238-tỷ-lệ-giữ-chân-khách-hàng-cũ-hàng-tháng">2.3.8 Tỷ lệ giữ chân khách hàng cũ hàng tháng<a class="anchor ms-1" href="#238-tỷ-lệ-giữ-chân-khách-hàng-cũ-hàng-tháng"><i class="fas fa-link"></i></a></h3>
<p>Khách hàng cũ được hiểu theo nghĩa là khách hàng tháng trước có mua, tháng này có mua</p>
<p>Tỷ lệ giữ chân khách hàng là tỷ lệ khách hàng cũ mua hàng / tổng khách hàng trong tháng</p>
<p>Chúng ta sử dụng hàm crosstab trên khách hàng và tháng, để xem thử tháng đó khách có mua hàng hay không.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">#identify which users are active by looking at their revenue per month</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">df_user_purchase</span> <span class="o">=</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">])[</span><span class="s1">&#39;Revenue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1">#create retention matrix with crosstab</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">df_retention</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">df_user_purchase</span><span class="p">[</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">],</span> <span class="n">df_user_purchase</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">df_retention</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1">#create an array of dictionary which keeps Retained &amp; Total User count for each month</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">months</span> <span class="o">=</span> <span class="n">df_retention</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">retention_array</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">months</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">retention_data</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">selected_month</span> <span class="o">=</span> <span class="n">months</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="n">prev_month</span> <span class="o">=</span> <span class="n">months</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">retention_data</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">selected_month</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">retention_data</span><span class="p">[</span><span class="s1">&#39;TotalUserCount&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_retention</span><span class="p">[</span><span class="n">selected_month</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="n">retention_data</span><span class="p">[</span><span class="s1">&#39;RetainedUserCount&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_retention</span><span class="p">[(</span><span class="n">df_retention</span><span class="p">[</span><span class="n">selected_month</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_retention</span><span class="p">[</span><span class="n">prev_month</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)][</span><span class="n">selected_month</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="n">retention_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">retention_data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="c1">#convert the array to dataframe and calculate Retention Rate</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="n">df_retention</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">retention_array</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="n">df_retention</span><span class="p">[</span><span class="s1">&#39;RetentionRate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_retention</span><span class="p">[</span><span class="s1">&#39;RetainedUserCount&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df_retention</span><span class="p">[</span><span class="s1">&#39;TotalUserCount&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="n">df_retention</span> <span class="o">=</span> <span class="n">df_retention</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;MonthKey != 201012 and MonthKey != 201112&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="n">df_retention</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_retention</span><span class="p">[</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="c1"># Plot regression line</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&#34;figure.figsize&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;MonthKey&#39;</span><span class="p">,</span> <span class="s1">&#39;RetentionRate&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_retention</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Monthly Retention Rate&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><p>Kết quả</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># hàm crosstab trả ra ma trận tương quan giữa khách hàng và tháng, ví dụ như khách hàng 12346 tháng 201012 không có mua hàng, nhưng 201101 lại có</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="o">&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">df_retention</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">MonthKey</span> <span class="n">CustomerID</span>  <span class="mi">201012</span>  <span class="mi">201101</span>  <span class="mi">201102</span>  <span class="mi">201103</span>  <span class="mi">201104</span>  <span class="mi">201105</span>  <span class="mi">201106</span>  \
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="mi">0</span>             <span class="mi">12346</span>       <span class="mi">0</span>       <span class="mi">1</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="mi">1</span>             <span class="mi">12347</span>       <span class="mi">1</span>       <span class="mi">1</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">1</span>       <span class="mi">0</span>       <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="mi">2</span>             <span class="mi">12348</span>       <span class="mi">1</span>       <span class="mi">1</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">1</span>       <span class="mi">0</span>       <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="mi">3</span>             <span class="mi">12349</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="mi">4</span>             <span class="mi">12350</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">1</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">MonthKey</span>  <span class="mi">201107</span>  <span class="mi">201108</span>  <span class="mi">201109</span>  <span class="mi">201110</span>  <span class="mi">201111</span>  <span class="mi">201112</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="mi">0</span>              <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="mi">1</span>              <span class="mi">0</span>       <span class="mi">1</span>       <span class="mi">0</span>       <span class="mi">1</span>       <span class="mi">0</span>       <span class="mi">1</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="mi">2</span>              <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">1</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="mi">3</span>              <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">1</span>       <span class="mi">0</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="mi">4</span>              <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">0</span>
</span></span></code></pre></div><p><img class="img-fluid" alt="Hình 10" src="/blog/2022-12-03-marketing-with-python/images/figure10.png" loading="lazy"  title="Hình 10"
  
   />


<strong>Hình 10: Tỷ lệ giữ chân khách hàng cũ</strong></p>
<p>Nhìn hình, ta thấy rằng khách hàng cũ mua lại khá nhiều ở giai đoạn tháng 6 đến tháng 8, sau đó tỷ lệ lại trở lại bình thường.</p>
<h1 id="3-phân-khúc-khách-hàng">3. Phân Khúc Khách Hàng<a class="anchor ms-1" href="#3-phân-khúc-khách-hàng"><i class="fas fa-link"></i></a></h1>
<p>Ở mục trên, chúng ta đã phân tích dữ liệu của công ty bán lẻ trực tuyến và tìm ra yếu tố ảnh hưởng đến doanh thu của công ty. Ở mục này, chúng ta sẽ tiến hành phân loại khách hàng  theo nhóm, để phục vụ cho nhu cầu marketing sau này.</p>
<p>Chúng ta phải tiến hành phân loại khách hàng, bởi vì chúng ta không thể đối xử với tất cả khách hàng giống nhau được. Ví dụ là không thể gửi chiến dịch marketing về thịt cho người ăn chay. Hoặc bán lược cho nhà sư (đây là ví dụ minh hoạ của mình nha, còn trên có vài case-study về bán các sản phẩm đó cho đối tượng đó, mình không nói về những trường hợp đó nha).</p>
<p>Ở phần này, chúng ta sẽ tìm hiểu nhu cầu khách hàng sử dụng mô hình RFB.</p>
<p>Như đã đề cập ở mục 1, mô hình RFB bao gồm Recency, Frequency and Monetary</p>
<h2 id="31-clean-data">3.1 Clean data<a class="anchor ms-1" href="#31-clean-data"><i class="fas fa-link"></i></a></h2>
<p>Để mô hình chính xác hơn, chúng ta sẽ clean data, trải qua các bước sau:</p>
<ul>
<li>
<p>Loại ra các đơn hàng có Quantity &lt;=0</p>
</li>
<li>
<p>Loại bỏ những đơn hàng CustomerID NA</p>
</li>
<li>
<p>Loại bỏ những đơn hàng bán tháng 12 năm 2010</p>
</li>
<li>
<p>Loại bỏ những đơn hàng bán tháng 12 năm 2011, do phân tích ở trên là data tháng 12 không đủ.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">retail_rfm_df</span> <span class="o">=</span> <span class="n">retail_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1">#remove canceled orders</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">retail_rfm_df</span> <span class="o">=</span> <span class="n">retail_rfm_df</span><span class="p">[</span><span class="n">retail_rfm_df</span><span class="p">[</span><span class="s1">&#39;Quantity&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1">#remove rows where customerID are NA</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">retail_rfm_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="n">retail_rfm_df</span> <span class="o">=</span> <span class="n">retail_rfm_df</span><span class="p">[</span><span class="n">retail_rfm_df</span><span class="p">[</span><span class="s1">&#39;InvoiceDate&#39;</span><span class="p">]</span><span class="o">&gt;</span> <span class="s2">&#34;2010-12-31&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="n">retail_rfm_df</span> <span class="o">=</span> <span class="n">retail_rfm_df</span><span class="p">[</span><span class="n">retail_rfm_df</span><span class="p">[</span><span class="s1">&#39;InvoiceDate&#39;</span><span class="p">]</span><span class="o">&lt;</span> <span class="s2">&#34;2011-12-01&#34;</span><span class="p">]</span>
</span></span></code></pre></div><h2 id="31-tính-recency">3.1 Tính Recency<a class="anchor ms-1" href="#31-tính-recency"><i class="fas fa-link"></i></a></h2>
<p>Để tính thông số này, chúng ta cần  tìm ra ngày mua gần nhất của khách hàng, và số ngày không mua hàng, kể từ ngày mua cuối đến hiện tại.</p>
<p>Kỹ thuật lập trình ở đây:</p>
<ul>
<li>
<p>Gán ngày hiện tại là ngày 30 tháng 11 năm 2011</p>
</li>
<li>
<p>Lấy ra ngày mua hàng cuối cùng của mỗi user</p>
</li>
<li>
<p>Tính ra khoảng thời gian kể từ lần mua hàng cuối cùng đến thời điểm hiện tại</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">now</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1">#create a new column called date which contains the date of invoice only</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">retail_rfm_df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">retail_rfm_df</span><span class="p">[</span><span class="s1">&#39;InvoiceDate&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">date</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1">#group by customers and check last date of purshace</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">recency_df</span> <span class="o">=</span> <span class="n">retail_rfm_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">recency_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span><span class="s1">&#39;LastPurshaceDate&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1">#calculate recency</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">recency_df</span><span class="p">[</span><span class="s1">&#39;Recency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recency_df</span><span class="p">[</span><span class="s1">&#39;LastPurshaceDate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">recency_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;LastPurshaceDate&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">recency_df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span></span></code></pre></div><p>Kết quả</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&gt;&gt;</span> <span class="n">recency_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="n">CustomerID</span>  <span class="n">Recency</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="mi">0</span>      <span class="mi">12346</span>      <span class="mi">316</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="mi">1</span>      <span class="mi">12347</span>       <span class="mi">30</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="mi">2</span>      <span class="mi">12348</span>       <span class="mi">66</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="mi">3</span>      <span class="mi">12349</span>        <span class="mi">9</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="mi">4</span>      <span class="mi">12350</span>      <span class="mi">301</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="o">&gt;&gt;</span> <span class="n">recency_df</span><span class="o">.</span><span class="n">Recency</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">count</span>    <span class="mf">4174.000000</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">mean</span>       <span class="mf">82.557499</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">std</span>        <span class="mf">88.535941</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nb">min</span>         <span class="mf">0.000000</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="mi">25</span><span class="o">%</span>        <span class="mf">15.000000</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="mi">50</span><span class="o">%</span>        <span class="mf">45.000000</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="mi">75</span><span class="o">%</span>       <span class="mf">128.000000</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nb">max</span>       <span class="mf">330.000000</span>
</span></span></code></pre></div><p>Chỉ số thống kê cho thấy, giá trị trung bình của Recency là 82, 50% người dùng lặp lại chu kỳ mua hàng trong vòng 45 ngày</p>
<h2 id="32-tính-frequency">3.2 Tính Frequency<a class="anchor ms-1" href="#32-tính-frequency"><i class="fas fa-link"></i></a></h2>
<p>Tần suất giúp chúng ta biết được khách hàng đã mua hàng bao nhiêu lần</p>
<p>Kỹ thuật lập trình ở đây khá đơn giản, gom nhóm đơn hàng theo user và đếm</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl">
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"># drop duplicates</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">retail_rfm_df_copy</span> <span class="o">=</span> <span class="n">retail_rfm_df</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="n">retail_rfm_df_copy</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;InvoiceNo&#39;</span><span class="p">,</span> <span class="s1">&#39;CustomerID&#39;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&#34;first&#34;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="c1">#calculate frequency of purchases</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="n">frequency_df</span> <span class="o">=</span> <span class="n">retail_rfm_df_copy</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;InvoiceNo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="n">frequency_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="n">frequency_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></div><p>Kết quả</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl">	<span class="n">CustomerID</span>	<span class="n">Frequency</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="mi">0</span>	<span class="mi">12346</span>	<span class="mi">1</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="mi">1</span>	<span class="mi">12347</span>	<span class="mi">5</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="mi">2</span>	<span class="mi">12348</span>	<span class="mi">3</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="mi">3</span>	<span class="mi">12349</span>	<span class="mi">1</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="mi">4</span>	<span class="mi">12350</span>	<span class="mi">1</span>
</span></span></code></pre></div><h2 id="33-tính-monetary">3.3 Tính Monetary<a class="anchor ms-1" href="#33-tính-monetary"><i class="fas fa-link"></i></a></h2>
<p>Monetary là tổng tiền khách hàng đã sử dụng</p>
<p>Do đã tính doanh thu từ trước, nên giờ chúng ta sử dụng lại, chỉ cần gom nhóm theo mã khách hàng là được</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl">
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">monetary_df</span> <span class="o">=</span> <span class="n">retail_rfm_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">])[</span><span class="s1">&#39;Revenue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">monetary_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span><span class="s1">&#39;Monetary&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="n">monetary_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></div><p>Kết quả</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl">	<span class="n">CustomerID</span>	<span class="n">Monetary</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="mi">0</span>	<span class="mi">12346</span>	<span class="mf">77183.60</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="mi">1</span>	<span class="mi">12347</span>	<span class="mf">120.56</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="mi">2</span>	<span class="mi">12348</span>	<span class="mf">291.76</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="mi">3</span>	<span class="mi">12349</span>	<span class="mf">15.00</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="mi">4</span>	<span class="mi">12350</span>	<span class="mf">25.20</span>
</span></span></code></pre></div><h2 id="34-tạo-bảng-rfm">3.4 Tạo bảng RFM<a class="anchor ms-1" href="#34-tạo-bảng-rfm"><i class="fas fa-link"></i></a></h2>
<p>Cái này thì siêu đơn giản, chúng ta merge 3 bảng trên lại là xong</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl">
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1">#merge recency dataframe with frequency dataframe</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">temp_df</span> <span class="o">=</span> <span class="n">recency_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">frequency_df</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1">#merge with monetary dataframe to get a table with the 3 columns</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">rfm_df</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">monetary_df</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1">#use CustomerID as index</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="n">rfm_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="c1">#check the head</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="n">rfm_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></div><p>Kết quả</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl">
</span></span><span class="line"><span class="ln">2</span><span class="cl">	<span class="n">Recency</span>	<span class="n">Frequency</span>	<span class="n">Monetary</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">CustomerID</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="mi">12346</span>	<span class="mi">316</span>	<span class="mi">1</span>	<span class="mf">77183.60</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="mi">12347</span>	<span class="mi">30</span>	<span class="mi">5</span>	<span class="mf">120.56</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="mi">12348</span>	<span class="mi">66</span>	<span class="mi">3</span>	<span class="mf">291.76</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="mi">12349</span>	<span class="mi">9</span>	<span class="mi">1</span>	<span class="mf">15.00</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="mi">12350</span>	<span class="mi">301</span>	<span class="mi">1</span>	<span class="mf">25.20</span>
</span></span></code></pre></div><h2 id="35-phân-nhóm-khách-hàng-sử-dụng-rfm">3.5 Phân nhóm khách hàng sử dụng RFM<a class="anchor ms-1" href="#35-phân-nhóm-khách-hàng-sử-dụng-rfm"><i class="fas fa-link"></i></a></h2>
<p>Cách đơn giản nhất để phân nhóm khách hàng là sử dụng Quartiles. Chúng ta có thể chia tập khách hàng thành 3 hoặc 4 hoặc 5 nhóm gì đó, tuỳ mục đích kinh doanh.</p>
<p>Ở đây, giả sử mình chia làm 4 nhóm, sử dùng hàm quantile của pandas</p>
<p>Kỹ thuật lập trình như sau:</p>
<ul>
<li>
<p>Chia các giá trị của Recency, Frequency, Monetary thành 4 nhóm, có miền giá trị từ 0 đến 3, được 4 cái phần tư vị cho mỗi nhóm</p>
</li>
<li>
<p>Giá trị Recency càng nhỏ càng tốt, trong khi đó, giá trị Frequency và Monetary càng lớn càng tốt, để thống nhất chung, chúng ta sẽ đổi dấu của Recency, để cả 3 cùng thoả tính chất càng lớn càng tốt.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1">#RFM Quartiles</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">rfm_df</span><span class="p">[</span><span class="s1">&#39;Recency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">rfm_df</span><span class="p">[</span><span class="s1">&#39;Recency&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">quantiles</span> <span class="o">=</span> <span class="n">rfm_df</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="p">[</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">quantiles</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">quantiles</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1">### Creation of RFM Segments</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"># Arguments (x = value, p = recency, monetary_value, frequency, k = quartiles dict)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">def</span> <span class="nf">FMScore</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mf">0.25</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mf">0.50</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="k">return</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="mf">0.75</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">return</span> <span class="mi">2</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">return</span> <span class="mi">3</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="c1">#create rfm segmentation table</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="n">rfm_segmentation</span> <span class="o">=</span> <span class="n">rfm_df</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="n">rfm_segmentation</span><span class="p">[</span><span class="s1">&#39;R_Quartile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfm_segmentation</span><span class="p">[</span><span class="s1">&#39;Recency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">FMScore</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Recency&#39;</span><span class="p">,</span><span class="n">quantiles</span><span class="p">,))</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="n">rfm_segmentation</span><span class="p">[</span><span class="s1">&#39;F_Quartile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfm_segmentation</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">FMScore</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="n">quantiles</span><span class="p">,))</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="n">rfm_segmentation</span><span class="p">[</span><span class="s1">&#39;M_Quartile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfm_segmentation</span><span class="p">[</span><span class="s1">&#39;Monetary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">FMScore</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Monetary&#39;</span><span class="p">,</span><span class="n">quantiles</span><span class="p">,))</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="n">rfm_segmentation</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="n">rfm_segmentation</span><span class="p">[</span><span class="s1">&#39;RFMScore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rfm_segmentation</span><span class="o">.</span><span class="n">R_Quartile</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> \
</span></span><span class="line"><span class="ln">31</span><span class="cl">                            <span class="o">+</span> <span class="n">rfm_segmentation</span><span class="o">.</span><span class="n">F_Quartile</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> \
</span></span><span class="line"><span class="ln">32</span><span class="cl">                            <span class="o">+</span> <span class="n">rfm_segmentation</span><span class="o">.</span><span class="n">M_Quartile</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="n">rfm_segmentation</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="c1">#How many customers do we have in each segment?</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Best Customers: &#34;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">rfm_segmentation</span><span class="p">[</span><span class="n">rfm_segmentation</span><span class="p">[</span><span class="s1">&#39;RFMScore&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;333&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loyal Customers: &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">rfm_segmentation</span><span class="p">[</span><span class="n">rfm_segmentation</span><span class="p">[</span><span class="s1">&#39;F_Quartile&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">]))</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Big Spenders: &#34;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">rfm_segmentation</span><span class="p">[</span><span class="n">rfm_segmentation</span><span class="p">[</span><span class="s1">&#39;M_Quartile&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">]))</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Almost Lost: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rfm_segmentation</span><span class="p">[</span><span class="n">rfm_segmentation</span><span class="p">[</span><span class="s1">&#39;RFMScore&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;133&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lost Customers: &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">rfm_segmentation</span><span class="p">[</span><span class="n">rfm_segmentation</span><span class="p">[</span><span class="s1">&#39;RFMScore&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;033&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lost Cheap Customers: &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">rfm_segmentation</span><span class="p">[</span><span class="n">rfm_segmentation</span><span class="p">[</span><span class="s1">&#39;RFMScore&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;000&#39;</span><span class="p">]))</span>
</span></span></code></pre></div><p>Kết quả</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">quantiles</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="o">&gt;&gt;</span> <span class="n">quantiles</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">     <span class="n">Recency</span>  <span class="n">Frequency</span>  <span class="n">Monetary</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="mf">0.25</span>     <span class="mf">15.0</span>        <span class="mf">1.0</span>   <span class="mf">17.4000</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="mf">0.50</span>     <span class="mf">45.0</span>        <span class="mf">2.0</span>   <span class="mf">43.5000</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="mf">0.75</span>    <span class="mf">128.0</span>        <span class="mf">4.0</span>  <span class="mf">119.6625</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">{</span><span class="s1">&#39;Frequency&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mf">0.25</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">},</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"> <span class="s1">&#39;Monetary&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mf">0.25</span><span class="p">:</span> <span class="mf">17.399999999999999</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">:</span> <span class="mf">43.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">:</span> <span class="mf">119.66250000000001</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"> <span class="s1">&#39;Recency&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mf">0.25</span><span class="p">:</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">:</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">:</span> <span class="mf">128.0</span><span class="p">}}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="o">&gt;&gt;</span><span class="n">rfm_segmentation</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">	<span class="n">Recency</span>	<span class="n">Frequency</span>	<span class="n">Monetary</span>	<span class="n">R_Quartile</span>	<span class="n">F_Quartile</span>	<span class="n">M_Quartile</span>	<span class="n">RFMScore</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="n">CustomerID</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="mi">12346</span>	<span class="mi">316</span>	<span class="mi">1</span>	<span class="mf">77183.60</span>	<span class="mi">3</span>	<span class="mi">0</span>	<span class="mi">3</span>	<span class="mi">303</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="mi">12347</span>	<span class="mi">30</span>	<span class="mi">5</span>	<span class="mf">120.56</span>	<span class="mi">1</span>	<span class="mi">3</span>	<span class="mi">3</span>	<span class="mi">133</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="mi">12348</span>	<span class="mi">66</span>	<span class="mi">3</span>	<span class="mf">291.76</span>	<span class="mi">2</span>	<span class="mi">2</span>	<span class="mi">3</span>	<span class="mi">223</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="mi">12349</span>	<span class="mi">9</span>	<span class="mi">1</span>	<span class="mf">15.00</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">000</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="mi">12350</span>	<span class="mi">301</span>	<span class="mi">1</span>	<span class="mf">25.20</span>	<span class="mi">3</span>	<span class="mi">0</span>	<span class="mi">1</span>	<span class="mi">301</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="n">Best</span> <span class="n">Customers</span><span class="p">:</span>  <span class="mi">10</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="n">Loyal</span> <span class="n">Customers</span><span class="p">:</span>  <span class="mi">980</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="n">Big</span> <span class="n">Spenders</span><span class="p">:</span>  <span class="mi">1044</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="n">Almost</span> <span class="n">Lost</span><span class="p">:</span>  <span class="mi">188</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="n">Lost</span> <span class="n">Customers</span><span class="p">:</span>  <span class="mi">374</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="n">Lost</span> <span class="n">Cheap</span> <span class="n">Customers</span><span class="p">:</span>  <span class="mi">101</span>
</span></span></code></pre></div><h1 id="tham-khảo">Tham khảo<a class="anchor ms-1" href="#tham-khảo"><i class="fas fa-link"></i></a></h1>
<p><a href="https://blog.hubspot.com/service/rfm-analysis" target="_blank" rel="noopener noreferrer">https://blog.hubspot.com/service/rfm-analysis</a></p>
<p><a href="https://www.investopedia.com/terms/r/rfm-recency-frequency-monetary-value.asp" target="_blank" rel="noopener noreferrer">https://www.investopedia.com/terms/r/rfm-recency-frequency-monetary-value.asp</a></p>
<p>Cảm ơn các bạn đã dành thời gian đọc bài. Nếu có bất kỳ vấn đề gì, hãy để lại comment bên dưới hoặc email cho mình qua địa chỉ <a href="mailto:alexblack2202@gmail.com">alexblack2202@gmail.com</a>. Hẹn gặp lại các bạn ở bài viết tiếp theo.</p>
<p>Source code mình có để ở <a href="https://www.kaggle.com/code/alexblack2202/customer-segmentation-using-rfm-analysis" target="_blank" rel="noopener noreferrer">https://www.kaggle.com/code/alexblack2202/customer-segmentation-using-rfm-analysis</a></p>
</div></div>
  <div class="card-footer"><div class="post-navs d-flex justify-content-evenly"><div class="post-nav post-prev">
    <i class="fas fa-fw fa-chevron-left"></i>
    <a href="/blog/2022-12-01-tiktok-recommendation/">Tiktok Real Time Recommendation
</a>
  </div><div class="post-nav post-next">
    <a href="/blog/2023-02-18-symbolic-vs-connectionist/">Symbolic AI Và Connectionist AI
</a>
    <i class="fas fa-fw fa-chevron-right"></i>
  </div></div></div>
</article><div class="card component row post-comments" id="post-comments">
  <div class="card-header">
    <h2 class="card-title">Comments</h2>
  </div>
  <div class="card-body"><script src="https://utteranc.es/client.js"
  repo="AlexBlack2202/utterances"
  issue-term="pathname"
  label="comment"
  theme="github-dark"
  crossorigin="anonymous"
  async>
</script></div>
</div></div>
</div><aside class="col-lg-3 col-md-4 sidebar d-flex">
  <div class="container d-flex flex-column">
    
    <a href="https://www.buymeacoffee.com/alexblack28"><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&emoji=🍎&slug=alexblack28&button_colour=FFDD00&font_colour=000000&font_family=Cookie&outline_colour=000000&coffee_colour=ffffff" /></a><div class="post-toc row mb-4 card component" id="postTOC">
  <div class="card-header">
    <h2 class="card-title">Contents</h2>
  </div>
  <div class="card-body">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#1-giới-thiệu-rfm">1. Giới thiệu RFM</a></li>
    <li><a href="#2-giới-thiệu-data-và-tìm-hiểu-data">2. Giới thiệu data và tìm hiểu data</a>
      <ul>
        <li><a href="#21-giới-thiệu-data">2.1 Giới thiệu data</a></li>
        <li><a href="#22-thực-hiện-một-số-phép-thống-kê-trên-dữ-liệu">2.2 Thực hiện một số phép thống kê trên dữ liệu</a></li>
        <li><a href="#23-phân-tích-dữ-liệu">2.3 Phân tích dữ liệu</a>
          <ul>
            <li><a href="#231-tính-doanh-thu-theo-tháng">2.3.1 Tính doanh thu theo tháng</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#232-thống-kê-tăng-trưởng-của-doanh-thu">2.3.2 Thống kê tăng trưởng của doanh thu</a>
      <ul>
        <li>
          <ul>
            <li><a href="#233-phân-tích-số-lượng-khách-hàng-tháng">2.3.3 Phân tích số lượng khách hàng tháng</a></li>
            <li><a href="#234-số-đơn-đặt-hàng-trong-tháng">2.3.4 Số đơn đặt hàng trong tháng</a></li>
            <li><a href="#235-doanh-thu-trung-bình-mỗi-đơn-hàng">2.3.5 Doanh thu trung bình mỗi đơn hàng</a></li>
            <li><a href="#236-số-lượng-khách-hàng-mới-cũ-theo-từng-tháng">2.3.6 Số lượng khách hàng mới/ cũ theo từng tháng</a></li>
            <li><a href="#237-tỷ-lệ-tăng-trưởng-khách-hàng-mới">2.3.7 Tỷ lệ tăng trưởng khách hàng mới</a></li>
            <li><a href="#238-tỷ-lệ-giữ-chân-khách-hàng-cũ-hàng-tháng">2.3.8 Tỷ lệ giữ chân khách hàng cũ hàng tháng</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#3-phân-khúc-khách-hàng">3. Phân Khúc Khách Hàng</a>
      <ul>
        <li><a href="#31-clean-data">3.1 Clean data</a></li>
        <li><a href="#31-tính-recency">3.1 Tính Recency</a></li>
        <li><a href="#32-tính-frequency">3.2 Tính Frequency</a></li>
        <li><a href="#33-tính-monetary">3.3 Tính Monetary</a></li>
        <li><a href="#34-tạo-bảng-rfm">3.4 Tạo bảng RFM</a></li>
        <li><a href="#35-phân-nhóm-khách-hàng-sử-dụng-rfm">3.5 Phân nhóm khách hàng sử dụng RFM</a></li>
      </ul>
    </li>
    <li><a href="#tham-khảo">Tham khảo</a></li>
  </ul>
</nav>
  </div>
</div><section class="recent-posts row card component">
  <div class="card-header">
    <h2 class="card-title">Recent Posts</h2>
  </div>
  <div class="card-body">
    <ul class="post-list"><li>
        <a href="/blog/2025-08-30-build-usefull-machinelearning-models-copy/">PostgreSQL 18
</a>
      </li><li>
        <a href="/blog/2025-08-30-a-snare-of-emotions-woven-with-intent/">Nghị Luận Xã Hội - Chiếc Bẫy Tình Cảm Được Dựng Lên Có Chủ Đích
</a>
      </li><li>
        <a href="/blog/2025-08-30-a-snare-of-emotions-woven-with-intent-copy/">Nghị Luận Xã Hội - Chiếc Bẫy Tình Cảm Được Dựng Lên Có Chủ Đích
</a>
      </li><li>
        <a href="/blog/2025-08-30-build-usefull-machinelearning-models/">Mẹo Xây Dựng Mô Hình Machine Learning Hữu Ích Trong Thực Tế
</a>
      </li><li>
        <a href="/blog/2025-06-15-vllm-introduce/">Giới Thiệu VLLM -  Công Cụ Phục Vụ LLM Hiệu Suất Cao Cho Ứng Dụng AI
</a>
      </li></ul>
  </div>
</section><section class="series-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/series">series</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/series/kh%C3%B3a-h%E1%BB%8Dc-python-c%C4%83n-b%E1%BA%A3n/" class="badge rounded post-taxonomy" title="Khóa Học Python Căn Bản">
            Khóa Học Python Căn Bản<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/series/kh%C3%B3a-h%E1%BB%8Dc-c&#43;&#43;-c%C4%83n-b%E1%BA%A3n/" class="badge rounded post-taxonomy" title="Khóa Học C&#43;&#43; Căn Bản">
            Khóa Học C&#43;&#43; Căn Bản<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/series/machine-learning-dataset/" class="badge rounded post-taxonomy" title="Machine Learning Dataset">
            Machine Learning Dataset<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href="/series/ch%E1%BB%A9ng-kho%C3%A1n-c%C4%83n-b%E1%BA%A3n/" class="badge rounded post-taxonomy" title="Chứng Khoán Căn Bản">
            Chứng Khoán Căn Bản<span class="badge badge-sm text-white bg-accent ms-1">1</span></a></div>
      </div>
    </section><section class="tools-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/tools">tools</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/tools/tool-random/" class="badge rounded post-taxonomy" title="Tool Random">
            Tool Random<span class="badge badge-sm text-white bg-accent ms-1">2</span></a></div>
      </div>
    </section><section class="categories-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/categories">categories</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/categories/python/" class="badge rounded post-taxonomy" title="Python">
            Python<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/categories/c&#43;&#43;/" class="badge rounded post-taxonomy" title="C&#43;&#43;">
            C&#43;&#43;<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/categories/dataset/" class="badge rounded post-taxonomy" title="Dataset">
            Dataset<span class="badge badge-sm text-white bg-accent ms-1">2</span></a></div>
      </div>
    </section><section class="tags-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/tags">tags</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/tags/machine-learning/" class="badge rounded post-taxonomy" title="Machine Learning">
            Machine Learning<span class="badge badge-sm text-white bg-accent ms-1">47</span></a><a href="/tags/deep-learning/" class="badge rounded post-taxonomy" title="Deep Learning">
            Deep Learning<span class="badge badge-sm text-white bg-accent ms-1">21</span></a><a href="/tags/deeplearning/" class="badge rounded post-taxonomy" title="DeepLearning">
            DeepLearning<span class="badge badge-sm text-white bg-accent ms-1">21</span></a><a href="/tags/python/" class="badge rounded post-taxonomy" title="Python">
            Python<span class="badge badge-sm text-white bg-accent ms-1">11</span></a><a href="/tags/opencv/" class="badge rounded post-taxonomy" title="Opencv">
            Opencv<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/tags/c&#43;&#43;/" class="badge rounded post-taxonomy" title="C&#43;&#43;">
            C&#43;&#43;<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/marketing/" class="badge rounded post-taxonomy" title="Marketing">
            Marketing<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/normalization/" class="badge rounded post-taxonomy" title="Normalization">
            Normalization<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/object-detector/" class="badge rounded post-taxonomy" title="Object Detector">
            Object Detector<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/recommendation/" class="badge rounded post-taxonomy" title="Recommendation">
            Recommendation<span class="badge badge-sm text-white bg-accent ms-1">4</span></a></div>
      </div>
    </section>
    
  </div>
</aside>
</div>
    </main><footer class="footer mt-auto py-3 text-center container"><ul class="nav justify-content-between footer-memu mb-3"><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Support
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-github"></i>Repository
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-comments"></i>Discussions
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="/contact/"><i class="fas fa-fw fa-info-circle"></i>Contact Us
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="/faq/"><i class="fas fa-fw fa-question-circle"></i>FAQs
</a>
        </li></ul></li><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Docs
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="/team_of_services" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-users"></i>Điều khoản sử dụng
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="/privacy" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-lock"></i>Chính sách bảo mật
</a>
        </li></ul></li><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Features
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="https://www.phamduytung.com/utils/gen_paswords/" target="_blank" rel="noopener noreferrer"><i class="fas fa-fw fa-paw"></i>Tạo password ngẫu nhiên
</a>
        </li></ul></li><li class="nav-item"><ul class="nav flex-column align-items-start">
      <li class="nav-item">
        <a class="nav-link fw-bold" target="_blank" rel="noopener noreferrer">Liên kết khác
</a>
      </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">Netlify
</a>
        </li><li class="nav-item">
            <a class="nav-link" href="https://www.facebook.com/groups/1354425091720104" target="_blank" rel="noopener noreferrer">facebook
</a>
        </li></ul></li></ul>
<div class="copyright mb-2">
  Copyright © 2016-2025 Phạm Duy Tùng. All Rights Reserved.
</div>
<div class="powered-by mb-2">
  Website chia sẻ kiến thức của Phạm Duy Tùng và Đặng Thị Hằng. Vui lòng liên hệ email alexblack2202@gmail.com nếu bạn có thông tin cần trao đổi.
</div></footer>
<script src="/js/main.ed2053ad82a243b263761567b5c1aaf974487aa84adacb89ae3ddf803ecc248a.js" integrity="sha256-7SBTrYKiQ7JjdhVntcGq&#43;XRIeqhK2suJrj3fgD7MJIo=" crossorigin="anonymous" defer></script><script src="/js/icons.min.8ff200851002b8138e6b35314683092e02edc155465d9dbfb7d115460f8f1fbe.js" integrity="sha256-j/IAhRACuBOOazUxRoMJLgLtwVVGXZ2/t9EVRg&#43;PH74=" crossorigin="anonymous" defer></script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('\/service-worker.js').then(function(reg) {
      console.log('Successfully registered service worker', reg);
    }).catch(function(err) {
      console.warn('Error whilst registering service worker', err);
    });
  });
}
</script><script src="/js/viewer.min.ec58d2aa1a8916addf393be975fdf0070e8c872b0caef1673cb9f7eea067ce57.js" integrity="sha256-7FjSqhqJFq3fOTvpdf3wBw6MhysMrvFnPLn37qBnzlc=" crossorigin="anonymous" defer></script><script defer src="/js/katex.min.d5052035160facae59b60000106771baf2eb7671123813d21f1097a5a9218b6e.js" integrity="sha256-1QUgNRYPrK5ZtgAAEGdxuvLrdnESOBPSHxCXpakhi24=" crossorigin="anonymous"></script>

<script  data-ad-client="ca-pub-4644989745435991"  async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4644989745435991"
     crossorigin="anonymous"></script><script data-cfasync="false" type="text/javascript" data-adel="atag" src="//acscdn.com/script/atg.js" czid="eul3gyjdmm"></script>
  </body>
</html>
